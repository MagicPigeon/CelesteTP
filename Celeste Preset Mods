// ==UserScript==
// @name            Celeste Preset Texture Mods
// @description     Apply preset mods to your texture pack.
// @version         0.0.7
// @include         *://tagpro.koalabeast.com/textures*
// @include         *://tagpro.koalabeast.com/game
// @include         *://tagpro.koalabeast.com/game?*
// @include         https://tagpro.koalabeast.com/game?*
// @include         *://tagpro-maptest-*.koalabeast.com*
// @include         https://bash-tp.github.io/*
// @grant           GM_getValue
// @grant           GM_setValue
// @grant           GM_deleteValue
// @grant           GM_addStyle
// @author          nabby
// ==/UserScript==

'use strict';

console.log('START: ' + GM_info.script.name + ' (v' + GM_info.script.version + ' by ' + GM_info.script.author + ')');
//GM_deleteValue('preset');


tagpro.ready(function() {
    let defaultOptions = { //these values get updated/overwritten by the script
        preset: 'value-none',
        floor: 'value-normal',
        floor_filter: '',
        plainfloor: false,
        plainfloor_color_use: false,
        plainfloor_color: '#e0e0e0',
        plainteam: false,
        plainteam_color_use: false,
        plainteam_color_red:'#aa0000',
        plainteam_color_blue:'#0040a0',
        plainteam_color_yellow:'#aaaa00',
        plainendzone: false,
        plainendzone_color_use: false,
        plainendzone_color_red:'#aa0000',
        plainendzone_color_blue:'#0040a0',
        grid1_size: '0',
        grid1_length: '40',
        grid1_width: '1',
        grid1_color: 'auto',
        grid1_opacity: '0.2',
        grid1_square: false,
        grid1_rectangles: false,
        grid1_lines: false,
        grid1_diagonal: false,
        grid1_crosses: false,
        grid1_shadow: false,
        grid2_size: '0',
        grid2_length: '40',
        grid2_width: '1',
        grid2_color: 'auto',
        grid2_opacity: '0.2',
        grid2_square: false,
        grid2_rectangles: false,
        grid2_lines: false,
        grid2_diagonal: false,
        grid2_crosses: false,
        grid2_shadow: false,
        checker1_size: '0',
        checker1_margin: '0',
        checker1_color: '#000000',
        checker1_opacity: '0.05',
        checker1_normal: false,
        checker1_random: false,
        checker1_straight: false,
        checker1_stripes: false,
        floor_gradient1: false,
        floor_gradient1_type: 'value-gradient1_linear',
        floor_gradient1_color1: '#000000',
        floor_gradient1_color2: '#ffffff',
        floor_gradient1_opacity1: '0.5',
        floor_gradient1_opacity2: '0.5',
        floor_gradient2: false,
        floor_gradient2_type: 'value-gradient2_radial',
        floor_gradient2_color1: '#000000',
        floor_gradient2_color2: '#ffffff',
        floor_gradient2_opacity1: '0.5',
        floor_gradient2_opacity2: '0.5',
        floor_gradient1_size: '100',
        floor_gradient2_size: '100',
        floor_contour: false,
        floor_contour_color: '#000000',
        floor_contour_opacity: '1',
        floor_contour_size: '80',
        floor_contour_multiplier: '4',
        teamtile_gradient: false,
        teamtile_filter: '',
        endzone_filter: '',
        endzone_checker_size: '0',
        endzone_checker_margin: '0',
        endzone_checker_color: '#000000',
        endzone_checker_opacity: '0.05',
        endzone_checker_normal: false,
        endzone_checker_random: false,
        endzone_checker_straight: false,
        endzone_checker_stripes: false,
        endzone_checker_stripes_pattern: '',
        basecircle1_linewidth: '0',
        basecircle1_radius: '300',
        basecircle1_color: 'auto',
        basecircle1_opacity: '0.5',
        basecircle1_blur: '0',
        basecircle1_glow: '0',
        basecircle1_glow_multiplier: '1',
        basecircle1_dashpattern: '',
        basecircle1_gradient: false,
        basecircle1_fill: false,
        basecircle2_linewidth: '0',
        basecircle2_radius: '280',
        basecircle2_color: 'auto',
        basecircle2_opacity: '0.5',
        basecircle2_blur: '0',
        basecircle2_glow: '0',
        basecircle2_glow_multiplier: '1',
        basecircle2_dashpattern: '40,10, 10,5, 10,10',
        basecircle2_gradient: false,
        basecircle2_fill: false,
        centerline_color: 'auto',
        centerline_opacity: '0.6',
        centerline_linewidth: '0',
        centerline_dashpattern: '5,5',
        centerline_glow: '0',
        flagline_color: 'auto',
        flagline_opacity: '0.4',
        flagline_linewidth: '0',
        flagline_dashpattern: '10,4, 3,4',
        flagline_glow: '0',
        spikes_filter: '',
        spikes_generic: false,
        spikes_generic_color: '#ffffff',
        spikes_generic_points: '8',
        spikes_generic_innerradius: '8',
        spikes_generic_holeradius: '4',
        spikes_border: false,
        spikes_border_color: '#ffffff',
        buttons_generic: false,
        buttons_generic_color_inner: '#ff7700',
        buttons_generic_color_outer: '#ffffff',
        buttons_generic_color_border: '#000000',
        ball_outline1: false,
        ball_outline1_linewidth: '2',
        ball_outline1_segments: '4',
        ball_outline1_radius: '19',
        ball_outline1_color_red: '#ffffff',
        ball_outline1_color_blue: '#ffffff',
        ball_outline1_opacity: '0.8',
        ball_outline2: false,
        ball_outline2_linewidth: '1',
        ball_outline2_segments: '0',
        ball_outline2_radius: '19',
        ball_outline2_color_red: '#000000',
        ball_outline2_color_blue: '#000000',
        ball_outline2_opacity: '1',
        ball_outline3: false,
        ball_outline3_linewidth: '1',
        ball_outline3_segments: '0',
        ball_outline3_radius: '19',
        ball_outline3_color_red: '#000000',
        ball_outline3_color_blue: '#000000',
        ball_outline3_opacity: '1',
        balls_opacity: '1',
        balls_plain: false,
        balls_plain_color_red: 'auto',
        balls_plain_color_blue: 'auto',
        balls_hole_radius: '0',
        ballskins: false,
        ballskins_opacity: '1',
        ballskins_gco: 'source-over',
        ballskins_red_x: '-1',
        ballskins_red_y: '-1',
        ballskins_blue_x: '-1',
        ballskins_blue_y: '-1',
        ballskins_scale_red: '0.83',
        ballskins_scale_blue: '0.83',
        ballskins_filter_red: '',
        ballskins_filter_blue: '',
        bombs_outline: false,
        bombs_outline_linewidth: '2',
        bombs_outline_segments: '3',
        bombs_outline_radius: '15',
        bombs_outline_color: '#ffffff',
        bombs_outline_opacity: '0.8',
        bombs_filter: '',
        bombs_draw_exploded_20pc: false,
        flags_outline: false,
        flags_outline_linewidth: '1',
        flags_outline_segments: '20',
        flags_outline_color: '#ffffff',
        flags_outline_opacity: '1',
        gates_plain_neutral: false,
        gates_plain_neutral_color: 'auto',
        gates_plain_grb: false,
        gates_plain_grb_green: 'auto',
        gates_plain_grb_red: 'auto',
        gates_plain_grb_blue: 'auto',
        gates_glow: false,
        gates_glow_outline: false,
        gates_glow_color_green: 'auto',
        gates_glow_color_red: 'auto',
        gates_glow_color_blue: 'auto',
        gates_neutral_opacity: '1',
        gates_neutral_margin: '0',
        gates_neutral_outline: false,
        flags_glow: false,
        flags_glow_color_red: 'auto',
        flags_glow_color_blue: 'auto',
        flags_glow_color_yellow: 'auto',
        pups_glow: false,
        pups_glow_outline: false,
        pups_glow_color_jj: 'auto',
        pups_glow_color_rb: 'auto',
        pups_glow_color_tp: 'auto',
        boosts_outline: false,
        boosts_outline_color_red: 'auto',
        boosts_outline_color_blue: 'auto',
        boosts_outline_color_yellow: 'auto',
        boosts_outline_opacity: '0.6',
        boosts_outline_linewidth: '1',
        boosts_outline_dashpattern: '4,5',
        portals_outline: false,
        portals_outline_color: 'auto',
        portals_outline_opacity: '0.6',
        portals_outline_linewidth: '1',
        portals_outline_dashpattern: '4,5',
        portals_outline_fill: false,
        gravityWell_linewidth: '30',
        gravityWell_color: '#00bb55',
        gravityWell_opacity: '0.4',
        gravityWell_dashpattern: '',
        gravityWell_gradient: true,
        plainwalls: false,
        plainwalls_color: '#000000',
        walls_filter: '',
        wallshadow_size: '2',
        wallshadow_blur: '3',
        wallshadow_color: '#000000',
        wallshadow_opacity: '0.7',
        wallshadow_multiplier: '3',
        wallshadow_inner: false,
        wallshadow_outer: false,
        gate_shadows: false,
        walloutline1_size: '0',
        walloutline1_color: 'auto',
        walloutline2_size: '0',
        walloutline2_color: 'auto',
        walloutline2_dashed: false,
        walloutline3_size: '0',
        walloutline3_color: 'auto',
        walloutline3_opacity: '1',
        texture_ballskins: 'select-Skins',
        texture_floor1: 'select-none',
        texture_floor1_filter: '',
        texture_floor1_size: '1',
        texture_floor1_gco: 'source-atop',
        texture_floor2_filter: '',
        texture_floor2_size: '1',
        texture_floor2: 'select-none',
        texture_floor2_gco: 'source-atop',
        texture_floor3: 'select-none',
        texture_floor3_filter: '',
        texture_floor3_size: '1',
        texture_floor3_gco: 'source-atop',
        texture_team: 'select-none',
        texture_team_filter: '',
        texture_team_size: '1',
        texture_team_gco: 'source-atop',
        texture_endzone: 'select-none',
        texture_endzone_filter: '',
        texture_endzone_size: '1',
        texture_endzone_gco: 'source-atop',
        texture_walls1: 'select-none',
        texture_walls1_filter: '',
        texture_walls1_size: '1',
        texture_walls1_gco: 'source-atop',
        texture_walls2: 'select-none',
        texture_walls2_filter: '',
        texture_walls2_size: '1',
        texture_walls2_gco: 'source-atop',
        texture_base: 'select-none',
        texture_base_filter: '',
        texture_base_size: '1',
        texture_base_gco: 'source-atop',

        texture_logo_automatic: false,
        texture_logo_red: 'select-none',
        texture_logo_red_filter: '',
        texture_logo_red_size: '1',
        //texture_logo_red_gco: 'source-atop',
        texture_logo_red_xOffset: '0',
        texture_logo_red_yOffset: '0',
        texture_logo_blue: 'select-none',
        texture_logo_blue_filter: '',
        texture_logo_blue_size: '1',
        //texture_logo_blue_gco: 'source-atop',
        texture_logo_blue_xOffset: '0',
        texture_logo_blue_yOffset: '0',

        texture_center: 'select-none',
        texture_center_filter: '',
        texture_center_size: '1',

        background_color1: '#000000',
        background_color2: '#000000',
        background_size: '50',
        background_useballcolors: false,
        background: 'value-none',
        kblogo: false,
        fill_empty_with_walls: false,
        showall: false,
        mysaves: '',
    };

    let defaultValues = {
        gates_glow_size: 5,
        flags_glow_size: 2,

        tiles: {
            'select-Light Concrete Tile (40px)':      { url:'https://i.imgur.com/Y8FM5bh.jpg', filter:'',  size:1 },
            'select-Dark Concrete Tile (40px)':       { url:'https://i.imgur.com/y76Y950.jpg', filter:'',  size:1 },
            'select-Dark Concrete Slate Tile (40px)': { url:'https://i.imgur.com/Xyt2I8T.jpg', filter:'',  size:1 },
            'select-Dark Marble Tile (40px)':         { url:'https://i.imgur.com/fYHi3Rn.jpg', filter:'saturate(40%)', size:1 },
            'select-Mossy Tiles (40px)':              { url:'https://i.imgur.com/DQ2YjuY.jpg', filter:'',  size:1 },
            'select-Straight Check Tiles (40px)':     { url:'https://i.imgur.com/YTJU2Db.jpg', filter:'',  size:1 },
            'select-White Acoustic (40px)':           { url:'https://i.imgur.com/D6b8RXL.jpg', filter:'',  size:1 },
            'select-Stone #1 (40px)':                 { url:'https://i.imgur.com/DZnk0M3.jpg', filter:'',  size:1 },
            'select-Stone #2 (40px)':                 { url:'https://i.imgur.com/jW0uUr2.jpg', filter:'',  size:1 },
            'select-Stone #3 (40px)':                 { url:'https://i.imgur.com/B9o9T6w.jpg', filter:'saturate(0%)', size:1 },
            'select-Stone #4 (40px)':                 { url:'https://i.imgur.com/Z0QRNUQ.jpg', filter:'',  size:1 },
            'select-Stone #6 (40px)':                 { url:'https://i.imgur.com/04jVuxx.jpg', filter:'',  size:1 },
            'select-Parquet':                         { url:'https://i.imgur.com/7ZYs6Kr.png', filter:'opacity(60%) saturate(50%)', size:1 }, //40px Size: 0.4706
            'select-Wood Panel':                      { url:'https://i.imgur.com/656YfE9.jpg', filter:'opacity(40%) saturate(0%)', size:1 }, //40px Size: 0.16
            'select-40px Edge':                       { url:'https://i.imgur.com/BgKmTGd.png', filter:'opacity(100%) saturate(0%)', size:1 },
            'select-40px Raised':                     { url:'https://i.imgur.com/axuW2il.png', filter:'opacity(100%) saturate(0%)', size:1 },
            'select-40px Chunky':                     { url:'https://i.imgur.com/pPt8jI8.png', filter:'opacity(100%) saturate(0%)', size:1 },
            'select-40px Fine':                       { url:'https://i.imgur.com/q5sbWaS.png', filter:'opacity(100%) saturate(0%)', size:1 },
            'select-40px Finer':                      { url:'https://i.imgur.com/LlSu2RI.png', filter:'opacity(100%) saturate(0%)', size:1 },
            'select-40px Bumpy':                      { url:'https://i.imgur.com/5uEaIv5.png', filter:'opacity(100%) saturate(0%)', size:1 },
            'select-40px Emboss':                     { url:'https://i.imgur.com/1te16tm.png', filter:'opacity(100%) saturate(0%)', size:1 },
            'select-40px Riveted':                    { url:'https://i.imgur.com/Fi5a22M.png', filter:'opacity(100%) saturate(0%)', size:1 },
            'select-40px Rough':                      { url:'https://i.imgur.com/Gvt0xNA.png', filter:'opacity(100%) saturate(0%)', size:1 },
            'select-40px Random':                     { url:'https://i.imgur.com/yQpbCkU.png', filter:'opacity(100%) saturate(0%)', size:1 },

        }, textures: {
            'select-Celeste Moon':                   { url:'https://i.imgur.com/BXPO854.png', filter:'opacity(100%)', size:1 },
            'select-Celeste Moon2':                  { url:'https://i.imgur.com/gMItc4q.png', filter:'opacity(80%)', size:1 },
            'select-Celeste Space':                 { url:'https://i.imgur.com/jzk0jbN.jpg', filter:'opacity(100%)', size:1 },
            'select-Celeste Stars':                 { url:'https://i.imgur.com/vOX7Biw.png', filter:'opacity(80%)', size:1 },
            'select-JoJo Metal 7-5a':                 { url:'https://i.imgur.com/i6FnEVt.jpg', filter:'opacity(80%)', size:1 },
            'select-JoJo Metal 7-3c':                 { url:'https://i.imgur.com/TPJfdty.jpg', filter:'opacity(80%)', size:1 },
            'select-JoJo Metal 7-2':                  { url:'https://i.imgur.com/tbkht6s.jpg', filter:'opacity(80%)', size:1 },
            'select-JoJo Metal 7-2c':                 { url:'https://i.imgur.com/MfsxeRg.jpg', filter:'opacity(30%)', size:1 },
            'select-JoJo Metal 7-4':                  { url:'https://i.imgur.com/rruV0LI.jpg', filter:'opacity(80%)', size:1 },
            'select-JoJo Metal 58':                   { url:'https://i.imgur.com/Asaedin.jpg', filter:'opacity(80%)', size:1 },
            'select-JoJo Bronze 1':                   { url:'https://i.imgur.com/qgOcYV7.jpg', filter:'opacity(80%)', size:1 },
            'select-JoJo Bronze 12':                  { url:'https://i.imgur.com/zxoJ4eZ.jpg', filter:'opacity(40%)', size:1 },
            'select-JoJo Bronze 16':                  { url:'https://i.imgur.com/Bqc7NIU.jpg', filter:'opacity(40%)', size:1 },
            'select-JoJo Turquoise 4':                { url:'https://i.imgur.com/hPqvUiw.jpg', filter:'opacity(50%) brightness(125%)', size:0.3 },
            'select-JoJo Fantasy 1-1a':               { url:'https://i.imgur.com/zAGwu0j.jpg', filter:'opacity(60%) blur(2px)', size:0.3 },
            'select-JoJo Metal Flowers 1':            { url:'https://i.imgur.com/Ldn0yp9.jpg', filter:'opacity(75%)', size:1 },
            'select-JoJo Stained Glass 3-4':          { url:'https://i.imgur.com/gaCqtZ5.jpg', filter:'opacity(50%)', size:1 },
            'select-JoJo Stained Glass 3-7':          { url:'https://i.imgur.com/idQmNIb.jpg', filter:'opacity(30%)', size:1 },
            'select-JoJo Stained Glass 3-10':         { url:'https://i.imgur.com/1Kl7ECn.jpg', filter:'opacity(30%)', size:1 },
            'select-JoJo Relief Lines 5':             { url:'https://i.imgur.com/681taoV.jpg', filter:'opacity(60%)', size:1 },
            'select-JoJo Relief Lines 7':             { url:'https://i.imgur.com/YraY3LT.jpg', filter:'opacity(60%)', size:1 },
            'select-JoJo Relief Lines 14':            { url:'https://i.imgur.com/KKx8Sh6.jpg', filter:'opacity(60%)', size:1 },
            'select-JoJo Relief Lines 23':            { url:'https://i.imgur.com/4a0axxe.jpg', filter:'opacity(60%)', size:1 },
            'select-Grey Noise':                      { url:'https://i.imgur.com/HX9icFx.png', filter:'opacity(30%) saturate(0%)', size:1 },
            'select-Abstract Lines':                  { url:'https://i.imgur.com/Jrbl2F6.jpg', filter:'opacity(60%) brightness(50%) saturate(60%)',  size:1 },
            'select-Abstract Curves':                 { url:'https://i.imgur.com/CKUt7gq.jpg', filter:'opacity(40%) saturate(60%)', size:1 },
            'select-Abstract Aurora':                 { url:'https://i.imgur.com/sGe7na2.jpg', filter:'opacity(50%)', size:1 },
            'select-Vertices':                        { url:'https://i.imgur.com/3tvWsw4.jpg', filter:'opacity(40%)', size:1 },
            'select-Thorns':                          { url:'https://i.imgur.com/SAqSSio.jpg', filter:'opacity(25%)', size:1 },
            'select-Bubbles & Swirls':                { url:'https://i.imgur.com/QzTA5so.jpg', filter:'opacity(25%)', size:1 },
            'select-Triangle Kaleidoscope':           { url:'https://i.imgur.com/D61kjL1.jpg', filter:'opacity(25%) saturate(0%)', size:1 },
            'select-Pensieve':                        { url:'https://i.imgur.com/trgLYP7.jpg', filter:'opacity(15%) saturate(0%)', size:1.5 },
            'select-Stranger Things':                 { url:'https://i.imgur.com/5VL5JK5.jpg', filter:'opacity(60%) brightness(20%) hue-rotate(330deg)', size:1 },
            'select-Fire Swirls':                     { url:'https://i.imgur.com/HmO4fo6.jpg', filter:'opacity(60%)', size:1 },
            'select-Blue Abstract':                   { url:'https://i.imgur.com/4HscgQP.jpg', filter:'opacity(30%) saturate(0%)', size:1 },
            'select-Abstract #1':                     { url:'https://i.imgur.com/iPAg5go.jpg', filter:'opacity(30%) saturate(40%)', size:1 },
            'select-Abstract #2':                     { url:'https://i.imgur.com/iSAwA6f.jpg', filter:'opacity(30%) saturate(40%)', size:1 },
            'select-Blue Steel':                      { url:'https://i.imgur.com/UaHP8Xt.jpg', filter:'opacity(50%)', size:1 },
            'select-Metal':                           { url:'https://i.imgur.com/QlRuQ2M.png', filter:'opacity(50%) saturate(0%)', size:1 },
            'select-Denim':                           { url:'https://i.imgur.com/mmS04va.jpg', filter:'', size:1 },
            'select-Grey Stone':                      { url:'https://i.imgur.com/3umfx3X.jpg', filter:'opacity(40%) saturate(0%)', size:1 },
            'select-Stars #1':                        { url:'https://i.imgur.com/WIZs5aX.jpg', filter:'', size:1 },
            'select-Metal Floorplate':                { url:'https://i.imgur.com/Q29G4D1.jpg', filter:'opacity(35%) saturate(0%)', size:0.25 },
            'select-Green Lightning':                 { url:'https://i.imgur.com/q9CpL3Z.jpg', filter:'opacity(35%) saturate(0%)', size:1 },
            'select-DvA Rust':                        { url:'https://i.imgur.com/gwpmUpL.jpg', filter:'opacity(80%)', size:0.3 },
            'select-Patchy':                          { url:'https://i.imgur.com/T295R0M.png', filter:'opacity(30%) saturate(0%)', size:0.5 },
            'select-Metal':                           { url:'https://i.imgur.com/7rEw1gi.png', filter:'opacity(45%) saturate(0%)', size:1 },
            'select-Rubber Specks':                   { url:'https://i.imgur.com/bUT3z02.png', filter:'opacity(50%) saturate(0%)', size:0.5 },
            'select-Blue/Black Lightning':            { url:'https://i.imgur.com/NfViyHL.png', filter:'opacity(100%) saturate(100%)', size:0.4 },
            'select-Lava Rocks':                      { url:'https://i.imgur.com/4WudVdy.jpg', filter:'opacity(100%) saturate(200%) hue-rotate(250deg)', size:0.1 },
            'select-Colorful':                        { url:'https://i.imgur.com/ESSRqxr.png', filter:'opacity(80%) saturate(100%)', size:1 },
            'select-Sepia Blue':                      { url:'https://i.imgur.com/TBCWGlO.png', filter:'opacity(80%) saturate(400%) sepia(100%) hue-rotate(150deg)', size:1 },
            'select-Blue/Black Sparkles':             { url:'https://i.imgur.com/MiDbkF1.jpg', filter:'opacity(50%) saturate(50%)', size:0.25 },
            'select-Disco Dots':                      { url:'https://i.imgur.com/2Qjswtg.jpg', filter:'opacity(100%) saturate(0%)', size:0.15 },
            'select-Metro':                           { url:'https://i.imgur.com/m0evMLc.jpg', filter:'opacity(80%) saturate(0%)', size:0.5 },
            'select-Tech #2':                         { url:'https://i.imgur.com/qvLx41l.jpg', filter:'opacity(100%) saturate(100%) hue-rotate(120deg)', size:0.25 },
            'select-Tech #4':                         { url:'https://i.imgur.com/wDSltEC.jpg', filter:'opacity(60%) saturate(80%)', size:0.6 },
            'select-Tech #6':                         { url:'https://i.imgur.com/qjqAvPJ.jpg', filter:'opacity(70%) saturate(70%)', size:1 },
            'select-Placed Stones':                   { url:'https://i.imgur.com/Lk9PiLw.jpg', filter:'opacity(50%) saturate(0%)', size:1 },
            'select-Gold Squares':                    { url:'https://i.imgur.com/MSPvdQp.jpg', filter:'opacity(60%)', size:1 },
            'select-Gold Bumps':                      { url:'https://i.imgur.com/aVzRxTo.jpg', filter:'opacity(60%)', size:1 },
            'select-HL2 Tile #1':                     { url:'https://i.imgur.com/L7kp0Qj.jpg', filter:'opacity(60%)', size:1 },
            'select-HL2 Tile #2':                     { url:'https://i.imgur.com/3HMNxTA.jpg', filter:'opacity(60%)', size:1 },
            'select-HL2 Tile #3':                     { url:'https://i.imgur.com/JWZPXAp.jpg', filter:'opacity(60%)', size:1 },
            'select-HL2 Tile #4':                     { url:'https://i.imgur.com/J6WGdFi.jpg', filter:'opacity(60%)', size:1 }, //0.3125
            'select-HL2 Tile #5':                     { url:'https://i.imgur.com/xvZtLsb.jpg', filter:'opacity(60%)', size:1 }, //0.625
            'select-HL2 Tile #6':                     { url:'https://i.imgur.com/2djhQKQ.jpg', filter:'opacity(60%)', size:1 },
            'select-HL2 Tile #7':                     { url:'https://i.imgur.com/sRT2aXD.jpg', filter:'opacity(60%)', size:1 },
            'select-HL2 Tile #8':                     { url:'https://i.imgur.com/xFAqPRG.jpg', filter:'opacity(60%)', size:1 },
            'select-HL2 Tile #9':                     { url:'https://i.imgur.com/u7PIXYZ.jpg', filter:'opacity(60%)', size:1 },
            'select-HL2 Tile #10':                    { url:'https://i.imgur.com/MYQyHHp.jpg', filter:'opacity(60%)', size:1 },
            'select-HL2 Tile #11':                    { url:'https://i.imgur.com/ENW1ddR.jpg', filter:'opacity(60%)', size:1 },
            'select-HL2 Tile #12':                    { url:'https://i.imgur.com/yX5cfiS.jpg', filter:'opacity(60%)', size:1 },
            'select-HL2 Tile #13':                    { url:'https://i.imgur.com/BTAONgc.jpg', filter:'opacity(60%)', size:1 },
            'select-HL2 Tile #14':                    { url:'https://i.imgur.com/gkTU3Mj.jpg', filter:'opacity(60%)', size:1 },
            'select-HL2 Tile #15':                    { url:'https://i.imgur.com/QQr6HjP.jpg', filter:'opacity(60%)', size:1 },
            'select-HL2 Tile #16':                    { url:'https://i.imgur.com/yIzo7AF.jpg', filter:'opacity(60%)', size:1 },
            'select-HL2 Tile #17':                    { url:'https://i.imgur.com/U2VJs63.jpg', filter:'opacity(60%)', size:1 },
            'select-HL2 Tile #18':                    { url:'https://i.imgur.com/aqRSiTf.jpg', filter:'opacity(60%)', size:1 },
            'select-HL2 Concrete #7':                 { url:'https://i.imgur.com/AvQYwnm.jpg', filter:'opacity(60%)', size:1 },
            'select-HL2 Concrete #11':                { url:'https://i.imgur.com/YiZAtY0.jpg', filter:'opacity(60%)', size:1 },
            'select-HL2 Brick #5':                    { url:'https://i.imgur.com/JtPcmPN.jpg', filter:'opacity(60%)', size:1 },
            'select-HL2 Metal #1':                    { url:'https://i.imgur.com/BrCISq0.jpg', filter:'opacity(60%)', size:1 },
            'select-HL2 Metal #2':                    { url:'https://i.imgur.com/GuAOc42.jpg', filter:'opacity(60%)', size:1 },
            'select-HL2 Metal #3':                    { url:'https://i.imgur.com/pnBQm6Q.jpg', filter:'opacity(60%)', size:1 },
            'select-HL2 Metal #4':                    { url:'https://i.imgur.com/drFxYDr.jpg', filter:'opacity(60%)', size:1 },
            'select-HL2 Metal #5':                    { url:'https://i.imgur.com/S4o85r1.jpg', filter:'opacity(60%)', size:1 },
            'select-HL2 Metal #6':                    { url:'https://i.imgur.com/OK4UDYp.jpg', filter:'opacity(60%)', size:1 },
            'select-HL2 Metal #7':                    { url:'https://i.imgur.com/JHwmVJO.jpg', filter:'opacity(60%)', size:1 },
            'select-HL2 Metal #8':                    { url:'https://i.imgur.com/b48ALlD.jpg', filter:'opacity(60%)', size:1 },
            'select-HL2 Metal #9':                    { url:'https://i.imgur.com/Zf9o7oQ.jpg', filter:'opacity(60%)', size:1 },
            'select-HL2 Metal #10':                   { url:'https://i.imgur.com/XNReFkg.jpg', filter:'opacity(60%)', size:1 },
            'select-HL2 Metal #11':                   { url:'https://i.imgur.com/mFEYcdu.jpg', filter:'opacity(60%)', size:1 },
            'select-HL2 Metal #12':                   { url:'https://i.imgur.com/lKI7DTq.jpg', filter:'opacity(60%)', size:1 },
            'select-HL2 Metal #14':                   { url:'https://i.imgur.com/AhU5Hbk.jpg', filter:'opacity(60%)', size:1 },
            'select-HL2 Metal #15':                   { url:'https://i.imgur.com/xivP2g3.jpg', filter:'opacity(60%)', size:1 },
            'select-HL2 Roof #12':                    { url:'https://i.imgur.com/w4FPSTS.jpg', filter:'opacity(60%)', size:1 },
            'select-HL2 Asphalt #3':                  { url:'https://i.imgur.com/zxqPcRU.jpg', filter:'opacity(60%)', size:1 },
            'select-HL2 Asphalt #7':                  { url:'https://i.imgur.com/BQKudWz.jpg', filter:'opacity(60%)', size:1 },
            'select-HL2 Asphalt #10':                 { url:'https://i.imgur.com/yQERtfX.jpg', filter:'opacity(60%)', size:1 },
            'select-HL2 Asphalt #14':                 { url:'https://i.imgur.com/bsaySzG.jpg', filter:'opacity(60%)', size:1 },
            'select-HL2 Earth #4':                    { url:'https://i.imgur.com/qpwj0cs.jpg', filter:'opacity(60%)', size:1 },
            'select-HL2 Gravel #3':                   { url:'https://i.imgur.com/67r5mw0.jpg', filter:'opacity(60%)', size:1 },
            'select-HL2 Ground #2':                   { url:'https://i.imgur.com/RAJUJTT.jpg', filter:'opacity(60%)', size:1 },
            'select-HL2 Ground #4':                   { url:'https://i.imgur.com/qw8QMgv.jpg', filter:'opacity(60%)', size:1 },
            'select-HL2 Sand #14':                    { url:'https://i.imgur.com/eBkkdWN.jpg', filter:'opacity(60%)', size:1 },
            'select-HL2 Plaster #3':                  { url:'https://i.imgur.com/560lkwg.jpg', filter:'opacity(60%)', size:1 },
            'select-HL2 Plaster #4':                  { url:'https://i.imgur.com/WDnHyVx.jpg', filter:'opacity(60%)', size:1 },
            'select-HL2 Plaster #6':                  { url:'https://i.imgur.com/YFfUl9r.jpg', filter:'opacity(60%)', size:1 },
            'select-HL2 Rock #13':                    { url:'https://i.imgur.com/1cS52hs.jpg', filter:'opacity(60%)', size:1 },
            'select-HL2 Rock #14':                    { url:'https://i.imgur.com/d3ZAOVa.jpg', filter:'opacity(60%)', size:1 },
            'select-DvA Tiles #3':                    { url:'https://i.imgur.com/SIxEgME.png', filter:'opacity(50%)', size:0.5 },
            'select-Cracked Ice':                     { url:'https://i.imgur.com/p8ss5iu.jpg', filter:'opacity(50%)', size:1 },
            'select-Icy #1':                          { url:'https://i.imgur.com/Qr65jS9.jpg', filter:'opacity(50%)', size:1 },
            'select-Icy #2':                          { url:'https://i.imgur.com/Tj7GrTE.jpg', filter:'opacity(50%)', size:1 },
            'select-Rusty Plate':                     { url:'https://i.imgur.com/7vm2y2S.jpg', filter:'opacity(50%)', size:1 },
            'select-Cartoony Tiles':                  { url:'https://i.imgur.com/0jT7xPd.jpg', filter:'opacity(50%)', size:1 },
            'select-Cartoony Grass Tiles':            { url:'https://i.imgur.com/O4MmMUe.jpg', filter:'opacity(50%)', size:1 },
            'select-Cartoony Large Tiles':            { url:'https://i.imgur.com/6GHsXTH.jpg', filter:'opacity(50%)', size:1 },
            'select-Cartoony Block Tiles #1':         { url:'https://i.imgur.com/S1WQVMY.jpg', filter:'opacity(50%)', size:1 },
            'select-Cartoony Block Tiles #2':         { url:'https://i.imgur.com/NQDrfPb.jpg', filter:'opacity(50%)', size:1 },
            'select-Cartoony Tiles #2':               { url:'https://i.imgur.com/2ygfkgo.jpg', filter:'opacity(50%)', size:1 },
            'select-Cartoony Tiles #3':               { url:'https://i.imgur.com/xiQCzhK.jpg', filter:'opacity(80%)', size:1 },
            'select-Atlas Academy':                   { url:'https://i.imgur.com/WVJ94Io.jpg', filter:'opacity(80%)', size:1 },
            'select-Hexes #6':                        { url:'https://i.imgur.com/b1mSf5h.jpg', filter:'opacity(50%)', size:1 },

        }, patterns: {
            'select-Cracks':                          { url:'https://i.imgur.com/iVBA4Mh.png', filter:'opacity(20%) saturate(0%)', size:0.75 },
            'select-Large Cracks':                    { url:'https://i.imgur.com/KnyWWPm.png', filter:'opacity(20%) saturate(0%)', size:0.75 },
            'select-Hexes':                           { url:'https://i.imgur.com/h8ZZBar.png', filter:'opacity(35%) saturate(0%)', size:0.75 },
            'select-Ripples':                         { url:'https://i.imgur.com/AWH4YOw.png', filter:'opacity(25%) saturate(0%)', size:1 },
            'select-Crinkle #1':                      { url:'https://i.imgur.com/ds4Geee.png', filter:'opacity(30%) saturate(0%)', size:1 },
            'select-Crinkle #2':                      { url:'https://i.imgur.com/dmG3wCE.png', filter:'opacity(10%) saturate(0%)', size:1 },
            'select-Stone':                           { url:'https://i.imgur.com/dmUN4jU.png', filter:'opacity(25%) saturate(0%)', size:1 },
            'select-Rocks':                           { url:'https://i.imgur.com/HWsz7ws.png', filter:'opacity(25%) saturate(0%)', size:1 },
            'select-Moon':                            { url:'https://i.imgur.com/nmuo0MA.png', filter:'opacity(25%) saturate(0%)', size:1 },
            'select-Small Swirls':                    { url:'https://i.imgur.com/yjxCUnM.png', filter:'opacity(50%) saturate(0%)', size:1 },
            'select-Large Swirls':                    { url:'https://i.imgur.com/FzsRS82.png', filter:'opacity(25%) saturate(0%)', size:1 },
            'select-CrissxCross':                     { url:'https://i.imgur.com/MOGf8xz.png', filter:'opacity(100%) saturate(0%)', size:1 },
            'select-Graphy':                          { url:'https://i.imgur.com/juAjF3Z.png', filter:'opacity(80%) saturate(0%)', size:1 },
            'select-Stucco':                          { url:'https://i.imgur.com/86I6VL6.png', filter:'opacity(100%) saturate(0%)', size:1 },
            'select-Wall4':                           { url:'https://i.imgur.com/Z6iGoc0.png', filter:'opacity(100%) saturate(0%)',  size:1 },
            'select-Diamond':                         { url:'https://i.imgur.com/hxfybwo.png', filter:'opacity(25%) saturate(0%)', size:1 },
            'select-Diamond Plate':                   { url:'https://i.imgur.com/55DkQ8w.png', filter:'opacity(50%) saturate(0%)', size:0.5 },
            'select-Cracks 2':                        { url:'https://i.imgur.com/u9bxdJP.png', filter:'opacity(45%) saturate(0%)', size:1 },
            'select-Hexes 3':                         { url:'https://i.imgur.com/Hsb4NXA.png', filter:'opacity(25%) saturate(0%)', size:1 },
            'select-Rust':                            { url:'https://i.imgur.com/CUyHclO.jpg', filter:'opacity(40%)', size:1 },
            'select-Warble':                          { url:'https://i.imgur.com/agDb3VO.png', filter:'opacity(30%)', size:1 },
            'select-Diagonal Bumps':                  { url:'https://i.imgur.com/H506yGi.png', filter:'opacity(25%) saturate(0%)', size:0.5 },
            'select-Diagonal Lines':                  { url:'https://i.imgur.com/I0TdkMF.png', filter:'opacity(35%) saturate(0%)', size:1 },
            'select-Worn Squares':                    { url:'https://i.imgur.com/tdWd8mV.png', filter:'opacity(40%) saturate(0%)', size:0.6 },
            'select-Square Stone':                    { url:'https://i.imgur.com/IVMe6tW.png', filter:'opacity(50%) saturate(0%)', size:2 },
            'select-Tech Pattern':                    { url:'https://i.imgur.com/5xhUTPM.png', filter:'opacity(40%) saturate(0%)', size:0.4 },
            'select-Cobweb':                          { url:'https://i.imgur.com/OsDHU9O.png', filter:'opacity(40%)', size:0.3 },
            'select-Cracks 1':                        { url:'https://i.imgur.com/XcIJIGJ.png', filter:'opacity(50%) invert(100%)', size:0.8 },
            'select-Circles':                         { url:'https://i.imgur.com/rN8sQjk.jpg', filter:'opacity(30%) saturate(0%)', size:0.2 },
            'select-Scribbles':                       { url:'https://i.imgur.com/4aQlwdd.jpg', filter:'opacity(20%)', size:1 },
            'select-Rain #1':                         { url:'https://i.imgur.com/wJtBlHF.jpg', filter:'opacity(30%)', size:1 },
            'select-Rain #2':                         { url:'https://i.imgur.com/oaV9gW1.jpg', filter:'opacity(50%)', size:0.5 },
            'select-Fractal #1':                      { url:'https://i.imgur.com/UvjHKSx.jpg', filter:'opacity(20%)', size:1 },
            'select-Grey Abstract':                   { url:'https://i.imgur.com/XglIOL8.png', filter:'opacity(50%) saturate(0%)', size:1 },
            'select-Cracks 2':                        { url:'https://i.imgur.com/L98rOLB.png', filter:'opacity(70%)', size:0.6 },
            'select-Glass Shards':                    { url:'https://i.imgur.com/VYhDLZi.png', filter:'opacity(60%)', size:0.6 },
            'select-Water Drops':                     { url:'https://i.imgur.com/XuFz6JD.png', filter:'opacity(70%)', size:0.8 },
            'select-Sparkle Lines':                   { url:'https://i.imgur.com/Q5j7AS2.png', filter:'opacity(40%)', size:0.4 },
            'select-Aurora':                          { url:'https://i.imgur.com/WOS5HNF.jpg', filter:'opacity(40%)', size:0.8 },
            'select-Stars':                           { url:'https://i.imgur.com/mkOOlWY.png', filter:'opacity(50%) saturate(0)', size:0.7 },
            'select-JoJo Glass #9':                   { url:'https://i.imgur.com/ghhe7fG.jpg', filter:'opacity(75%) saturate(0)', size:1 },
            'select-JoJo Glass #22':                  { url:'https://i.imgur.com/gO985LR.jpg', filter:'opacity(75%) saturate(0)', size:1 },
            'select-Swirly Shards':                   { url:'https://i.imgur.com/HbHI7jF.jpg', filter:'opacity(75%)', size:0 },

            //team...
            'select-Leather':                         { url:'https://i.imgur.com/4mAoi3N.png', filter:'opacity(20%) saturate(0%)', size:0.5 },
            'select-Bumps':                           { url:'https://i.imgur.com/Svphszd.png', filter:'opacity(20%) saturate(0%)', size:0.25 },
            'select-Angled Pattern':                  { url:'https://i.imgur.com/A75wfny.png', filter:'opacity(15%) saturate(0%)', size:0.6 },
            'select-Tech Pattern':                    { url:'https://i.imgur.com/rRzVufi.png', filter:'opacity(25%) saturate(0%)', size:0.5 },
            'select-Metal Floorplate':                { url:'https://i.imgur.com/4zC6wuP.png', filter:'opacity(40%) saturate(0%)', size:0.125 },
            'select-Triangles':                       { url:'https://i.imgur.com/mv1F2dp.png', filter:'opacity(15%) saturate(0%)', size:0.6 },
            'select-Shiny Pattern':                   { url:'https://i.imgur.com/d8jbPp1.png', filter:'opacity(40%) saturate(0%)', size:1 },
            'select-Diagonal Pattern':                { url:'https://i.imgur.com/I0TdkMF.png', filter:'opacity(25%) saturate(0%)', size:1 },
            'select-Bubbles':                         { url:'https://i.imgur.com/Emn8TOL.png', filter:'opacity(75%) saturate(0%)', size:.6 },
            'select-Crackles':                        { url:'https://i.imgur.com/6N96iC0.png', filter:'opacity(35%) saturate(0%)', size:.75 },
            'select-Sparkles #1':                     { url:'https://i.imgur.com/Mt2bZKl.png', filter:'opacity(30%) saturate(0%)', size:1 },
            'select-Sparkles #2':                     { url:'https://i.imgur.com/w3lvISP.png', filter:'opacity(20%) saturate(0%)', size:1 }, //
            'select-Lightning #1':                    { url:'https://i.imgur.com/0t8iJf0.png', filter:'opacity(35%) saturate(0%)', size:1 }, //
            'select-Lightning #2':                    { url:'https://i.imgur.com/vKdtHOa.png', filter:'opacity(25%) saturate(0%)', size:1 }, //
            'select-Gun Metal':                       { url:'https://i.imgur.com/FPNMvDX.png', filter:'opacity(80%) saturate(0%)', size:1 },
            'select-Dots #1':                         { url:'https://i.imgur.com/icihwh9.png', filter:'opacity(40%) saturate(0)', size:1 },
            'select-Dots #3':                         { url:'https://i.imgur.com/5mazxB7.png', filter:'opacity(40%) saturate(0)', size:.4 },
            'select-Bright Dots':                     { url:'https://i.imgur.com/sR0SSeZ.jpg', filter:'opacity(50%) saturate(0)', size:1 },
            'select-Rain #3':                         { url:'https://i.imgur.com/yXa281T.jpg', filter:'opacity(30%) saturate(0)', size:1 },
            'select-Rain #4':                         { url:'https://i.imgur.com/Ni5SUYl.png', filter:'opacity(30%) saturate(0)', size:0.8 },
            'select-Hexellence':                      { url:'https://i.imgur.com/NtWwGQU.png', filter:'opacity(100%) saturate(0%)', size:1 },
            'select-Fog':                             { url:'https://i.imgur.com/CRiD00Q.png', filter:'opacity(60%) saturate(0)', size:1 },
            'select-Sparklers':                       { url:'https://i.imgur.com/PM8sch8.png', filter:'opacity(60%) saturate(0)', size:1 },
            'select-Eek':                             { url:'https://i.imgur.com/TU8ft5U.png', filter:'opacity(60%) saturate(0)', size:1 },
            'select-Holes':                           { url:'https://i.imgur.com/GBx2M3f.png', filter:'opacity(20%) saturate(0%)', size:0.4 },
            'select-Diagonal Stripes 2':              { url:'https://i.imgur.com/QcYxDj5.jpg', filter:'opacity(50%) saturate(0%)', size:1 },
            'select-Diagonal Stripes 3':              { url:'https://i.imgur.com/rQUdR4g.jpg', filter:'opacity(50%) saturate(0%)', size:1 },
            'select-HtoBS #2':                        { url:'https://i.imgur.com/6jc3n1I.jpg', filter:'opacity(40%) saturate(0)', size:0.15625 },

            //endzone...
            'select-Carbon Fibre':                    { url:'https://i.imgur.com/Ye7V4OG.png', filter:'opacity(90%) saturate(0%)', size:1 },
            'select-Small Diagonal Checks':           { url:'https://i.imgur.com/EY1YM5D.jpg', filter:'opacity(100%) saturate(0%)', size:1 },
            'select-Large Diagonal Checks':           { url:'https://i.imgur.com/3DPyEdr.png', filter:'opacity(25%) saturate(0%)', size:0.8 },
            'select-Small Random Checks':             { url:'https://i.imgur.com/VOqzUP3.png', filter:'opacity(100%) saturate(0%)', size:1 },
            'select-Medium Random Checks':            { url:'https://i.imgur.com/Eyn93az.png', filter:'opacity(100%) saturate(0%)', size:1 },
            'select-Diagonal Lines':                  { url:'https://i.imgur.com/mMK6rd5.png', filter:'opacity(20%) saturate(0%)', size:1 },
            'select-Spaced Diagonal Lines':           { url:'https://i.imgur.com/py1AYki.png', filter:'opacity(25%) saturate(0%)', size:1 },
            'select-Small Checks':                    { url:'https://i.imgur.com/Zd0mJK7.png', filter:'opacity(40%) saturate(0%)', size:1 },
            'select-Criss Cross Pattern':             { url:'https://i.imgur.com/mSyGafG.png', filter:'opacity(20%) saturate(0%)', size:1 },
            'select-Joined Squares':                  { url:'https://i.imgur.com/2QgKUaf.png', filter:'opacity(25%) saturate(0%)', size:0.5 },
            'select-Joined Circles':                  { url:'https://i.imgur.com/fmCFpbT.png', filter:'opacity(25%) saturate(0%)', size:1 },
            'select-Moroccan':                        { url:'https://i.imgur.com/5sWY3nV.png', filter:'opacity(25%) saturate(0%)', size:1 },
            'select-Tartan':                          { url:'https://i.imgur.com/k0kGc9P.png', filter:'opacity(25%) saturate(0%)', size:0.5 },
            'select-Jigsaw':                          { url:'https://i.imgur.com/eQhKaA0.png', filter:'opacity(25%) saturate(0%)', size:1 },
            'select-Stars':                           { url:'https://i.imgur.com/aTdxbHQ.png', filter:'opacity(25%) saturate(0%)', size:1 },
            'select-Squares 1':                       { url:'https://i.imgur.com/Zul9gLx.png', filter:'opacity(50%) saturate(0%)', size:0.8 },
            'select-Rotated Checker':                 { url:'https://i.imgur.com/UlAiP6D.jpg', filter:'opacity(50%) saturate(0%)', size:0.7 },
            'select-Diagonal Stripes 1':              { url:'https://i.imgur.com/k93bkrI.jpg', filter:'opacity(50%) saturate(0%)', size:0.4 },
            'select-Diagonal Pattern':                { url:'https://i.imgur.com/GHvLZzZ.jpg', filter:'opacity(50%) saturate(0%)', size:1 },
            'select-Flag':                            { url:'https://i.imgur.com/2tSzrKY.jpg', filter:'opacity(50%) saturate(0%)', size:0.5 },
            'select-DBlocks':                         { url:'https://i.imgur.com/q6NLBfa.jpg', filter:'opacity(50%) saturate(0%)', size:1 },
            'select-HexDither':                       { url:'https://i.imgur.com/eRXLm4e.jpg', filter:'opacity(50%) saturate(0%)', size:1 },
            'select-ParaHex':                         { url:'https://i.imgur.com/7m17UZd.jpg', filter:'opacity(50%) saturate(0%)', size:1 },
            'select-FoamPadding':                     { url:'https://i.imgur.com/Ytsbeut.jpg', filter:'opacity(50%) saturate(0%)', size:1 },
            'select-Abstract Squares #1':             { url:'https://i.imgur.com/1Okbn0x.jpg', filter:'opacity(50%) saturate(0%)', size:1 },
            'select-Abstract Squares #2':             { url:'https://i.imgur.com/ETWnSb5.jpg', filter:'opacity(50%) saturate(0%)', size:1 },
            'select-Matrix':                          { url:'https://i.imgur.com/ox4KNTa.jpg', filter:'opacity(50%) saturate(0%)', size:1 },


        }, blurs: {
            'select-Colorful':                        { url:'https://i.imgur.com/ESSRqxr.png', filter:'opacity(60%)', size:1 },
            'select-Cloudy':                          { url:'https://i.imgur.com/RxKzBaq.jpg', filter:'opacity(50%) saturate(0%)', size:1 },
            'select-RoL S5E':                         { url:'https://i.imgur.com/KhMaJab.jpg', filter:'opacity(80%)', size:0 },
            'select-RoL H5':                          { url:'https://i.imgur.com/Yc8cJrN.jpg', filter:'opacity(80%)', size:0 },
            'select-RoL H6':                          { url:'https://i.imgur.com/Yv5LAkw.jpg', filter:'opacity(80%)', size:0 },
            'select-RoL H7':                          { url:'https://i.imgur.com/sZgRMmx.jpg', filter:'opacity(80%)', size:0 },
            'select-RoL H7E':                         { url:'https://i.imgur.com/fLEJOC2.jpg', filter:'opacity(80%)', size:0 },
            'select-RoL H10':                         { url:'https://i.imgur.com/3TSnXRN.jpg', filter:'opacity(80%)', size:0 },
            'select-RoL H19':                         { url:'https://i.imgur.com/NuzcM79.jpg', filter:'opacity(80%)', size:0 },
            'select-RoL H20':                         { url:'https://i.imgur.com/eurMute.jpg', filter:'opacity(80%)', size:0 },
            'select-RoL S5':                          { url:'https://i.imgur.com/f9TPXkm.jpg', filter:'opacity(80%)', size:0 },
            'select-Warm Machine #1':                 { url:'https://i.imgur.com/4Q3EvnQ.jpg', filter:'opacity(80%)', size:0 },
            'select-Warm Machine #2':                 { url:'https://i.imgur.com/k1OKvqB.jpg', filter:'opacity(80%)', size:0 },
            'select-Warm Machine #3':                 { url:'https://i.imgur.com/nIxfGxD.jpg', filter:'opacity(80%)', size:0 },
            'select-Warm Machine #5':                 { url:'https://i.imgur.com/02ByzRf.jpg', filter:'opacity(80%)', size:0 },
            'select-Warm Machine #6':                 { url:'https://i.imgur.com/KKQlqI0.jpg', filter:'opacity(80%)', size:0 },
            'select-Warm Machine #7':                 { url:'https://i.imgur.com/XzPHTfU.jpg', filter:'opacity(80%)', size:0 },
            'select-Warm Machine #8':                 { url:'https://i.imgur.com/iDcibPd.jpg', filter:'opacity(80%)', size:0 },
            'select-Benji3o3 Clouds #16':             { url:'https://i.imgur.com/GiRLH4r.jpg', filter:'opacity(80%)', size:0 },
            'select-jadereality #13':                 { url:'https://i.imgur.com/c9KFnOF.jpg', filter:'opacity(80%)', size:0 },
            'select-sirius sdz #836':                 { url:'https://i.imgur.com/SyyLQU3.jpg', filter:'opacity(80%)', size:0 },
            'select-sirius sdz #770':                 { url:'https://i.imgur.com/PLL6ce5.jpg', filter:'opacity(80%)', size:1 },
            'select-DvA Dark Webs':                   { url:'https://i.imgur.com/EUv5bD6.jpg', filter:'opacity(65%)', size:1 },
            'select-JoJo Blur #10':                   { url:'https://i.imgur.com/op31hwK.jpg', filter:'opacity(80%)', size:1 },
            'select-JoJo Blur #17':                   { url:'https://i.imgur.com/KtZLHUI.jpg', filter:'opacity(80%)', size:1 },
            'select-JoJo Blur #37':                   { url:'https://i.imgur.com/he1ldtK.jpg', filter:'opacity(80%)', size:1 },
            'select-Spectrum Blur':                   { url:'https://i.imgur.com/0XbsaBx.jpg', filter:'opacity(80%)', size:0 },
            'select-Icy Blur':                        { url:'https://i.imgur.com/cEg7W4l.jpg', filter:'opacity(80%)', size:0 },
            'select-Rainy Afternoon Blur':            { url:'https://i.imgur.com/uzUUFOq.jpg', filter:'opacity(80%)', size:0 },
            'select-Vardo Blur':                      { url:'https://i.imgur.com/IIhIxFv.jpg', filter:'opacity(80%)', size:0 },
            'select-Dark Neon Blur':                  { url:'https://i.imgur.com/4KaaNa1.jpg', filter:'opacity(80%)', size:0 },
            'select-M4tchb0x Blur':                   { url:'https://i.imgur.com/LUbdc7W.jpg', filter:'opacity(80%)', size:0 },
            'select-Galaxies Blur':                   { url:'https://i.imgur.com/S5G95Us.jpg', filter:'opacity(80%)', size:0 },

        }, texture_floor1: {
        }, texture_floor2: {
        }, texture_floor3: {
        }, texture_team: {
        }, texture_endzone: {
        }, texture_walls1: { //
        }, texture_walls2: {

        }, texture_base: { //base circle images should be red (will be changed to blue/yellow) or greyscale
            'select-Spiral':                          { url:'https://i.imgur.com/RKnIxci.png', filter:'opacity(25%)', xOffset:0, yOffset:0, size:1 },
            'select-Base':                            { url:'https://i.imgur.com/6SyICNF.png', filter:'opacity(20%)', xOffset:0, yOffset:0, size:0.75 },
            'select-Base #2':                         { url:'https://i.imgur.com/CcjHcfe.png', filter:'opacity(20%)', xOffset:0, yOffset:0, size:0.65 },
            'select-Glow Circle':                     { url:'https://i.imgur.com/jzE7u1M.png', filter:'opacity(70%)', xOffset:0, yOffset:0, size:0.8 },
            'select-Dragon':                          { url:'https://i.imgur.com/QZeByH6.png', filter:'opacity(40%)', xOffset:0, yOffset:0, size:1 },
            'select-Bat':                             { url:'https://i.imgur.com/B1JIaUd.png', filter:'opacity(40%)', xOffset:0, yOffset:0, size:1 },
            'select-Skull':                           { url:'https://i.imgur.com/bmvqc8c.png', filter:'opacity(40%)', xOffset:0, yOffset:0, size:1 },
            'select-Glow #1':                         { url:'https://i.imgur.com/2B9dMH1.png', filter:'opacity(40%)', xOffset:0, yOffset:0, size:1 },
            'select-Glow #2':                         { url:'https://i.imgur.com/Plz1adO.png', filter:'opacity(30%)', xOffset:0, yOffset:0, size:1 },
            'select-Spiral Swirl':                    { url:'https://i.imgur.com/zHzOPME.png', filter:'opacity(30%)', xOffset:0, yOffset:0, size:1 },
            'select-Portal':                          { url:'https://i.imgur.com/HTLzvVX.png', filter:'opacity(10%)', xOffset:0, yOffset:0, size:1.51 },
            'select-Glow Ring':                       { url:'https://i.imgur.com/ETfjhCF.png', filter:'opacity(40%)', xOffset:0, yOffset:0, size:1 },
            'select-Circles #3':                      { url:'https://i.imgur.com/qX6vboT.png', filter:'opacity(50%)', xOffset:0, yOffset:0, size:1 },
            'select-Circles #4':                      { url:'https://i.imgur.com/2mGOoF8.png', filter:'opacity(30%) blur(2px)', xOffset:0, yOffset:0, size:0.75 },
            'select-Tarantula':                       { url:'https://i.imgur.com/V6yJ0IC.png', filter:'opacity(40%)', xOffset:0, yOffset:0, size:1 },
            'select-Tri-Circle':                      { url:'https://i.imgur.com/oxVX7pd.png', filter:'opacity(40%)', xOffset:0, yOffset:0, size:1 },
            'select-Crossbones':                      { url:'https://i.imgur.com/FbBXXwZ.png', filter:'opacity(40%)', xOffset:0, yOffset:0, size:0.75 },
            'select-Anarchy':                         { url:'https://i.imgur.com/rfcsZoA.png', filter:'opacity(20%)', xOffset:0, yOffset:5, size:1.2 },
            'select-Jedi Order':                      { url:'https://i.imgur.com/oEGE2nj.png', filter:'opacity(40%)', xOffset:5, yOffset:-100, size:0.75 },
            'select-Galactic Empire':                 { url:'https://i.imgur.com/0kHosuO.png', filter:'opacity(40%)', xOffset:0, yOffset:0, size:1 },
            'select-Sith Empire':                     { url:'https://i.imgur.com/55Fn7hl.png', filter:'opacity(40%)', xOffset:0, yOffset:0, size:1 },
            'select-Vader':                           { url:'https://i.imgur.com/Gc8CVUC.png', filter:'opacity(40%)', xOffset:0, yOffset:0, size:0.75 },
            'select-Military Star':                   { url:'https://i.imgur.com/XqW4Phi.png', filter:'opacity(40%)', xOffset:0, yOffset:0, size:1 },
            'select-Glow Cross':                      { url:'https://i.imgur.com/GXSXRMR.png', filter:'opacity(60%)', xOffset:6, yOffset:0, size:1 },
            'select-Circle Ridge':                    { url:'https://i.imgur.com/nRqxXs6.png', filter:'opacity(25% saturate(0))', xOffset:0, yOffset:0, size:1 },
            'select-Pentagram':                       { url:'https://i.imgur.com/tpLizjA.png', filter:'opacity(30%) saturate(0)', xOffset:10, yOffset:10, size:1 },
            'select-Nautical':                        { url:'https://i.imgur.com/oOWCSvb.png', filter:'opacity(40%)', xOffset:0, yOffset:0, size:1 },
            'select-Pentagram #2':                    { url:'https://i.imgur.com/t3GQiQa.png', filter:'opacity(40%)', xOffset:0, yOffset:0, size:1 },
            'select-Narrow Star #1':                  { url:'https://i.imgur.com/2DBk3cX.png', filter:'opacity(40%)', xOffset:0, yOffset:0, size:1 },
            'select-Narrow Star #2':                  { url:'https://i.imgur.com/feGc4ye.png', filter:'opacity(20%)', xOffset:0, yOffset:0, size:1 },
            'select-Concentric':                      { url:'https://i.imgur.com/kA3AGGT.png', filter:'opacity(40%)', xOffset:9, yOffset:-7, size:1 },
            'select-Dr Who':                          { url:'https://i.imgur.com/vt3YHR0.png', filter:'opacity(40%)', xOffset:-10, yOffset:-26, size:1 },
            'select-Warble':                          { url:'https://i.imgur.com/OZUqqXj.png', filter:'opacity(30%)', xOffset:-10, yOffset:20, size:1 },
            'select-Atom':                            { url:'https://i.imgur.com/RxxLf3Q.png', filter:'opacity(30%)', xOffset:-18, yOffset:-23, size:1 },
            'select-Claw':                            { url:'https://i.imgur.com/EZoFhNq.png', filter:'opacity(20%)', xOffset:0, yOffset:0, size:1 },
            'select-Claw #2':                         { url:'https://i.imgur.com/CgNNFN1.png', filter:'opacity(20%)', xOffset:0, yOffset:0, size:1 },
            'select-Claw #3':                         { url:'https://i.imgur.com/LQ3tZLV.png', filter:'opacity(20%)', xOffset:0, yOffset:0, size:1 },
            'select-Claw #4':                         { url:'https://i.imgur.com/8i98NWX.png', filter:'opacity(20%)', xOffset:0, yOffset:0, size:1 },
            'select-Ironman':                         { url:'https://i.imgur.com/KCLgQ3E.png', filter:'opacity(20%)', xOffset:0, yOffset:0, size:1 },

        }, texture_logo_red: { //
            'select-ELTP-IQQ':                           { url:'https://i.imgur.com/rPNjhhX.png', filter:'opacity(20%)', xOffset:0, yOffset:0, size:1.3 },
            'select-ELTP-CBL':                           { url:'https://i.imgur.com/wrP5fxj.png', filter:'opacity(20%)', xOffset:0, yOffset:-10, size:0.4 },
            'select-ELTP-BMC':                            { url:'https://i.imgur.com/WvfcFN0.png', filter:'opacity(20%)', xOffset:0, yOffset:0, size:0.45 },
            'select-ELTP-COB':                            { url:'https://i.imgur.com/tr6YuDT.png', filter:'opacity(20%)', xOffset:0, yOffset:0, size:0.4 },
            'select-ELTP-HJS':                            { url:'https://i.imgur.com/p6MQviv.png', filter:'opacity(20%)', xOffset:0, yOffset:0, size:0.6 },
            'select-ELTP-TGC':                            { url:'https://i.imgur.com/3W7wtE7.png', filter:'opacity(20%)', xOffset:0, yOffset:0, size:0.15 },
            //'select-ELTP-DD':                             { url:'', filter:'opacity(20%)', xOffset:0, yOffset:0, size:0.4 },
            //'select-ELTP-TFA':                            { url:'', filter:'opacity(20%)', xOffset:0, yOffset:0, size:0.4 },
            'select-ELTP-TRS':                            { url:'https://i.imgur.com/2aCSTEi.png', filter:'opacity(20%)', xOffset:0, yOffset:0, size:0.85 },
            'select-ELTP-SMB':                            { url:'https://i.imgur.com/INzSSNi.png', filter:'opacity(20%)', xOffset:0, yOffset:0, size:0.50 },
            'select-ELTP-CPD':                            { url:'https://i.imgur.com/yX8UCJH.png', filter:'opacity(20%)', xOffset:37, yOffset:-26, size:0.2 },
            'select-ELTP-LVB':                            { url:'https://i.imgur.com/cPGfte8.png', filter:'opacity(20%)', xOffset:-1, yOffset:-98, size:0.8 },

            'select-OLTP-AYY':                            { url:'https://i.imgur.com/QjOhV3G.png', filter:'opacity(20%)', xOffset:0, yOffset:0, size:0.2 },
            'select-OLTP-C22':                            { url:'https://i.imgur.com/4TlfXGK.png', filter:'opacity(20%)', xOffset:0, yOffset:0, size:0.65 },
            'select-OLTP-TBF':                            { url:'https://i.imgur.com/DUeObpx.png', filter:'opacity(20%) blur(1px)', xOffset:0, yOffset:0, size:0.7 },
            'select-OLTP-CAP':                            { url:'https://i.imgur.com/XEXPWUb.png', filter:'opacity(20%)', xOffset:75, yOffset:-40, size:0.65 },
            'select-OLTP-NIP':                            { url:'https://i.imgur.com/L0FVB9a.png', filter:'opacity(20%)', xOffset:8, yOffset:-40, size:0.65 },
            'select-OLTP-PNK':                            { url:'https://i.imgur.com/NMPxI3v.png', filter:'opacity(20%)', xOffset:0, yOffset:0, size:1 },
            'select-OLTP-BGS':                            { url:'https://i.imgur.com/Qfluefk.png', filter:'opacity(20%)', xOffset:30, yOffset:0, size:0.8 },
            'select-OLTP-SLS':                            { url:'https://i.imgur.com/DtB0qpA.png', filter:'opacity(20%) saturate(50%) blur(2px)', xOffset:4, yOffset:-8, size:0.75 },
            'select-OLTP-THC':                            { url:'https://i.imgur.com/LUc5Wb8.png', filter:'opacity(20%)', xOffset:-20, yOffset:-10, size:0.55 },
            'select-OLTP-TGFP':                           { url:'https://i.imgur.com/erM9FgK.png', filter:'opacity(20%) saturate(50%) blur(1px)', xOffset:28, yOffset:0, size:0.4 },
            'select-OLTP-ROO':                            { url:'https://i.imgur.com/Ns7VhYt.png', filter:'opacity(20%)', xOffset:-2, yOffset:-32, size:1 },
            'select-OLTP-FLU':                            { url:'https://i.imgur.com/S8iTLhF.png', filter:'opacity(20%) saturate(50%) blur(1px)', xOffset:-4, yOffset:15, size:0.35 },

            'select-MLTP-M877':                           { url:'https://i.imgur.com/cq6De6o.png', filter:'opacity(20%)', xOffset:18, yOffset:-15, size:0.2 },
            'select-MLTP-MABO':                           { url:'https://i.imgur.com/2FoXKca.png', filter:'opacity(20%)', xOffset:0, yOffset:0, size:0.4 },
            'select-MLTP-MHGW':                           { url:'https://i.imgur.com/Y9ZXk4g.png', filter:'opacity(20%)', xOffset:0, yOffset:0, size:0.9 },
            'select-MLTP-MOD':                            { url:'https://i.imgur.com/ZVxT8NU.png', filter:'opacity(20%)', xOffset:0, yOffset:0, size:0.8 },
            'select-MLTP-MRKT':                           { url:'https://i.imgur.com/TkDH615.png', filter:'opacity(20%)', xOffset:23, yOffset:32, size:0.65 },
            'select-MLTP-MSPI':                           { url:'https://i.imgur.com/8MFbGQe.png', filter:'opacity(20%)', xOffset:0, yOffset:0, size:0.4 },
            'select-MLTP-MSPB':                           { url:'https://i.imgur.com/v9iYrSg.png', filter:'opacity(20%)', xOffset:0, yOffset:0, size:0.8 },
            //'select-MLTP-MS7J':                           { url:'', filter:'opacity(20%)', xOffset:0, yOffset:0, size:0.4 },

            //'select-mLTP-NGUY':                           { url:'', filter:'opacity(20%)', xOffset:0, yOffset:0, size:0.4 },
            'select-mLTP-NLMP':                           { url:'https://i.imgur.com/PYOHbUK.png', filter:'opacity(20%)', xOffset:0, yOffset:10, size:1.1 },
            //'select-mLTP-NBUB':                           { url:'', filter:'opacity(20%)', xOffset:0, yOffset:0, size:0.4 },
            'select-mLTP-NKCMC':                           { url:'https://media.discordapp.net/attachments/695433616913727519/831710914646376478/KCMClogo.png', filter:'opacity(20%)', xOffset:0, yOffset:0, size:1 },
            'select-mLTP-NSSC':                           { url:'https://i.imgur.com/C63KTHA.png', filter:'opacity(9%)', xOffset:0, yOffset:25, size:0.9 },
            'select-mLTP-NMBC':                           { url:'https://i.imgur.com/Q9tu0rQ.png', filter:'opacity(20%)', xOffset:0, yOffset:0, size:0.25 },
            'select-mLTP-NOTP':                           { url:'https://i.imgur.com/6tQ2FSw.png', filter:'opacity(20%)', xOffset:0, yOffset:-40, size:0.8 },
            'select-mLTP-NPIC':                           { url:'https://i.imgur.com/IFd2Jan.png', filter:'opacity(20%)', xOffset:0, yOffset:-20, size:1 },
            //'select-mLTP-NRMS':                           { url:'', filter:'opacity(20%)', xOffset:0, yOffset:0, size:0.4 },
            //'select-mLTP-NSNA':                           { url:'', filter:'opacity(20%)', xOffset:0, yOffset:0, size:0.4 },
            'select-mLTP-NDNO':                           { url:'https://i.imgur.com/BXnkQKc.png', filter:'opacity(20%)', xOffset:0, yOffset:0, size:0.45 },
            'select-mLTP-NYHT':                           { url:'https://i.imgur.com/AkBpJlJ.png', filter:'opacity(20%)', xOffset:6, yOffset:-65, size:0.85 },

            'select-NLTP-ADSB':                           { url:'https://i.imgur.com/8kJE1Ds.png', filter:'opacity(20%)', xOffset:4, yOffset:-25, size:0.8 },
            'select-NLTP-ALBT':                           { url:'https://i.imgur.com/OkmkBFg.png', filter:'opacity(20%)', xOffset:0, yOffset:0, size:0.5 },
            'select-NLTP-ABOH':                           { url:'https://i.imgur.com/XBjXiTZ.jpg', filter:'opacity(20%)', xOffset:0, yOffset:0, size:0.8 },
            'select-NLTP-ASOI':                           { url:'https://i.imgur.com/4swWGSa.png', filter:'opacity(20%)', xOffset:-25, yOffset:4, size:0.8 },
            'select-NLTP-ATAN':                           { url:'https://i.imgur.com/29gPkNy.png', filter:'opacity(20%)', xOffset:0, yOffset:0, size:0.9 },
            'select-NLTP-AMB8':                           { url:'https://i.imgur.com/eneo62n.png', filter:'opacity(20%)', xOffset:0, yOffset:0, size:0.8 },
            'select-NLTP-AABO':                           { url:'https://i.imgur.com/2FoXKca.png', filter:'opacity(20%)', xOffset:0, yOffset:0, size:0.4 },
            'select-NLTP-AOLD':                           { url:'https://i.imgur.com/DceHQqx.png', filter:'opacity(20%)', xOffset:0, yOffset:0, size:0.4 },
            'select-NLTP-ACCC':                           { url:'https://i.imgur.com/oWjcJCt.png', filter:'opacity(20%)', xOffset:0, yOffset:0, size:0.4 },
            'select-NLTP-AGUY':                           { url:'https://i.imgur.com/ZUWkhSw.png', filter:'opacity(20%)', xOffset:0, yOffset:0, size:0.4 },
            'select-NLTP-APOO':                           { url:'https://i.imgur.com/kjqLe1u.png', filter:'opacity(20%)', xOffset:0, yOffset:0, size:0.4 },
            'select-NLTP-ANIP':                           { url:'https://i.imgur.com/kcw3WYa.png', filter:'opacity(20%)', xOffset:0, yOffset:0, size:0.4 },

        }, texture_logo_blue: { //

        }, texture_center: {
            'select-TagPro Logo':                        { url:'https://i.imgur.com/G2h3WP5.png', filter:'opacity(20%) saturate(50%) blur(1px)', size:0.6 },
            'select-TagPro Logo #2':                     { url:'https://i.imgur.com/cIpth8S.png', filter:'opacity(20%) saturate(50%) blur(1px)', size:0.8 },
            'select-TagPro Logo #3':                     { url:'https://i.imgur.com/2y8767N.png', filter:'opacity(20%)', size:1 },
            'select-TagPro Logo #4':                     { url:'https://i.imgur.com/9X824eF.png', filter:'opacity(50%)', size:0.5 },
            'select-TagPro+':                     { url:'https://i.imgur.com/hSJUqCF.png', filter:'opacity(10%)' , size:0.5 },
            'select-TPM':                     { url:'https://i.imgur.com/yYjhtqp.png', filter:'opacity(20%)', size:0.99 },
            'select-KoalaBeast Logo':                    { url:'https://i.imgur.com/R6axQtK.png', filter:'opacity(20%) saturate(80%) blur(5px)', size:0.8 },
            'select-mELTP Logo':                        { url:'https://i.imgur.com/4RoNEEg.png', filter:'opacity(10%) saturate(50%) blur(1px)', size:0.6 },
            'select-ELTP Logo':                         { url:'https://i.imgur.com/BKA7pQg.png', filter:'opacity(10%) saturate(50%) blur(1px)', size:0.6 },
            'select-MLTP Logo':                          { url:'https://i.imgur.com/nRM5kmC.png', filter:'opacity(20%) saturate(50%) blur(1px)', size:0.8 },
            'select-NLTP Logo':                          { url:'https://i.imgur.com/RPd5NpZ.png', filter:'opacity(20%) saturate(50%) blur(1px)', size:0.75 },
            'select-OLTP Logo':                          { url:'https://i.imgur.com/UhOJ1zr.png', filter:'opacity(20%) saturate(50%) blur(1px)', size:1 },

        }, texture_ballskins: {
            'select-Skins':                              { url:'https://i.imgur.com/cIEsqfM.png', filter:'', xOffset:0, yOffset:0, size:1 }, //lyRe71V,nI66bo7

        }, background: { //add links here to use your own background images (change name to 'value-image#')...
            'value-Red/Blue #1': { url:'https://i.imgur.com/frr4yGb.jpg' },
            'value-Red/Blue #2': { url:'https://i.imgur.com/XVRglCB.jpg' },
            'value-Pink/Blue Circle': { url:'https://i.imgur.com/ZHIQwdA.jpg' },
            'value-Neon Shallows': { url:'https://i.imgur.com/NydUdaz.jpg' },
            'value-XFIA': { url:'https://i.imgur.com/SJ4nAao.jpg' },
            'value-Hive of Wonder': { url:'https://i.imgur.com/2KyAV3L.jpg' },
            'value-Celeste': { url:'https://i.imgur.com/61pxqh8.png' },
            'value-TagPro+': { url:'https://i.imgur.com/UDK5JNT.jpg' },

        }, preset: {
            'select-Checkered #1': {"background_color1":"#00ffff","background_color2":"#1e003c","background":"value-ellipse","plainfloor":true,"grid1_size":"40","grid1_square":true,"grid1_shadow":true,"checker1_size":"40","checker1_normal":true,"texture_floor2":"select-Abstract #1","texture_floor2_filter":"opacity(35%) saturate(40%)","plainteam":true,"texture_team":"select-Shiny Pattern","texture_team_filter":"opacity(40%) saturate(0%)","texture_team_size":"2.5","walloutline2_size":"1","walloutline3_size":"1","walls_filter":"drop-shadow(3px 3px 4px rgba(0,0,0,0.8)) brightness(75%)","texture_walls2":"select-Fractal #1","texture_walls2_filter":"opacity(20%) invert(100%) saturate(0) contrast(300%)","basecircle1_linewidth":"6","basecircle1_opacity":"0.4","basecircle1_blur":"1","basecircle1_dashpattern":"40,10","centerline_linewidth":"1","flagline_linewidth":"2","plainfloor_color":"#000000","checker1_color":"auto","plainteam_color_yellow":"#fff59d","walloutline2_color":"#424242","walloutline3_color":"#e0e0e0","texture_tiles":"https://i.imgur.com/vtgmsDB.png","texture_speedpad":"https://i.imgur.com/OLwHYUu.png","texture_speedpadRed":"https://i.imgur.com/zoJaXCx.png","texture_speedpadBlue":"https://i.imgur.com/wn5q6v6.png","texture_portal":"https://i.imgur.com/mQie8Sb.png","texture_splats":"https://i.imgur.com/bEPAfag.png","texture_gravityWell":""},
            'select-Checkered #2': {"background_color1":"#00ffff","background_color2":"#1e003c","background":"value-ellipse","plainfloor":true,"plainfloor_color_use":true,"checker1_size":"40","checker1_opacity":"0.07","checker1_random":true,"grid1_size":"40","grid1_opacity":"0.14","grid1_square":true,"grid1_shadow":true,"plainteam":true,"texture_team":"select-Benji3o3 Clouds #16","texture_team_filter":"opacity(60%) saturate(0)","texture_team_size":"0.35","texture_team_gco":"screen","plainendzone":true,"endzone_filter":"drop-shadow(0 0 1px black)","texture_endzone":"select-Rotated Checker","texture_endzone_filter":"opacity(40%)","texture_endzone_size":"0.4","walloutline2_size":"1","walls_filter":"drop-shadow(3px 3px 2px rgba(0,0,0,0.7))","texture_walls1":"select-Green Lightning","texture_walls1_filter":"opacity(35%) saturate(0%)","texture_walls1_gco":"hard-light","texture_walls2":"select-Metal","texture_walls2_filter":"opacity(45%) saturate(0%)","texture_walls2_gco":"hard-light","basecircle1_linewidth":"400","basecircle1_dashpattern":"1,209","balls_hole_radius":"12","ball_outline2":true,"ball_outline2_radius":"12","ball_outline2_opacity":"0.6","spikes_filter":"drop-shadow(1px 1px 2px rgba(0,0,0,0.6))","gate_shadows":true,"boosts_outline":true,"boosts_outline_opacity":"0.7","checker1_color":"#0a0f13","plainteam_color_yellow":"#fff59d","walloutline2_color":"#fafafa","boosts_outline_color_yellow":"#616161","texture_tiles":"/textures/element/tiles.png","texture_speedpad":"/textures/element/speedpad.png","texture_speedpadRed":"/textures/element/speedpadred.png","texture_speedpadBlue":"/textures/element/speedpadblue.png","texture_portal":"/textures/element/portal.png","texture_splats":"/textures/element/splats.png","texture_gravityWell":""},
            'select-Aurora': {"background_color1":"#c0c0c0","background":"value-ellipse","plainfloor":true,"plainfloor_color_use":true,"grid1_size":"40","grid1_opacity":"0.1","grid1_square":true,"grid1_shadow":true,"texture_floor1":"select-Abstract Aurora","texture_floor1_filter":"opacity(12%) brightness(125%) contrast(150%)","texture_floor2":"select-Dark Neon Blur","texture_floor2_filter":"opacity(40%)","teamtile_gradient":true,"texture_team":"select-Rain #3","texture_team_filter":"opacity(20%)","plainwalls":true,"wallshadow_size":"0","wallshadow_opacity":"0.75","wallshadow_outer":true,"walloutline2_size":"3","walloutline3_size":"1","texture_walls2":"select-Aurora","texture_walls2_filter":"opacity(50%) saturate(50%) brightness(75%)","texture_walls2_size":"0.6","basecircle1_linewidth":"6","basecircle1_opacity":"0.4","basecircle1_blur":"1","basecircle1_dashpattern":"40,10","spikes_generic":true,"bombs_filter":"drop-shadow(0 0 12px rgba(255, 153, 255, 0.5)) drop-shadow(0 0 5px #ff99ff)","bombs_outline":true,"gates_glow":true,"gates_glow_outline":true,"flags_glow":true,"flags_outline":true,"pups_glow":true,"pups_glow_outline":true,"boosts_outline":true,"boosts_outline_linewidth":"5","plainfloor_color":"#04070b","grid1_color":"#2c3e50","plainwalls_color":"#040406","walloutline2_color":"#0a0f16","walloutline3_color":"#abb2b9","texture_tiles":"https://i.imgur.com/pplCwkz.png","texture_speedpad":"https://i.imgur.com/nYWN39q.png","texture_speedpadRed":"https://i.imgur.com/od1IMLY.png","texture_speedpadBlue":"https://i.imgur.com/XlupLum.png","texture_portal":"https://i.imgur.com/Z8hLYxj.png","texture_splats":"https://i.imgur.com/kbkOC6x.png","texture_gravityWell":""},
            'select-Neon Glow': {"background_color1":"#c0c0c0","background":"value-ellipse","plainfloor":true,"plainfloor_color_use":true,"floor_filter":"brightness(50%)","plainteam":true,"teamtile_gradient":true,"teamtile_filter":"opacity(60%)","texture_team":"select-Diagonal Stripes 2","texture_team_filter":"opacity(50%) saturate(0%)","texture_team_size":"0.65","texture_team_gco":"hard-light","plainendzone":true,"texture_endzone":"select-Diagonal Pattern","texture_endzone_filter":"opacity(50%) saturate(0%)","texture_endzone_size":"0.5","texture_endzone_gco":"hard-light","plainwalls":true,"wallshadow_size":"0","wallshadow_blur":"4","wallshadow_opacity":"1","wallshadow_multiplier":"2","wallshadow_inner":true,"wallshadow_outer":true,"walloutline2_size":"3","basecircle1_linewidth":"6","basecircle1_opacity":"1","basecircle1_glow":"5","basecircle1_glow_multiplier":"3","basecircle1_dashpattern":"40,10","basecircle2_linewidth":"3","basecircle2_radius":"160","basecircle2_opacity":"1","basecircle2_glow":"5","basecircle2_glow_multiplier":"2","basecircle2_dashpattern":"20,8","centerline_linewidth":"1","centerline_opacity":"1","centerline_glow":"1","flagline_linewidth":"1","flagline_opacity":"1","flagline_glow":"1","spikes_generic":true,"spikes_filter":"drop-shadow(0px 0px 6px #ff5722)","bombs_outline":true,"bombs_filter":"drop-shadow(0 0 12px rgba(255, 153, 255, 0.5)) drop-shadow(0 0 5px #ff99ff)","gates_glow":true,"gates_glow_outline":true,"flags_outline":true,"flags_glow":true,"pups_glow":true,"pups_glow_outline":true,"boosts_outline":true,"plainfloor_color":"#0a0f16","plainwalls_color":"#040406","wallshadow_color":"#4527a0","walloutline2_color":"#ffffff","centerline_color":"#00ff00","flagline_color":"#00ff80","texture_tiles":"https://i.imgur.com/pplCwkz.png","texture_speedpad":"https://i.imgur.com/nYWN39q.png","texture_speedpadRed":"https://i.imgur.com/od1IMLY.png","texture_speedpadBlue":"https://i.imgur.com/XlupLum.png","texture_portal":"https://i.imgur.com/Z8hLYxj.png","texture_splats":"https://i.imgur.com/kbkOC6x.png","texture_gravityWell":""},
            'select-Doom': {"background_color1":"#00ffff","background_color2":"#ff00ff","background_size":"75","background_useballcolors":true,"background":"value-ellipse","plainfloor":true,"plainfloor_color_use":true,"floor_contour":true,"checker1_size":"40","checker1_opacity":"0.1","checker1_random":true,"texture_floor1":"select-RoL H6","texture_floor1_filter":"opacity(40%)","texture_floor1_size":"0","texture_floor1_gco":"hard-light","texture_floor2":"select-Bubbles & Swirls","texture_floor2_filter":"opacity(25%)","texture_floor3":"select-40px Random","texture_floor3_filter":"opacity(20%) saturate(0%)","texture_floor3_gco":"hard-light","plainteam":true,"plainteam_color_use":true,"teamtile_gradient":true,"teamtile_filter":"brightness(80%)","texture_team":"select-Lightning #1","texture_team_filter":"opacity(35%) saturate(0%)","texture_team_gco":"hard-light","plainendzone":true,"texture_endzone":"select-Carbon Fibre","texture_endzone_filter":"opacity(90%) saturate(0%)","wallshadow_size":"3","wallshadow_outer":true,"walloutline2_size":"3","walloutline3_size":"1","texture_walls1":"select-Metal","texture_walls1_filter":"opacity(45%) saturate(0%) brightness(60%) contrast(150%)","texture_walls2":"select-Water Drops","texture_walls2_filter":"opacity(70%)","texture_walls2_size":"0.8","basecircle1_linewidth":"5","basecircle1_opacity":"1","basecircle1_glow":"25","basecircle1_glow_multiplier":"5","spikes_filter":"drop-shadow(0px 0px 6px #00ff80)","bombs_filter":"drop-shadow(0 0 12px rgba(255, 153, 255, 0.5)) drop-shadow(0 0 5px #0099ff)","bombs_outline":true,"flags_glow":true,"flags_outline":true,"pups_glow":true,"pups_glow_outline":true,"plainfloor_color":"#02101e","plainteam_color_red":"#a30d0d","plainteam_color_blue":"#0d47a1","plainteam_color_yellow":"#666600","walloutline2_color":"#0a0f13","walloutline3_color":"#cfd8dc","texture_tiles":"https://i.imgur.com/xw3lN2o.png","texture_speedpad":"https://i.imgur.com/22t8hoV.png","texture_speedpadRed":"https://i.imgur.com/EfQFr4G.png","texture_speedpadBlue":"https://i.imgur.com/hPMDhD5.png","texture_portal":"https://i.imgur.com/lfczV8G.png","texture_splats":"https://i.imgur.com/F799BFp.png","texture_gravityWell":""},
            'select-Half-Life 2 #1': {"background_color2":"#408080","background_size":"75","background":"value-ellipse","plainfloor":true,"plainfloor_color_use":true,"floor_contour":true,"floor_contour_opacity":"0.8","floor_contour_multiplier":"3","texture_floor1":"select-HL2 Tile #2","texture_floor1_filter":"opacity(70%)","texture_floor3":"select-Spectrum Blur","texture_floor3_filter":"opacity(0%)","texture_floor3_size":"0","texture_floor3_gco":"luminosity","plainteam":true,"teamtile_filter":"opacity(50%)","plainendzone":true,"texture_endzone":"select-HL2 Tile #3","texture_endzone_filter":"opacity(50%) saturate(0)","texture_endzone_size":"0.25","wallshadow_size":"3","wallshadow_opacity":"0.5","wallshadow_outer":true,"walloutline2_size":"3","walloutline3_size":"1","texture_walls1":"select-HL2 Tile #15","texture_walls1_filter":"opacity(0%) brightness(60%)","texture_walls1_size":"0.6","texture_walls2":"select-Warm Machine #5","texture_walls2_filter":"opacity(0%) saturate(0)","texture_walls2_size":"0","texture_walls2_gco":"hard-light","basecircle1_linewidth":"2","basecircle1_opacity":"1","basecircle1_glow":"4","basecircle1_glow_multiplier":"3","basecircle1_dashpattern":"40,10, 10,5, 5,5, 10,10","balls_hole_radius":"12","ball_outline1":true,"spikes_generic":true,"spikes_filter":"drop-shadow(3px 3px 2px rgba(0,0,0,0.7))","bombs_outline":true,"bombs_draw_exploded_20pc":true,"bombs_filter":"drop-shadow(0 0 10px rgba(255, 153, 255, 0.6))","gates_neutral_opacity":"0.5","gates_neutral_margin":"6","gates_neutral_outline":true,"gate_shadows":true,"flags_outline":true,"flags_glow":true,"pups_glow":true,"pups_glow_outline":true,"plainfloor_color":"#02101e","plainteam_color_red":"#a30d0d","plainteam_color_blue":"#0d47a1","plainteam_color_yellow":"#666600","walloutline2_color":"#0a0f13","walloutline3_color":"#cfd8dc","texture_tiles":"https://i.imgur.com/GxWFGOw.png","texture_speedpad":"https://i.imgur.com/yOg3mRf.png","texture_speedpadRed":"https://i.imgur.com/h91pElw.png","texture_speedpadBlue":"https://i.imgur.com/wJsqTgD.png","texture_portal":"https://i.imgur.com/lgdJfGV9fczV8G.png","texture_splats":"https://i.imgur.com/GObCQoT.png","texture_gravityWell":""},
            'select-Half-Life 2 #2': {"background_color2":"#655432","background_size":"75","background":"value-ellipse","plainfloor":true,"plainfloor_color_use":true,"floor_contour":true,"floor_contour_size":"100","floor_contour_multiplier":"2","texture_floor1":"select-HL2 Tile #11","texture_floor1_filter":"opacity(60%)","plainteam":true,"teamtile_filter":"opacity(75%)","texture_team":"select-Cracks 1","texture_team_filter":"opacity(80%)","texture_team_gco":"destination-out","plainendzone":true,"texture_endzone":"select-HL2 Tile #3","texture_endzone_filter":"opacity(20%) saturate(0)","texture_endzone_size":"0.25","gate_shadows":true,"walloutline2_size":"3","walloutline3_size":"1","texture_walls1":"select-HL2 Metal #11","texture_walls1_filter":"opacity(80%)","texture_walls1_size":"0.65","texture_walls2":"select-sirius sdz #836","texture_walls2_filter":"opacity(60%) saturate(0)","texture_walls2_size":"0","texture_walls2_gco":"multiply","basecircle1_linewidth":"2","basecircle1_opacity":"1","basecircle1_glow":"4","basecircle1_glow_multiplier":"3","basecircle1_dashpattern":"40,10, 10,5, 5,5, 10,10","basecircle2_linewidth":"2","basecircle2_radius":"306","basecircle2_opacity":"1","basecircle2_glow":"4","basecircle2_glow_multiplier":"3","basecircle2_dashpattern":"45,12, 8,5, 10,10","balls_hole_radius":"10","ball_outline1":true,"flags_outline":true,"flags_glow":true,"pups_glow":true,"pups_glow_outline":true,"portals_outline":true,"portals_outline_opacity":"0.75","portals_outline_dashpattern":"4","portals_outline_fill":true,"plainfloor_color":"#795548","plainteam_color_red":"#a30d0d","plainteam_color_blue":"#0d47a1","plainteam_color_yellow":"#666600","walloutline2_color":"#0a0f13","walloutline3_color":"#cfd8dc","portals_outline_color":"#000000","texture_tiles":"https://i.imgur.com/auGwfdD.png","texture_speedpad":"/textures/crystal/speedpad.png","texture_speedpadRed":"/textures/crystal/speedpadred.png","texture_speedpadBlue":"/textures/crystal/speedpadblue.png","texture_portal":"https://i.imgur.com/BHltUAU.png","texture_splats":"/textures/turbo/splats.png","texture_gravityWell":""},
            'select-Half-Life 2 #3': {"background_color2":"#408080","background_size":"75","background":"value-ellipse","plainfloor":true,"plainfloor_color_use":true,"floor_contour":true,"floor_contour_opacity":"0.8","floor_contour_multiplier":"3","texture_floor1":"select-HL2 Metal #14","texture_floor1_filter":"opacity(60%)","texture_floor1_gco":"","plainteam":true,"teamtile_gradient":true,"teamtile_filter":"opacity(65%)","texture_team":"select-HL2 Metal #14","texture_team_filter":"opacity(60%)","plainendzone":true,"endzone_filter":"brightness(150%) drop-shadow(0 0 1px white)","texture_endzone":"select-HL2 Tile #3","texture_endzone_filter":"opacity(50%)","texture_endzone_size":".3125","wallshadow_size":"3","wallshadow_opacity":"0.5","wallshadow_outer":true,"gate_shadows":true,"walloutline2_size":"3","walloutline3_size":"1","texture_walls1":"select-HL2 Concrete #7","texture_walls1_filter":"opacity(60%)","basecircle1_linewidth":"2","basecircle1_radius":"340","basecircle1_opacity":"1","basecircle1_blur":"1","basecircle1_glow":"4","basecircle1_glow_multiplier":"3","basecircle1_dashpattern":"40,13.4071","basecircle2_linewidth":"2","basecircle2_radius":"240","basecircle2_opacity":"1","basecircle2_blur":"1","basecircle2_glow":"4","basecircle2_glow_multiplier":"3","basecircle2_dashpattern":"25,12.6991","balls_hole_radius":"12","ball_outline1":true,"ball_outline1_opacity":"0.65","ballskins":true,"ballskins_opacity":"0.85","spikes_generic":true,"spikes_filter":"drop-shadow(3px 3px 2px rgba(0,0,0,0.7))","bombs_filter":"drop-shadow(0 0 12px rgba(255, 153, 255, 0.5)) drop-shadow(0 0 5px #ff99ff)","gates_glow":true,"gates_glow_outline":true,"gates_neutral_opacity":"0.4","flags_glow":true,"pups_glow":true,"pups_glow_outline":true,"plainfloor_color":"#101010","plainteam_color_red":"#ec407a","plainteam_color_blue":"#26c6da","plainteam_color_yellow":"#ada234","plainendzone_color_red":"#e91e63","plainendzone_color_blue":"#00bcd4","walloutline2_color":"#0a0f13","walloutline3_color":"#cfd8dc","ball_outline1_color_red":"#000000","ball_outline1_color_blue":"#000000","ballskins_red_x":"240","ballskins_red_y":"96","ballskins_blue_x":"288","ballskins_blue_y":"144","texture_tiles":"https://i.imgur.com/yzwGwCN.png","texture_speedpad":"https://i.imgur.com/hPpsrSI.png","texture_speedpadRed":"https://i.imgur.com/EXqQbpF.png","texture_speedpadBlue":"https://i.imgur.com/if3qEp0.png","texture_portal":"https://i.imgur.com/lfczV8G.png","texture_splats":"https://i.imgur.com/M5TMzBO.png","texture_gravityWell":""},
            'select-Half-Life 2 #4': {"background_color2":"#408080","background_size":"75","background":"value-ellipse","plainfloor":true,"plainfloor_color_use":true,"floor_contour":true,"floor_contour_opacity":"0.8","floor_contour_multiplier":"3","texture_floor1":"select-HL2 Tile #16","texture_floor1_filter":"opacity(60%) saturate(0)","texture_floor3":"select-Spectrum Blur","texture_floor3_filter":"opacity(0%)","texture_floor3_size":"0","texture_floor3_gco":"luminosity","plainteam":true,"teamtile_filter":"opacity(50%)","plainendzone":true,"texture_endzone":"select-HL2 Tile #3","texture_endzone_filter":"opacity(50%) saturate(0)","texture_endzone_size":"0.25","wallshadow_size":"3","wallshadow_opacity":"0.5","wallshadow_outer":true,"walloutline2_size":"3","walloutline3_size":"1","texture_walls1":"select-HL2 Tile #15","texture_walls1_filter":"opacity(60%) brightness(60%)","texture_walls1_size":"0.6","texture_walls2":"select-Warm Machine #5","texture_walls2_filter":"opacity(60%) saturate(0)","texture_walls2_size":"0","texture_walls2_gco":"hard-light","basecircle1_linewidth":"2","basecircle1_opacity":"1","basecircle1_glow":"4","basecircle1_glow_multiplier":"3","basecircle1_dashpattern":"60,20","basecircle2_linewidth":"1","basecircle2_radius":"290","basecircle2_opacity":"1","basecircle2_glow":"4","basecircle2_glow_multiplier":"3","basecircle2_dashpattern":"40,30","balls_hole_radius":"12","ball_outline1":true,"ball_outline2":true,"ball_outline2_radius":"12","ball_outline2_opacity":"0.5","spikes_generic":true,"spikes_filter":"drop-shadow(3px 3px 2px rgba(0,0,0,0.7))","gates_neutral_opacity":"0.6","gates_neutral_margin":"6","gates_neutral_outline":true,"gate_shadows":true,"flags_outline":true,"flags_glow":true,"pups_glow":true,"pups_glow_outline":true,"plainfloor_color":"#cfd8dc","plainteam_color_red":"#a30d0d","plainteam_color_blue":"#0d47a1","plainteam_color_yellow":"#666600","walloutline2_color":"#0a0f13","walloutline3_color":"#cfd8dc","texture_tiles":"/textures/mural/tiles.png","texture_speedpad":"/textures/mural/speedpad.png","texture_speedpadRed":"/textures/mural/speedpadred.png","texture_speedpadBlue":"/textures/mural/speedpadblue.png","texture_portal":"/textures/galvanize/portal.png","texture_splats":"/textures/mural/splats.png","texture_gravityWell":""},
            'select-Half-Life 2 #5': {"background_color2":"#408080","background_size":"75","background":"value-ellipse","plainfloor":true,"plainfloor_color_use":true,"texture_floor1":"select-JoJo Blur #10","texture_floor1_filter":"opacity(40%) hue-rotate(340deg) saturate(65%) contrast(150%)","texture_floor2":"select-HL2 Tile #9","texture_floor2_filter":"opacity(40%)","texture_floor2_gco":"soft-light","texture_floor3":"select-HL2 Metal #12","texture_floor3_filter":"opacity(10%) invert(100%)","texture_floor3_size":"0.4","texture_floor3_gco":"hard-light","plainteam":true,"plainteam_color_use":true,"teamtile_filter":"opacity(75%)","texture_team":"select-HL2 Metal #12","texture_team_filter":"opacity(40%) invert(100%)","texture_team_size":"0.45","texture_team_gco":"hard-light","plainendzone":true,"texture_endzone":"select-Cracked Ice","texture_endzone_filter":"opacity(50%)  saturate(0)","texture_endzone_size":"0.4","texture_endzone_gco":"hard-light","wallshadow_size":"3","wallshadow_opacity":"0.5","wallshadow_outer":true,"walloutline2_size":"3","walloutline3_size":"1","texture_walls1":"select-HL2 Metal #2","texture_walls1_filter":"opacity(60%)","basecircle1_linewidth":"2","basecircle1_opacity":"1","basecircle1_glow":"4","basecircle1_glow_multiplier":"3","basecircle1_dashpattern":"40,10, 10,5, 5,5, 10,10","flagline_linewidth":"1","flagline_opacity":"0.5","balls_plain":true,"balls_hole_radius":"12","ball_outline1":true,"ball_outline1_segments":"5","ball_outline2":true,"ballskins":true,"ballskins_opacity":"0.85","spikes_generic":true,"spikes_filter":"drop-shadow(3px 3px 2px rgba(0,0,0,0.7))","bombs_outline":true,"bombs_filter":"drop-shadow(0 0 12px rgba(255, 153, 255, 0.5)) drop-shadow(0 0 5px #ff99ff)","gates_neutral_opacity":"0.4","gates_neutral_margin":"6","gates_neutral_outline":true,"gate_shadows":true,"flags_glow":true,"pups_glow":true,"pups_glow_outline":true,"plainfloor_color":"#424242","plainteam_color_red":"#a30d0d","plainteam_color_blue":"#0d47a1","plainteam_color_yellow":"#666600","walloutline2_color":"#0a0f13","walloutline3_color":"#cfd8dc","flagline_color":"#dcedc8","ballskins_red_x":"240","ballskins_red_y":"96","ballskins_blue_x":"0","ballskins_blue_y":"144","texture_tiles":"https://i.imgur.com/1jMmC6E.png","texture_speedpad":"https://i.imgur.com/NjeQ69K.png","texture_speedpadRed":"https://i.imgur.com/s2Bf3Cn.png","texture_speedpadBlue":"https://i.imgur.com/S3aOzay.png","texture_portal":"https://i.imgur.com/jkfNgK6.png","texture_splats":"https://i.imgur.com/M5TMzBO.png","texture_gravityWell":""},
            'select-Half-Life 2 #6': {"background_color1":"#376a7b","background_color2":"#1a2456","background":"value-corner","plainfloor":true,"plainfloor_color_use":true,"grid1_size":"40","grid1_opacity":"0.1","grid1_square":true,"grid1_shadow":true,"floor_filter":"blur(1px)","texture_floor1":"select-HL2 Plaster #3","texture_floor1_filter":"opacity(60%) saturate(0)","texture_floor1_gco":"hard-light","plainteam":true,"teamtile_filter":"opacity(50%)","texture_team":"select-JoJo Glass #22","texture_team_filter":"opacity(40%)","texture_team_size":"0.5","texture_team_gco":"hard-light","plainendzone":true,"endzone_filter":"opacity(75%)","texture_endzone":"select-Small Checks","texture_endzone_filter":"opacity(40%) saturate(0%)","texture_endzone_gco":"luminosity","plainwalls":true,"walloutline1_size":"2","walloutline2_size":"2","walloutline3_size":"2","walloutline3_opacity":"0.85","walls_filter":"drop-shadow(2px 2px 4px black)","texture_walls1":"select-HL2 Metal #6","texture_walls1_filter":"opacity(100%) saturate(0) contrast(140%)","basecircle1_linewidth":"5","basecircle1_opacity":"0.35","basecircle1_glow_multiplier":"2","basecircle1_dashpattern":"40,10, 10,5, 10,10","flagline_linewidth":"2","flagline_opacity":"0.6","flagline_dashpattern":"20,20","texture_base":"select-Base #2","texture_base_filter":"opacity(30%) saturate(30%)","texture_base_size":"0.65","balls_hole_radius":"10","ballskins":true,"spikes_generic":true,"spikes_filter":"drop-shadow(2px 2px 2px black)","buttons_generic":true,"bombs_filter":"drop-shadow(2px 2px 2px rgba(0,0,0,0.6)) brightness(120%) sepia(20%) contrast(120%)","gates_neutral_opacity":"0.5","gates_neutral_margin":"5","gates_neutral_outline":true,"gates_plain_grb":true,"gate_shadows":true,"flags_outline":true,"flags_outline_opacity":"0.8","flags_glow":true,"boosts_outline":true,"boosts_outline_opacity":"0.75","boosts_outline_dashpattern":"","portals_outline":true,"portals_outline_dashpattern":"","plainfloor_color":"#757575","grid1_color":"#101010","plainendzone_color_red":"#b71c1c","plainendzone_color_blue":"#0d47a1","plainwalls_color":"#080808","walloutline1_color":"#bdbdbd","walloutline2_color":"#101010","walloutline3_color":"#ff3d00","flagline_color":"#fafafa","spikes_generic_color":"#eaecee","buttons_generic_color_outer":"#fafafa","buttons_generic_color_inner":"#00803f","buttons_generic_color_border":"#101010","flags_outline_color":"auto","ballskins_red_x":"240","ballskins_red_y":"0","ballskins_blue_x":"240","ballskins_blue_y":"0","texture_tiles":"/textures/corallight/tiles.png","texture_speedpad":"/textures/corallight/speedpad.png","texture_speedpadRed":"/textures/corallight/speedpadred.png","texture_speedpadBlue":"/textures/corallight/speedpadblue.png","texture_portal":"/textures/corallight/portal.png","texture_splats":"/textures/corallight/splats.png","texture_gravityWell":""},
            'select-Starlight': {"background_color1":"#001122","background_size":"90","background":"value-linear","plainfloor":true,"plainfloor_color_use":true,"floor_gradient":"value-gradient2","floor_gradient_opacity2":"0.6","floor_contour":true,"floor_contour_opacity":"0.65","floor_contour_size":"100","texture_floor1":"select-Rainy Afternoon Blur","texture_floor1_filter":"opacity(30%) saturate(0%)","texture_floor2":"select-Sparkle Lines","texture_floor2_filter":"opacity(20%)","texture_floor2_size":"0","texture_floor2_gco":"soft-light","plainteam":true,"texture_team":"select-Warble","texture_team_filter":"opacity(30%) saturate(0)","texture_team_size":"0.5","plainendzone":true,"texture_endzone":"select-Medium Random Checks","texture_endzone_filter":"opacity(100%) saturate(0%)","plainwalls":true,"wallshadow_size":"3","wallshadow_multiplier":"2","wallshadow_outer":true,"walloutline2_size":"3","walloutline3_size":"1","texture_walls1":"select-Sepia Blue","texture_walls1_filter":"opacity(70%) saturate(30%) sepia(100%) hue-rotate(150deg)","texture_walls2":"select-HL2 Asphalt #14","texture_walls2_filter":"opacity(60%) saturate(0)","texture_walls2_size":"0.4","texture_walls2_gco":"hard-light","basecircle1_radius":"276","basecircle1_opacity":"0.25","basecircle1_glow":"8","basecircle1_glow_multiplier":"2","basecircle2_linewidth":"4","basecircle2_opacity":"1","basecircle2_glow":"1","basecircle2_dashpattern":"10,6, 6,6","centerline_linewidth":"2","centerline_dashpattern":"5,10","ball_outline1":true,"spikes_border":true,"gate_shadows":true,"pups_glow":true,"pups_glow_outline":true,"plainfloor_color":"#17202a","floor_gradient_color1":"#010a29","floor_gradient_color2":"#012849","plainwalls_color":"#cfd8dc","walloutline2_color":"#080808","walloutline3_color":"#bdbdbd","centerline_color":"#eaecee","spikes_border_color":"#bfff00","texture_tiles":"https://i.imgur.com/j0el5Tn.png","texture_speedpad":"https://i.imgur.com/22t8hoV.png","texture_speedpadRed":"https://i.imgur.com/EfQFr4G.png","texture_speedpadBlue":"https://i.imgur.com/hPMDhD5.png","texture_portal":"https://i.imgur.com/rGEEQ2s.png","texture_splats":"https://i.imgur.com/IIFG2nS.png","texture_gravityWell":""},
            'select-Castle': {"background_color1":"#3a3a45","background_color2":"#0f0f11","background_size":"30","background":"value-conic","plainfloor":true,"floor_contour":true,"floor_contour_multiplier":"2","texture_floor2":"select-HL2 Tile #14","texture_floor2_filter":"opacity(60%) saturate(0)","texture_floor2_size":"0.625","plainteam":true,"teamtile_gradient":true,"teamtile_filter":"drop-shadow(0px 0px 1px black)","texture_team":"select-Diagonal Pattern","texture_team_filter":"opacity(25%) saturate(0%)","texture_team_size":"0.5","texture_team_gco":"hard-light","plainwalls":true,"gate_shadows":true,"walloutline1_size":"1","walls_filter":"drop-shadow(2px 2px 3px black)","texture_walls1":"select-Metal","texture_walls1_filter":"opacity(45%) saturate(0%)","texture_walls2":"select-Cracks 1","texture_walls2_filter":"opacity(30%) invert(100%)","texture_walls2_size":"0.8","kblogo":true,"plainfloor_color":"#000000","plainwalls_color":"#1C2A39","walloutline1_color":"#abb2b9","texture_tiles":"https://i.imgur.com/GCVOxf0.png","texture_speedpad":"https://i.imgur.com/HCTWYrI.png","texture_speedpadRed":"https://i.imgur.com/PnFxbGc.png","texture_speedpadBlue":"https://i.imgur.com/BxhPCj6.png","texture_portal":"https://i.imgur.com/8hUe7G0.png","texture_splats":"https://i.imgur.com/kbkOC6x.png","texture_gravityWell":""},
            'select-Space': {"background_color1":"#0a0a0a","background_color2":"#0a0a0a","background_size":"83","background":"value-linear","plainfloor":true,"plainfloor_color_use":true,"floor_filter":"opacity(30%)","texture_floor1":"select-Stars #1","texture_floor1_size":"0.5","texture_floor2":"select-CrissxCross","texture_floor2_filter":"opacity(100%) saturate(0%)","texture_floor3":"select-RoL S5E","texture_floor3_filter":"opacity(10%)","texture_floor3_size":"0","texture_floor3_gco":"hard-light","plainteam":true,"teamtile_filter":"saturate(300%) opacity(30%) brightness(200%)","texture_team":"select-Holes","texture_team_filter":"opacity(100%) saturate(0%)","texture_team_size":"0.25","texture_team_gco":"destination-in","plainendzone":true,"texture_endzone":"select-Spaced Diagonal Lines","texture_endzone_filter":"opacity(25%) saturate(0%)","plainwalls":true,"wallshadow_size":"0","wallshadow_multiplier":"2","wallshadow_inner":true,"wallshadow_outer":true,"walloutline1_size":"2","centerline_linewidth":"1","flagline_linewidth":"2","spikes_generic":true,"spikes_generic_points":"20","spikes_generic_innerradius":"10","spikes_generic_holeradius":"8","bombs_outline":true,"bombs_filter":"drop-shadow(0 0 12px rgba(255, 153, 255, 0.5)) drop-shadow(0 0 5px #ff99ff)","gates_glow":true,"gates_glow_outline":true,"flags_outline":true,"flags_glow":true,"pups_glow":true,"pups_glow_outline":true,"plainfloor_color":"#000000","plainteam_color_red":"#ff3333","plainteam_color_blue":"#00ffff","plainteam_color_yellow":"#ecff00","wallshadow_color":"#6514ec","texture_tiles":"https://i.imgur.com/L0V5dx8.png","texture_speedpad":"/textures/sparkle/speedpad.png","texture_speedpadRed":"/textures/sparkle/speedpadred.png","texture_speedpadBlue":"/textures/sparkle/speedpadblue.png","texture_portal":"https://i.imgur.com/f7aNvIA.png","texture_splats":"https://i.imgur.com/kbkOC6x.png","texture_gravityWell":""},
            'select-Hex': {"background_color1":"#6f6f6f","background_color2":"#404040","background_size":"83","plainfloor":true,"plainfloor_color_use":true,"texture_floor1":"select-Bubbles & Swirls","texture_floor1_filter":"opacity(10%) saturate(0)","texture_floor2":"select-RoL S5E","texture_floor2_filter":"opacity(60%) saturate(0%)","texture_floor2_size":"0","texture_floor2_gco":"soft-light","texture_floor3":"select-Hexes 3","texture_floor3_filter":"opacity(8%) invert(50%)","plainteam":true,"plainteam_color_use":true,"teamtile_filter":"brightness(80%) saturate(75%)","texture_team":"select-Lightning #1","texture_team_filter":"opacity(35%) saturate(0%)","texture_team_gco":"hard-light","plainendzone":true,"endzone_filter":"drop-shadow(0 0 2px black)","texture_endzone":"select-Small Checks","texture_endzone_filter":"opacity(40%)","plainwalls":true,"gate_shadows":true,"walloutline1_size":"2","walls_filter":"drop-shadow(2px 2px 4px black) drop-shadow(2px 2px 4px black)","texture_walls1":"select-Tech #2","texture_walls1_filter":"opacity(100%) saturate(200%)","texture_walls1_size":"0.25","texture_walls1_gco":"lighter","centerline_linewidth":"1","flagline_linewidth":"2","balls_hole_radius":"12","ball_outline1":true,"ballskins":true,"ballskins_opacity":"0.8","ballskins_gco":"overlay","spikes_generic":true,"spikes_filter":"drop-shadow(1px 1px 2px black)","bombs_outline":true,"bombs_filter":"drop-shadow(0 0 12px rgba(255, 153, 255, 0.5)) drop-shadow(0 0 5px #ff99ff)","gates_glow":true,"gates_glow_outline":true,"gates_neutral_opacity":"0.25","flags_glow":true,"pups_glow":true,"pups_glow_outline":true,"portals_outline":true,"portals_outline_dashpattern":"","plainfloor_color":"#212121","plainteam_color_red":"#d32f2f","plainteam_color_blue":"#3949ab","plainteam_color_yellow":"#ffeb3b","plainwalls_color":"#0a0f13","walloutline1_color":"#abb2b9","spikes_generic_color":"#cfd8dc","ballskins_red_x":"288","ballskins_red_y":"192","ballskins_blue_x":"240","ballskins_blue_y":"192","texture_tiles":"https://i.imgur.com/xw3lN2o.png","texture_speedpad":"https://i.imgur.com/22t8hoV.png","texture_speedpadRed":"https://i.imgur.com/EfQFr4G.png","texture_speedpadBlue":"https://i.imgur.com/hPMDhD5.png","texture_portal":"https://i.imgur.com/lfczV8G.png","texture_splats":"https://i.imgur.com/F799BFp.png","texture_gravityWell":""},
            'select-Anarchy': {"background_color1":"#6f6f6f","background_color2":"#404040","background_size":"83","plainfloor":true,"plainfloor_color_use":true,"floor_contour":true,"floor_contour_opacity":"0.65","floor_contour_size":"15","floor_contour_multiplier":"1","grid1_size":"160","grid1_length":"160","grid1_opacity":"0.15","grid1_square":true,"grid1_shadow":true,"checker1_size":"80","texture_floor2":"select-HL2 Metal #5","texture_floor2_filter":"opacity(80%) contrast(120%)","plainteam":true,"plainteam_color_use":true,"teamtile_gradient":true,"teamtile_filter":"opacity(75%) drop-shadow(0 0 1px black)","texture_team":"select-Crackles","texture_team_filter":"opacity(35%) saturate(0%) invert(100%)","texture_team_size":"0.75","plainendzone":true,"endzone_filter":"drop-shadow(0 0 1px black)","texture_endzone":"select-Joined Circles","texture_endzone_filter":"opacity(50%) invert(100%)","texture_endzone_size":"0.7","plainwalls":true,"walloutline2_size":"3","walloutline3_size":"1","walls_filter":"drop-shadow(0 0 20px rgba(0,0,0,0.5))","texture_walls1":"select-Rubber Specks","texture_walls1_filter":"opacity(50%) saturate(0%)","texture_walls1_size":"0.5","texture_walls2":"select-Icy #2","texture_walls2_filter":"opacity(25%) saturate(0)","texture_walls2_size":"0.75","texture_walls2_gco":"hard-light","texture_base":"select-Anarchy","texture_base_filter":"opacity(10%) blur(1px)","texture_base_size":"1.2","balls_hole_radius":"11","ball_outline1":true,"ball_outline1_segments":"5","ball_outline1_opacity":"0.6","ball_outline2":true,"ball_outline2_radius":"12","ball_outline2_opacity":"0.75","spikes_filter":"drop-shadow(0 0 3px white)","gate_shadows":true,"flags_outline":true,"flags_outline_opacity":"0.6","plainfloor_color":"#d5d8dc","checker1_color":"#546e7a","plainwalls_color":"#02031e","walloutline2_color":"#d5d8dc","walloutline3_color":"#000000","texture_tiles":"https://i.imgur.com/qkaeirQ.png","texture_speedpad":"https://i.imgur.com/sTqwM4n.png","texture_speedpadRed":"https://i.imgur.com/7tZjFli.png","texture_speedpadBlue":"https://i.imgur.com/pF3xUlZ.png","texture_portal":"https://i.imgur.com/Qb4iyjY.png","texture_splats":"https://i.imgur.com/TqJKyQR.png","texture_gravityWell":""},
            'select-Spider': {"background_color1":"#d90000","background_color2":"#0069d2","background":"value-Neon Shallows","plainfloor":true,"plainfloor_color_use":true,"floor_contour":true,"grid1_size":"40","grid1_opacity":"0.15","texture_floor2":"select-Warm Machine #1","texture_floor2_filter":"opacity(60%) saturate(0)","texture_floor2_size":"0","texture_floor3":"select-Cartoony Block Tiles #1","texture_floor3_filter":"opacity(30%)","texture_floor3_size":"0.7","texture_floor3_gco":"hard-light","plainteam":true,"plainteam_color_use":true,"texture_team":"select-Metal Floorplate","texture_team_filter":"opacity(60%) saturate(0%) invert(100%)","texture_team_size":"0.1","plainendzone":true,"plainendzone_color_use":true,"texture_endzone":"select-Small Diagonal Checks","texture_endzone_filter":"opacity(100%) saturate(0%)","plainwalls":true,"wallshadow_size":"0","wallshadow_opacity":"0.8","wallshadow_inner":true,"walloutline3_size":"1","walls_filter":"drop-shadow(3px 3px 4px black)","texture_walls1":"select-Rust","texture_walls1_filter":"opacity(40%) saturate(0%)","texture_walls2":"select-JoJo Relief Lines 23","texture_walls2_filter":"opacity(12%)","texture_walls2_gco":"hard-light","centerline_linewidth":"1","flagline_linewidth":"1","flagline_opacity":"0.5","texture_base":"select-Tarantula","texture_base_filter":"opacity(20%)","ball_outline1":true,"ball_outline1_linewidth":"1","ball_outline1_segments":"0","ballskins":true,"ballskins_opacity":"0.65","bombs_outline":true,"bombs_outline_opacity":"0.75","bombs_filter":"drop-shadow(0 0 8px rgba(255, 160, 0, 0.8))","gate_shadows":true,"gates_glow":true,"gates_glow_outline":true,"flags_outline":true,"flags_glow":true,"pups_glow":true,"pups_glow_outline":true,"plainfloor_color":"#616161","plainteam_color_red":"#800000","plainteam_color_blue":"#052d89","plainteam_color_yellow":"#807e00","plainwalls_color":"#808b96","wallshadow_color":"#080808","walloutline3_color":"#bdbdbd","centerline_color":"#bdbdbd","flagline_color":"#78909c","ballskins_red_x":"240","ballskins_red_y":"0","ballskins_blue_x":"288","ballskins_blue_y":"192","texture_tiles":"https://i.imgur.com/4RMaqMn.png","texture_speedpad":"https://i.imgur.com/sTqwM4n.png","texture_speedpadRed":"https://i.imgur.com/7tZjFli.png","texture_speedpadBlue":"https://i.imgur.com/pF3xUlZ.png","texture_portal":"https://i.imgur.com/Qb4iyjY.png","texture_splats":"https://i.imgur.com/TqJKyQR.png","texture_gravityWell":""},
            'select-Constellation': {"background_color1":"#711887","background_color2":"#07090a","background_size":"83","background":"value-conic","plainfloor":true,"plainfloor_color_use":true,"texture_floor1":"select-Vertices","texture_floor1_filter":"opacity(20%) saturate(80%)","plainteam":true,"texture_team":"select-Lightning #1","texture_team_filter":"opacity(35%) saturate(0%)","plainendzone":true,"endzone_filter":"saturate(200%) brightness(150%)","texture_endzone":"select-Rotated Checker","texture_endzone_filter":"opacity(50%) saturate(0%)","texture_endzone_size":"0.7","plainwalls":true,"wallshadow_size":"0","wallshadow_blur":"4","wallshadow_multiplier":"4","wallshadow_inner":true,"wallshadow_outer":true,"walloutline1_size":"2","texture_walls1":"select-Blue/Black Sparkles","texture_walls1_filter":"opacity(40%) saturate(80%)","texture_walls1_size":"0.25","centerline_linewidth":"1","flagline_linewidth":"2","texture_base":"select-Spiral","texture_base_filter":"opacity(25%)","ball_outline1":true,"ball_outline1_linewidth":"3","ball_outline1_segments":"0","ball_outline1_radius":"16","bombs_outline":true,"bombs_filter":"drop-shadow(0 0 12px rgba(255, 153, 255, 0.5)) drop-shadow(0 0 5px #ff99ff)","gates_glow":true,"gates_glow_outline":true,"flags_outline":true,"flags_glow":true,"pups_glow":true,"pups_glow_outline":true,"plainfloor_color":"#000000","ball_outline1_color_red":"auto","ball_outline1_color_blue":"auto","texture_tiles":"https://i.imgur.com/ciiB8Pw.png","texture_speedpad":"https://i.imgur.com/IB95nd5.png","texture_speedpadRed":"https://i.imgur.com/8RgHd1Y.png","texture_speedpadBlue":"https://i.imgur.com/E3gqIdZ.png","texture_portal":"https://i.imgur.com/H1e5f5X.png","texture_splats":"https://i.imgur.com/yMbLHLT.png","texture_gravityWell":""},
            'select-Ripples': {"background_color1":"#00ffff","background_color2":"#1e003c","background":"value-ellipse","plainfloor":true,"floor_contour":true,"floor_contour_opacity":"0.75","floor_contour_multiplier":"3","grid1_size":"60","grid1_length":"60","grid1_opacity":"0.05","texture_floor1":"select-Stone #4 (40px)","texture_floor1_size":"0.5","texture_floor2":"select-Ripples","texture_floor2_filter":"opacity(20%) saturate(0%)","texture_floor2_size":"5","texture_floor2_gco":"hard-light","teamtile_filter":"drop-shadow(0 0 1px black)","texture_team":"select-Sparkles #1","texture_team_filter":"opacity(10%) saturate(0%)","plainendzone":true,"texture_endzone":"select-Large Diagonal Checks","texture_endzone_filter":"opacity(25%) saturate(0%)","plainwalls":true,"wallshadow_outer":true,"walloutline1_size":"2","walloutline2_size":"1","texture_walls1":"select-Patchy","texture_walls1_filter":"opacity(30%) saturate(0%)","texture_walls1_size":"0.5","texture_walls2":"select-Square Stone","texture_walls2_filter":"opacity(20%) saturate(0%)","texture_walls2_size":"0.8","centerline_linewidth":"1","flagline_linewidth":"2","spikes_generic":true,"spikes_filter":"drop-shadow(3px 3px 2px rgba(0,0,0,0.7))","bombs_outline":true,"bombs_outline_opacity":"0.5","bombs_filter":"drop-shadow(0 0 12px rgba(255, 153, 255, 0.5)) drop-shadow(0 0 5px #ff99ff)","flags_outline":true,"flags_glow":true,"pups_glow":true,"pups_glow_outline":true,"plainfloor_color":"#757575","plainwalls_color":"#04070b","walloutline1_color":"#04070b","walloutline2_color":"#808b96","texture_tiles":"https://i.imgur.com/kuPdAXV.png","texture_speedpad":"https://i.imgur.com/39zXNPL.png","texture_speedpadRed":"https://i.imgur.com/bo4m727.png","texture_speedpadBlue":"https://i.imgur.com/EFk5IgL.png","texture_portal":"https://i.imgur.com/KdEHGtf.png","texture_splats":"https://i.imgur.com/kHUlTwP.png","texture_gravityWell":""},
            'select-Skulls': {"background_color1":"#00ffff","background_color2":"#1e003c","background":"value-ellipse","plainfloor":true,"plainfloor_color_use":true,"floor_contour":true,"floor_contour_opacity":"0.65","floor_contour_multiplier":"2","grid1_size":"40","grid1_square":true,"grid1_shadow":true,"checker1_size":"40","checker1_opacity":"0.03","checker1_normal":true,"plainteam":true,"teamtile_filter":"saturate(75%)","texture_team":"select-Benji3o3 Clouds #16","texture_team_filter":"opacity(60%) saturate(0)","texture_team_size":"0.35","texture_team_gco":"screen","plainendzone":true,"endzone_filter":"saturate(150%) brightness(125%) drop-shadow(0 0 1px black)","texture_endzone":"select-Rotated Checker","texture_endzone_filter":"opacity(50%)","texture_endzone_size":"0.4","gate_shadows":true,"walloutline1_size":"1","walloutline2_size":"2","texture_walls1":"select-Green Lightning","texture_walls1_filter":"opacity(35%) saturate(0%)","texture_walls1_gco":"hard-light","texture_walls2":"select-Metal","texture_walls2_filter":"opacity(45%) saturate(0%)","texture_walls2_gco":"hard-light","texture_base":"select-Skull","texture_base_filter":"opacity(40%)","plainfloor_color":"#eeeeee","checker1_color":"#0a0f13","plainteam_color_yellow":"#fff59d","walloutline1_color":"#eeeeee","walloutline2_color":"#000000","texture_tiles":"/textures/corallight/tiles.png","texture_speedpad":"/textures/corallight/speedpad.png","texture_speedpadRed":"/textures/corallight/speedpadred.png","texture_speedpadBlue":"/textures/corallight/speedpadblue.png","texture_portal":"/textures/corallight/portal.png","texture_splats":"/textures/coral/splats.png","texture_gravityWell":""},
            'select-Purple Pirate': {"background_color1":"#d90000","background_color2":"#0069d2","background":"value-corner","plainfloor":true,"plainfloor_color_use":true,"floor_contour":true,"floor_contour_size":"90","grid1_size":"40","grid1_opacity":"0.1","grid1_square":true,"grid1_shadow":true,"plainteam":true,"plainteam_color_use":true,"texture_team":"select-Sparklers","texture_team_filter":"opacity(100%) saturate(0)","texture_team_size":"0.6","texture_team_gco":"destination-in","plainendzone":true,"plainendzone_color_use":true,"texture_endzone":"select-Large Diagonal Checks","texture_endzone_filter":"opacity(25%) saturate(0%)","texture_endzone_size":"0.8","plainwalls":true,"wallshadow_size":"0","wallshadow_blur":"5","wallshadow_multiplier":"4","wallshadow_inner":true,"walloutline1_size":"1","walloutline2_size":"3","walloutline3_size":"1","centerline_linewidth":"1","flagline_linewidth":"2","texture_base":"select-Crossbones","texture_base_filter":"opacity(40%) blur(1px)","texture_base_size":"0.75","plainfloor_color":"#00FFFF","floor_contour_color":"#3c0080","plainteam_color_red":"#ff80ff","plainteam_color_blue":"#80ffff","plainteam_color_yellow":"#ffff80","plainendzone_color_red":"#ff00ff","plainendzone_color_blue":"#00ffff","plainwalls_color":"#0f021e","wallshadow_color":"#6666FF","walloutline1_color":"#b39ddb","walloutline2_color":"#080808","walloutline3_color":"#ede7f6","texture_tiles":"/textures/electric/tiles.png","texture_speedpad":"/textures/electric/speedpad.png","texture_speedpadRed":"/textures/electric/speedpadred.png","texture_speedpadBlue":"/textures/electric/speedpadblue.png","texture_portal":"/textures/electric/portal.png","texture_splats":"https://i.imgur.com/wxJ2ImS.png","texture_gravityWell":""},
            'select-Graydiant': {"background_color1":"#b8a998","background_color2":"#322c21","background":"value-ellipse","plainfloor":true,"plainfloor_color_use":true,"floor_contour":true,"floor_contour_opacity":"0.75","floor_contour_multiplier":"3","texture_floor1":"select-HL2 Tile #7","texture_floor1_filter":"opacity(0%)","texture_floor1_size":"0.3125","texture_floor2":"select-Warm Machine #2","texture_floor2_filter":"opacity(80%) saturate(40%) sepia(80%)","texture_floor2_size":"0","plainteam":true,"teamtile_filter":"saturate(160%)","texture_team":"select-HL2 Tile #8","texture_team_filter":"opacity(30%) saturate(0)","texture_team_size":"0.15625","plainendzone":true,"plainendzone_color_use":true,"texture_endzone":"select-Medium Random Checks","texture_endzone_filter":"opacity(100%) saturate(0%)","walloutline2_size":"2","walloutline3_size":"1","walls_filter":"saturate(40%) drop-shadow(2px 2px 3px rgba(0,0,0,0.8))","texture_walls1":"select-HL2 Plaster #4","texture_walls1_filter":"opacity(60%) brightness(80%)","texture_walls2":"select-Warm Machine #7","texture_walls2_filter":"opacity(60%) saturate(100%)","texture_walls2_size":"0","texture_walls2_gco":"multiply","basecircle1_radius":"270","basecircle1_opacity":"0.2","basecircle1_fill":true,"flagline_linewidth":"1","texture_base":"select-Spiral Swirl","texture_base_filter":"opacity(30%)","texture_base_gco":"hard-light","balls_hole_radius":"12","ballskins":true,"ballskins_opacity":"0.75","ballskins_gco":"destination-over","spikes_filter":"drop-shadow(0 0 1px white)","bombs_outline":true,"bombs_outline_segments":"0","bombs_outline_radius":"2","bombs_draw_exploded_20pc":true,"bombs_filter":"drop-shadow(0 0 1px white)","gate_shadows":true,"plainfloor_color":"#abb2b9","plainendzone_color_red":"#b71c1c","plainendzone_color_blue":"#0d47a1","walloutline2_color":"#160a08","walloutline3_color":"#757575","bombs_outline_color":"#40c040","ballskins_red_x":"336","ballskins_red_y":"96","ballskins_blue_x":"288","ballskins_blue_y":"192","texture_tiles":"https://i.imgur.com/5kuBe9J.png","texture_speedpad":"/textures/crystal/speedpad.png","texture_speedpadRed":"/textures/crystal/speedpadred.png","texture_speedpadBlue":"/textures/crystal/speedpadblue.png","texture_portal":"https://i.imgur.com/pBZJ01i.png","texture_splats":"https://i.imgur.com/wiV1Yui.png","texture_gravityWell":""},
            'select-JoJo Metal': {"background_color1":"#c0c0c0","background":"value-ellipse","plainfloor":true,"plainfloor_color_use":true,"floor_filter":"saturate(100%) brightness(30%)","texture_floor1":"select-JoJo Metal 54","texture_floor1_filter":"opacity(80%) brightness(50%)","texture_floor2":"select-Fractal #1","texture_floor2_filter":"opacity(30%)","texture_floor2_gco":"hard-light","plainteam":true,"plainteam_color_use":true,"teamtile_filter":"opacity(25%)","texture_team":"select-JoJo Glass #9","texture_team_filter":"opacity(50%)","texture_team_size":"0.15","texture_team_gco":"hard-light","plainendzone":true,"plainendzone_color_use":true,"endzone_filter":"opacity(75%)","texture_endzone":"select-Diagonal Stripes 1","texture_endzone_filter":"opacity(40%) saturate(0%)","texture_endzone_size":"0.4","texture_endzone_gco":"luminosity","wallshadow_size":"0","wallshadow_blur":"4","wallshadow_opacity":"0.75","wallshadow_multiplier":"5","wallshadow_inner":true,"gate_shadows":true,"walloutline3_size":"1","walls_filter":"drop-shadow(3px 3px 4px black)","texture_walls1":"select-JoJo Metal 7-2","texture_walls1_filter":"opacity(100%) brightness(150%)","texture_walls1_size":"0.4","basecircle1_linewidth":"5","basecircle1_opacity":"1","basecircle1_glow":"3","basecircle1_glow_multiplier":"2","basecircle1_dashpattern":"40,10, 10,5, 10,10","flagline_linewidth":"1","flagline_opacity":"0.5","spikes_generic":true,"bombs_filter":"drop-shadow(0 0 6px rgba(171, 178, 185, 0.5)) brightness(130%) sepia(40%) contrast(130%)","plainfloor_color":"#abb2b9","plainendzone_color_red":"#b71c1c","plainendzone_color_blue":"#0d47a1","wallshadow_color":"#101010","walloutline3_color":"#707b7c","texture_tiles":"https://i.imgur.com/5kuBe9J.png","texture_speedpad":"/textures/crystal/speedpad.png","texture_speedpadRed":"/textures/crystal/speedpadred.png","texture_speedpadBlue":"/textures/crystal/speedpadblue.png","texture_portal":"https://i.imgur.com/pBZJ01i.png","texture_splats":"https://i.imgur.com/wiV1Yui.png","texture_gravityWell":""},
            'select-Jojo Stained Glass': {"background_color1":"#c0c0c0","background":"value-ellipse","plainfloor":true,"plainfloor_color_use":true,"texture_floor1":"select-JoJo Stained Glass 3-4","texture_floor1_filter":"opacity(30%) hue-rotate(60deg)","plainteam":true,"teamtile_filter":"saturate(150%) brightness(65%)","texture_team":"select-Eek","texture_team_filter":"saturate(0)","texture_team_gco":"destination-in","plainendzone":true,"plainendzone_color_use":true,"texture_endzone":"select-Medium Random Checks","wallshadow_size":"0","wallshadow_blur":"6","wallshadow_opacity":"1","wallshadow_inner":true,"walloutline2_size":"1","walloutline3_size":"1","walls_filter":"drop-shadow(3px 3px 4px black) brightness(135%)","texture_walls1":"select-JoJo Metal 7-4","texture_walls1_filter":"opacity(70%)","texture_walls1_size":"0.3","basecircle1_linewidth":"2","basecircle1_opacity":"1","basecircle1_glow":"4","basecircle1_glow_multiplier":"3","basecircle1_dashpattern":"40,10, 10,5, 5,5, 10,10","flagline_linewidth":"1","flagline_opacity":"0.5","balls_plain":true,"balls_hole_radius":"6","ball_outline1":true,"ball_outline1_linewidth":"1","ball_outline1_segments":"0","ball_outline1_opacity":"1","ball_outline2":true,"ball_outline2_radius":"6","ballskins":true,"ballskins_gco":"source-atop","bombs_outline":true,"bombs_outline_linewidth":"3","bombs_outline_segments":"0","bombs_outline_radius":"3","gate_shadows":true,"plainfloor_color":"#abb2b9","plainendzone_color_red":"#b71c1c","plainendzone_color_blue":"#0d47a1","wallshadow_color":"#101010","walloutline2_color":"#080808","walloutline3_color":"#7f8c8d","ball_outline1_color_red":"#000000","ball_outline1_color_blue":"#000000","ball_outline2_color_red":"#ffffff","ball_outline2_color_blue":"#ffffff","bombs_outline_color":"#a30d0d","ballskins_red_x":"192","ballskins_red_y":"48","ballskins_blue_x":"144","ballskins_blue_y":"192","texture_tiles":"https://i.imgur.com/5kuBe9J.png","texture_speedpad":"/textures/crystal/speedpad.png","texture_speedpadRed":"/textures/crystal/speedpadred.png","texture_speedpadBlue":"/textures/crystal/speedpadblue.png","texture_portal":"https://i.imgur.com/pBZJ01i.png","texture_splats":"https://i.imgur.com/wiV1Yui.png","texture_gravityWell":""},
            'select-John Wick': {"background_color1":"#d90000","background_color2":"#0069d2","background":"value-XFIA","plainfloor":true,"plainfloor_color_use":true,"floor_contour":true,"floor_contour_opacity":"0.75","floor_contour_size":"75","floor_contour_multiplier":"1","grid1_size":"40","grid1_opacity":"0.05","grid1_square":true,"grid1_shadow":true,"plainteam":true,"plainteam_color_use":true,"texture_team":"select-Diagonal Stripes 2","texture_team_filter":"opacity(50%) saturate(0%)","texture_team_gco":"hard-light","plainendzone":true,"plainendzone_color_use":true,"texture_endzone":"select-Large Diagonal Checks","texture_endzone_filter":"opacity(25%) saturate(0%)","texture_endzone_size":"0.4","texture_endzone_gco":"hard-light","plainwalls":true,"walloutline3_size":"3","walls_filter":"drop-shadow(4px 4px 7px black)","centerline_linewidth":"1","flagline_linewidth":"1","balls_plain":true,"balls_hole_radius":"10","ball_outline1":true,"ball_outline1_linewidth":"1","ball_outline1_segments":"0","ball_outline1_opacity":"0.65","ball_outline2":true,"ball_outline2_radius":"11","ball_outline2_opacity":"0.65","ballskins":true,"ballskins_gco":"source-atop","ballskins_scale_red":"0.95","ballskins_filter_red":"drop-shadow(0 0 1px black) drop-shadow(0 0 1px black)","ballskins_scale_blue":"0.95","ballskins_filter_blue":"drop-shadow(0 0 1px black) drop-shadow(0 0 1px black)","spikes_generic":true,"gates_neutral_opacity":"0.4","gates_neutral_margin":"6","gates_neutral_outline":true,"gate_shadows":true,"plainfloor_color":"#000032","floor_contour_color":"#1a237e","grid1_color":"#eeeeee","plainteam_color_red":"#903030","plainteam_color_blue":"#303290","plainteam_color_yellow":"#5d5c19","plainendzone_color_red":"#a30d0d","plainendzone_color_blue":"#1a237e","plainwalls_color":"#000032","walloutline3_color":"#de3600","ball_outline2_color_red":"#ffffff","ball_outline2_color_blue":"#ffffff","ballskins_red_x":"240","ballskins_red_y":"96","ballskins_blue_x":"288","ballskins_blue_y":"192","texture_tiles":"/textures/flat/tiles.png","texture_speedpad":"/textures/flat/speedpad.png","texture_speedpadRed":"/textures/flat/speedpadred.png","texture_speedpadBlue":"/textures/flat/speedpadblue.png","texture_portal":"/textures/flat/portal.png","texture_splats":"/textures/flat/splats.png","texture_gravityWell":""},
            'select-Fliy': {"background_color1":"#14151a","background_color2":"#182230","background":"value-linear","plainfloor":true,"plainfloor_color_use":true,"floor_contour":true,"grid2_size":"1","texture_floor1":"select-Cloudy","texture_floor1_filter":"opacity(50%) saturate(0%)","texture_floor1_size":"0","plainteam":true,"plainteam_color_use":true,"teamtile_filter":"opacity(50%)","texture_team":"select-HexDither","texture_team_filter":"opacity(30%) saturate(0%) invert(100%)","texture_team_size":"0.3","plainendzone":true,"plainendzone_color_use":true,"endzone_checker_size":"7","endzone_checker_margin":"13","endzone_checker_opacity":"0.8","endzone_checker_straight":true,"plainwalls":true,"walloutline2_size":"3","walloutline3_size":"2","walls_filter":"drop-shadow(4px 4px 6px black)","texture_walls2":"select-Eek","texture_walls2_filter":"opacity(60%) saturate(0)","texture_walls2_size":"0.5","texture_walls2_gco":"lighter","centerline_linewidth":"1","flagline_linewidth":"1","flagline_opacity":"0.6","flagline_dashpattern":"10,4","texture_base":"select-Nautical","texture_base_filter":"opacity(20%) drop-shadow(0 0 1px white)","texture_base_size":"0.5","balls_plain":true,"balls_hole_radius":"12","ball_outline1":true,"ball_outline1_linewidth":"4","ball_outline1_segments":"6","ball_outline1_radius":"17","ballskins":true,"ballskins_scale_red":"0.6","ballskins_scale_blue":"0.6","spikes_generic":true,"bombs_draw_exploded_20pc":true,"gates_plain_neutral":true,"gates_neutral_opacity":"0.5","gates_neutral_margin":"15","gates_neutral_outline":true,"gate_shadows":true,"plainfloor_color":"#101010","plainteam_color_red":"#800000","plainteam_color_blue":"#0737a6","plainteam_color_yellow":"#9e7900","plainendzone_color_red":"#570000","plainendzone_color_blue":"#043071","endzone_checker_color":"#ffffff","plainwalls_color":"#abb2b9","walloutline2_color":"#101010","walloutline3_color":"#c6c8ca","gates_plain_neutral_color":"#bdbdbd","ballskins_red_x":"48","ballskins_red_y":"96","ballskins_blue_x":"48","ballskins_blue_y":"96","texture_tiles":"/textures/sparkle/tiles.png","texture_speedpad":"/textures/sparkle/speedpad.png","texture_speedpadRed":"/textures/sparkle/speedpadred.png","texture_speedpadBlue":"/textures/sparkle/speedpadblue.png","texture_portal":"/textures/sparkle/portal.png","texture_splats":"/textures/sparkle/splats.png","texture_gravityWell":""},
            'select-8 Bit': {"background_color2":"#408080","background_size":"75","background":"value-ellipse","plainfloor":true,"texture_floor1":"select-Eek","texture_floor1_filter":"opacity(60%) saturate(0)","texture_floor1_size":"1.25","texture_floor1_gco":"hard-light","texture_floor2":"select-Cartoony Grass Tiles","texture_floor2_filter":"opacity(80%) saturate(0)","texture_floor2_gco":"hard-light","plainteam":true,"teamtile_filter":"opacity(50%)","texture_team":"select-Diamond Plate","texture_team_filter":"opacity(80%) saturate(0%)","texture_team_size":"0.5","texture_team_gco":"hard-light","texture_endzone":"select-Eek","texture_endzone_filter":"opacity(60%) saturate(0)","texture_endzone_size":"0.6","texture_endzone_gco":"hard-light","wallshadow_size":"3","wallshadow_opacity":"0.5","wallshadow_outer":true,"walloutline2_size":"3","walloutline3_size":"1","texture_walls1":"select-Swirly Shards","texture_walls1_filter":"opacity(55%)","texture_walls1_size":"0","texture_walls1_gco":"hard-light","basecircle1_linewidth":"2","basecircle1_opacity":"1","basecircle1_glow":"4","basecircle1_glow_multiplier":"3","basecircle1_dashpattern":"40,10, 10,5, 5,5, 10,10","flagline_linewidth":"1","flagline_opacity":"0.5","spikes_filter":"drop-shadow(3px 3px 2px rgba(0,0,0,0.7))","bombs_filter":"drop-shadow(0 0 4px rgba(255, 153, 255, 0.5))","gates_neutral_opacity":"0.4","gate_shadows":true,"flags_glow":true,"pups_glow":true,"pups_glow_outline":true,"plainfloor_color":"#424242","plainteam_color_red":"#a30d0d","plainteam_color_blue":"#0d47a1","plainteam_color_yellow":"#666600","walloutline2_color":"#0a0f13","walloutline3_color":"#cfd8dc","flagline_color":"#dcedc8","texture_tiles":"https://i.imgur.com/hYW0AKU.png","texture_speedpad":"https://i.imgur.com/nTPOt5C.png","texture_speedpadRed":"https://i.imgur.com/ded8r1T.png","texture_speedpadBlue":"https://i.imgur.com/OFEYTgy.png","texture_portal":"https://i.imgur.com/3SYCwY5.png","texture_splats":"https://i.imgur.com/IIFG2nS.png","texture_gravityWell":""},
            'select-Dude': {"background_color1":"#010d23","background_color2":"#814141","background":"value-ellipse","checker1_size":"40","teamtile_filter":"opacity(70%)","wallshadow_size":"3","wallshadow_opacity":"0.5","wallshadow_outer":true,"walloutline2_size":"3","walloutline3_size":"1","texture_walls2":"select-Spectrum Blur","texture_walls2_filter":"opacity(40%)","texture_walls2_size":"0","texture_walls2_gco":"luminosity","basecircle1_linewidth":"5","basecircle1_radius":"250","basecircle1_opacity":"0.65","basecircle1_dashpattern":"20,5","basecircle2_radius":"290","basecircle2_opacity":"1","basecircle2_glow":"4","basecircle2_glow_multiplier":"3","basecircle2_dashpattern":"40,30","balls_hole_radius":"12","ball_outline1":true,"ball_outline2":true,"ball_outline2_radius":"12","ball_outline2_opacity":"0.65","ballskins":true,"ballskins_scale_red":"0.45","ballskins_filter_red":"invert(100%)","ballskins_scale_blue":"0.4","ballskins_filter_blue":"invert(100%)","gates_neutral_opacity":"0.6","gates_neutral_margin":"5","gates_neutral_outline":true,"gate_shadows":true,"walloutline2_color":"#000000","walloutline3_color":"#eceff1","ballskins_red_x":"192","ballskins_red_y":"48","ballskins_blue_x":"192","ballskins_blue_y":"0","texture_tiles":"https://i.imgur.com/sOCnOwR.png","texture_speedpad":"https://i.imgur.com/IJDyrQu.png","texture_speedpadRed":"https://i.imgur.com/p3FYyPR.png","texture_speedpadBlue":"https://i.imgur.com/YHR5gjx.png","texture_portal":"https://i.imgur.com/6hhILt4.png","texture_splats":"https://i.imgur.com/wiV1Yui.png","texture_gravityWell":""},
            'select-Atlas': {"background_color1":"#010d23","background_color2":"#814141","background":"value-Neon Shallows","plainfloor":true,"plainfloor_color_use":true,"floor_contour":true,"floor_contour_opacity":"0.8","floor_contour_size":"120","floor_contour_multiplier":"1","checker1_size":"10","checker1_opacity":"0.2","texture_floor2":"select-Atlas Academy","texture_floor2_filter":"opacity(80%)","texture_floor2_gco":"screen","plainteam":true,"plainteam_color_use":true,"texture_team":"select-Hexes #6","texture_team_filter":"opacity(50%)","texture_team_size":"0.25","plainendzone":true,"plainendzone_color_use":true,"texture_endzone":"select-Flag","texture_endzone_filter":"opacity(50%) saturate(0%)","texture_endzone_size":"0.45","wallshadow_size":"3","wallshadow_opacity":"0.5","wallshadow_outer":true,"walloutline2_size":"3","walloutline3_size":"1","texture_walls2":"select-HL2 Metal #5","texture_walls2_filter":"opacity(100%) saturate(150%) contrast(120%)","texture_walls2_size":"0.5","texture_walls2_gco":"source-over","basecircle1_radius":"250","basecircle1_opacity":"0.35","basecircle1_gradient":true,"basecircle2_radius":"290","basecircle2_opacity":"1","basecircle2_glow":"4","basecircle2_glow_multiplier":"3","basecircle2_dashpattern":"40,30","texture_base":"select-Spiral","texture_base_filter":"opacity(20%) saturate(0) brightness(0)","texture_base_size":"0.5","bombs_outline":true,"bombs_draw_exploded_20pc":true,"gates_neutral_opacity":"0.6","gate_shadows":true,"boosts_outline":true,"boosts_outline_linewidth":"3.5","boosts_outline_dashpattern":"","plainfloor_color":"#0a0f16","plainteam_color_red":"#903030","plainteam_color_blue":"#34637a","plainteam_color_yellow":"#908f30","plainendzone_color_red":"#400000","plainendzone_color_blue":"#002140","walloutline2_color":"#000000","walloutline3_color":"#e0e0e0","bombs_outline_color":"#ff8a65","texture_tiles":"https://i.imgur.com/auGwfdD.png","texture_speedpad":"/textures/crystal/speedpad.png","texture_speedpadRed":"/textures/crystal/speedpadred.png","texture_speedpadBlue":"/textures/crystal/speedpadblue.png","texture_portal":"https://i.imgur.com/BHltUAU.png","texture_splats":"/textures/turbo/splats.png","texture_gravityWell":""},
            'select-Celeste': {"background":"value-Celeste","checker1_size":"40","checker1_opacity":"0.04","checker1_normal":true,"grid1_size":"80","grid1_length":"80","grid1_width":"2","grid1_opacity":"0.1","grid1_square":true,"grid2_size":"80","grid2_length":"80","grid2_width":"2","grid2_opacity":"0.03","grid2_diagonal":true,"texture_floor1":"select-Metro","texture_floor1_filter":"opacity(15%) saturate(100%) brightness(300%) contrast(150%)","texture_floor1_gco":"screen","texture_floor2":"select-Celeste Space","texture_floor2_filter":"opacity(100%)","texture_floor3":"select-Celeste Stars","texture_floor3_filter":"opacity(70%)","texture_floor3_size":"0.7","plainteam":true,"plainteam_color_use":true,"teamtile_gradient":true,"teamtile_filter":"opacity(50%)","texture_team":"select-Metro","texture_team_filter":"opacity(85%) saturate(100%) brightness(300%) contrast(50%)","texture_team_size":"0.75","texture_team_gco":"screen","plainendzone":true,"plainendzone_color_use":true,"texture_endzone":"select-Celeste Moon2","texture_endzone_filter":"opacity(90%)","texture_endzone_gco":"screen","wallshadow_size":"3","wallshadow_blur":"6","wallshadow_opacity":"1","wallshadow_multiplier":"1","wallshadow_inner":true,"wallshadow_outer":true,"walloutline1_size":"3","texture_walls2":"select-Celeste Moon2","texture_walls2_filter":"opacity(40%)","texture_walls2_gco":"source-over","basecircle1_radius":"420","basecircle1_opacity":"0.2","basecircle2_radius":"438","basecircle2_opacity":"0.25","basecircle2_dashpattern":"60,60","texture_logo_automatic":true,"ball_outline1":true,"ball_outline1_linewidth":"3","ball_outline1_segments":"0","ball_outline1_opacity":"1","spikes_filter":"drop-shadow(2px 2px 2px #111111)","gate_shadows":true,"flags_glow":true,"boosts_outline_opacity":"0.1","boosts_outline_linewidth":"2","boosts_outline_dashpattern":"3,6","portals_outline_opacity":"0.1","portals_outline_linewidth":"2","portals_outline_dashpattern":"3,6","portals_outline_fill":true,"checker1_color":"#757575","grid1_color":"#757575","grid2_color":"#757575","plainteam_color_red":"#fe27b3","plainteam_color_blue":"#00f0ff","plainteam_color_yellow":"#27ff4f","plainendzone_color_red":"#c91d8d","plainendzone_color_blue":"#15c4d1","walloutline1_color":"#757575","ball_outline1_color_red":"#ff80d0","ball_outline1_color_blue":"#85f7ff","gates_glow_color_green":"#00d10e","gates_glow_color_red":"#ff0000","gates_glow_color_blue":"#0037ff","flags_glow_color_red":"#ff27b3","flags_glow_color_blue":"#00f0ff","flags_glow_color_yellow":"#fff829","pups_glow_color_tp":"#00ff00","pups_glow_color_rb":"#ffff00","pups_glow_color_jj":"#ae00ff","boosts_outline_color_red":"#fe27b3","boosts_outline_color_blue":"#00f0ff","boosts_outline_color_yellow":"#27fe4f","texture_tiles":"https://i.imgur.com/lwwKDrf.png","texture_speedpad":"https://i.imgur.com/UDslwmA.png","texture_speedpadRed":"https://i.imgur.com/UDslwmA.png","texture_speedpadBlue":"https://i.imgur.com/UDslwmA.png","texture_portal":"https://i.imgur.com/fzgV5Ob.png","texture_splats":"https://i.imgur.com/bEFSaUv.png","texture_gravityWell":"https://i.imgur.com/zPdBr5d.png"},

        }, preset_previews: { //Albums: https://imgur.com/a/JNlUE3A, sloT94a, 1HD2aCy, nBFTMUp, XteGYBu
            'select-Checkered #1':           'https://i.imgur.com/JA054Xz.jpg',
            'select-Checkered #2':           'https://i.imgur.com/FeFP1fd.jpg',
            'select-Aurora':                 'https://i.imgur.com/idn8Xut.jpg',
            'select-Neon Glow':              'https://i.imgur.com/rSoWG9Z.jpg',
            'select-Doom':                   'https://i.imgur.com/ONADqqf.jpg',
            'select-Half-Life 2 #1':         'https://i.imgur.com/6uYVvu5.jpg',
            'select-Half-Life 2 #2':         'https://i.imgur.com/k6m71jq.jpg',
            'select-Half-Life 2 #3':         'https://i.imgur.com/e18KPZG.jpg',
            'select-Half-Life 2 #4':         'https://i.imgur.com/VIYDwC1.jpg',
            'select-Half-Life 2 #5':         'https://i.imgur.com/tNwfxAh.jpg',
            'select-Half-Life 2 #6':         'https://i.imgur.com/wPotcZb.jpg',
            'select-Starlight':              'https://i.imgur.com/WySzU8s.jpg',
            'select-Castle':                 'https://i.imgur.com/vVVYulu.jpg',
            'select-Space':                  'https://i.imgur.com/FgeJz2g.jpg',
            'select-Hex':                    'https://i.imgur.com/rw6CPz5.jpg',
            'select-Anarchy':                'https://i.imgur.com/AGxSYJY.jpg',
            'select-Spider':                 'https://i.imgur.com/DAjbqC7.jpg',
            'select-Constellation':          'https://i.imgur.com/Sjd0HsX.jpg',
            'select-Ripples':                'https://i.imgur.com/glRSjoq.jpg',
            'select-Skulls':                 'https://i.imgur.com/7gPjxzD.jpg',
            'select-Purple Pirate':          'https://i.imgur.com/sx5Nj9k.jpg',
            'select-Graydiant':              'https://i.imgur.com/J4dvhLC.jpg',
            'select-JoJo Metal':             'https://i.imgur.com/xBpGVBa.jpg',
            'select-Jojo Stained Glass':     'https://i.imgur.com/UaEHGEr.jpg',
            'select-John Wick':              'https://i.imgur.com/RG8ySdT.jpg',
            'select-Fliy':                   'https://i.imgur.com/c2R0T5g.jpg',
            'select-8 Bit':                  'https://i.imgur.com/RXRGDXf.jpg',
            'select-Dude':                   'https://i.imgur.com/Ku3niYd.jpg',
            'select-Atlas':                  'https://i.imgur.com/wl9w0lO.jpg',
            'select-Grinch':                 'https://i.imgur.com/q8GZN9q.jpg',

        }, mysaves: {
        }, globalOptions: {
            load_texture_pack: true,
            transparent_viewport: true,
            no_splats: true,
        }, enableExport: true, //used to create presets
    };

    Object.assign(defaultValues.texture_floor1, defaultValues.tiles, defaultValues.textures, defaultValues.patterns, defaultValues.blurs);
    defaultValues.texture_floor2 = defaultValues.texture_floor1;
    defaultValues.texture_floor3 = defaultValues.texture_floor1;
    defaultValues.texture_team = defaultValues.texture_floor1;
    defaultValues.texture_endzone = defaultValues.texture_floor1;
    defaultValues.texture_walls1 = defaultValues.texture_floor1;
    defaultValues.texture_walls2 = defaultValues.texture_floor1;

    defaultValues.texture_logo_blue = defaultValues.texture_logo_red;

    defaultValues.mysaves = GM_getValue('mysaves', {});
    if (GM_getValue('globalOptions')) defaultValues.globalOptions = GM_getValue('globalOptions');

    let savedOptions = Object.assign({}, defaultOptions, GM_getValue('savedOptions'));


    if (location.pathname === '/textures/') {
        //Create new tab...
        $('ul.tab-list').append('<li data-target="#TMOD_Options"><a>Preset Mods</a></li>');
        $('div.tab-content').append('<div id="TMOD_Options" class="tab-pane" style="flex-flow:row; margin:20px; padding:5px; font-size:13px;"></div>');

        $('.tab-list').on('click', 'li', function() {
            $(this).parents('.tab-list').find('li').removeClass('active');
            $(this).parents('.tab-list').parent().find('.tab-pane').removeClass('active').css('display', 'none');
            $(this).addClass('active');
            $( $(this).data('target') ).addClass('active').css('display', 'flex');
        });

        function loadSelectIntoMenu(label, title, name, saveto, update) {
            let string = '';

            if (defaultValues.hasOwnProperty(saveto)) {
                if (update !== 'css') string += '<div class="TMOD_InputContainer"><span class="TMOD_InputContainerLabel' + (update === 'texture' || update === 'preset' ? ' TMOD_ImageSelect" data-target="' + saveto + '"' : '"') + ' title="' + title + '">' + label + ':</span>' +
                    '<select id="TMOD_Select_' + saveto + '" data-saveto="' + saveto + '" data-update="' + update + '" class="TMOD_Input" style="max-width:140px;">' +
                    (update !== 'mysaves' ? '<option value="select-none" data-saveto="' + saveto + '" data-update="' + update + '" title="None">None</option>' : '');

                Object.keys(defaultValues[saveto]).forEach(key => {
                    if (update === 'css') string += '<input type="radio" name="' + name + '" class="TMOD_Input" data-target="' + saveto + '" data-saveto="' + saveto + '" data-savevalue="' + key + '" data-update="' + update + '" title="' + key.slice(6) + '">';
                    else string += '<option value="' + key + '" data-saveto="' + saveto + '" data-savevalue="' + key + '" data-update="' + update + '" title="' + key.slice(7) + '">' + key.slice(7) + '</option>';
                });

                if (update !== 'css') string += '</select></div>';
            }

            return string;
        }

        const FilterStringOptionsTitle = 'Filter String. Options:\n - opacity(#%)\n - brightness(#%)\n - contrast(#%)\n - saturate(#%)\n - blur(#px)\n - drop-shadow(#px #px #px #RRGGBB)\n - sepia(#%)\n - hue-rotate(#deg)';

        function loadGcoOptionsIntoMenu(saveto) {
            return '<select class="TMOD_Input" data-saveto="' + saveto + '_gco" style="max-width:120px;"><option value="source-over">Source-Over</option><option value="source-atop">Source-Atop</option><option value="source-in">Source-In</option><option value="source-out">Source-Out</option><option value="destination-over">Destination-Over</option><option value="destination-in">Destination-In</option><option value="destination-out">Destination-Out</option><option value="destination-atop">Destination-Atop</option><option value="multiply">Multiply</option><option value="screen">Screen</option><option value="hard-light">Hard Light</option><option value="soft-light">Soft Light</option><option value="lighter">Lighter</option><option value="lighten">Lighten</option><option value="darken">Darken</option><option value="color-dodge">Color Burn</option><option value="color-burn">Color Dodge</option><option value="overlay">Overlay</option><option value="difference">Difference</option><option value="exclusion">Exclusion</option><option value="hue">Hue</option><option value="saturation">Saturation</option><option value="color">Color</option><option value="luminosity">Luminosity</option></select>';
        }

        const span_6 = '<span style="display:inline-block; width:6px;">&nbsp;</span>';
        const span_10 = '<span style="display:inline-block; width:10px;">&nbsp;</span>';

        //Build the menu...
        $('#TMOD_Options').append('<div id="TMOD_Options_Inner" style="width:400px; margin:3px; text-align:center;"></div>');
        $('#TMOD_Options').append('<div id="TMOD_ImageSelect_Outer" style="width:660px; margin:10px; text-align:center;"><img id="TMOD_ImageSelect" alt="Loading Preview..." src="" style="max-width:660px; box-shadow:4px 4px 15px black;" /></div></div>');

        //Presets & My Saves...
        $('#TMOD_Options_Inner').append('<div id="TMOD_Header" class="TMOD_Title">Presets<span id="TMOD_ShowAll" style="position:absolute; right:5px; background:rgba(0,0,0,0.5); width:17px; border-radius:50%; cursor:pointer;" title="Show All Options">&#8286;</span></div>');
        $('#TMOD_Options_Inner').append('<div class="TMOD_InputContainer">' + loadSelectIntoMenu('Presets', 'Choose a preset', 'preset', 'preset', 'preset') + '</div>');
        $('#TMOD_Options_Inner').append('<div class="TMOD_InputContainer">' + loadSelectIntoMenu('My Saves', 'Choose a custom saved preset', 'mysaves', 'mysaves', 'mysaves') + '<span id="TMOD_MySaves_Remove" style="margin:0 5px; padding:0 5px; color:red; border:1px solid #555; border-radius:3px; cursor:pointer;" title="Delete this saved preset">-</span><span id="TMOD_MySaves_Add" style="margin:0; padding:0 5px; color:#4f4; border:1px solid #555; border-radius:3px; cursor:pointer;" title="Save this preset">+</span></div>');
        $('#TMOD_Options_Inner').append('<div class="TMOD_InputContainer"><span class="TMOD_InputContainerLabel">Load Texture Pack:</span><input type="checkbox" id="TMOD_LoadTexturePack" title="Load the texture pack associated with this preset (recommended - may take a minute or so for the server to update)"></div>');
        $('#TMOD_Options_Inner').append('<div class="TMOD_InputContainer"><span class="TMOD_InputContainerLabel">Transparent Viewport:</span><input type="checkbox" id="TMOD_Transparent_Viewport" title="Use a Transparent Viewport (no black background)">' + span_6 + '<span class="TMOD_InputContainerLabel">No Splats:</span><input type="checkbox" id="TMOD_No_Splats" title="Don\'t Show Splats"></div>');
        $('#TMOD_Options_Inner').append('<div class="TMOD_InputContainer"><span class="TMOD_InputContainerLabel">Viewport Effect:</span><input type="radio" name="TMOD_VP_Effect" data-savevalue="none" title="Normal">' + span_6 + '<input type="radio" name="TMOD_VP_Effect" data-savevalue="zoomfadein" title="Zoom & Fade In"><input type="radio" name="TMOD_VP_Effect" data-savevalue="blur" title="Blur"><input type="radio" name="TMOD_VP_Effect" data-savevalue="invert" title="Invert"><input type="radio" name="TMOD_VP_Effect" data-savevalue="sepia" title="Sepia"><input type="radio" name="TMOD_VP_Effect" data-savevalue="expando" title="Expando"><input type="radio" name="TMOD_VP_Effect" data-savevalue="spin" title="Spin"><input type="radio" name="TMOD_VP_Effect" data-savevalue="huerotate" title="Hue Rotate"></div>');

        //Options...
        $('#TMOD_Options_Inner').append('<div id="TMOD_Advanced" style=""></div>');

        $('#TMOD_Advanced').append('<div class="TMOD_Title TMOD_Section_Background">Background</div>');
        $('.TMOD_Section_Background').append('<div class="TMOD_InputContainer"><input type="color" class="TMOD_Input" data-saveto="background_color1"><input type="color" class="TMOD_Input" data-saveto="background_color2"><input type="number" class="TMOD_Input" max="100" data-saveto="background_size" title="Only Used for Linear, Corner & Ellipse Gradients"><input type="checkbox" class="TMOD_Input" data-saveto="background_useballcolors" title="Use Ball Colors"></div>');
        $('.TMOD_Section_Background').append('<div class="TMOD_InputContainer"><input type="radio" name="TMOD_BG_Type" class="TMOD_Input" data-saveto="background" data-savevalue="value-none" title="TagPro Default Image">' + span_6 + '<input type="radio" name="TMOD_BG_Type" class="TMOD_Input" data-saveto="background" data-savevalue="value-linear" title="Horizontal Gradient"><input type="radio" name="TMOD_BG_Type" class="TMOD_Input" data-saveto="background" data-savevalue="value-corner" title="Diagonal Gradient"><input type="radio" name="TMOD_BG_Type" class="TMOD_Input" data-saveto="background" data-savevalue="value-ellipse" title="Ellipse Gradient"><input type="radio" name="TMOD_BG_Type" class="TMOD_Input" data-saveto="background" data-savevalue="value-conic" title="Conic Gradient">' + span_6 + '<input type="radio" name="TMOD_BG_Type" class="TMOD_Input" data-saveto="background" data-savevalue="value-rainbow" title="Use Rainbow Gradient (RGB)">' + loadSelectIntoMenu('BG', 'Background Images', 'TMOD_BG_Type', 'background', 'css') + '</div>');

        $('#TMOD_Advanced').append('<div class="TMOD_Title TMOD_Section_Floor">Floor</div>');
        $('.TMOD_Section_Floor').append('<div class="TMOD_InputContainer"><span class="TMOD_InputContainerLabel">Plain:</span><input type="checkbox" class="TMOD_Input" data-saveto="plainfloor" title="Plain Floor"><input type="checkbox" class="TMOD_Input" data-saveto="plainfloor_color_use" title="Use Plain Floor Color"><button class="TMOD_ChooseColor" data-saveto="plainfloor_color" title="Plain Floor Tint Color" /></div>');
        $('.TMOD_Section_Floor').append('<div class="TMOD_InputContainer"><span class="TMOD_InputContainerLabel">Gradient #1:</span><input type="checkbox" class="TMOD_Input" data-saveto="floor_gradient1" title="Floor Gradient #1">' + span_6 + '<input type="radio" name="TMOD_Floor_Gradient1" class="TMOD_Input" data-saveto="floor_gradient1_type" data-savevalue="value-centerline" title="Linear Floor Gradient"><input type="radio" name="TMOD_Floor_Gradient1" class="TMOD_Input" data-saveto="floor_gradient1_type" data-savevalue="value-centercircle" title="Radial Floor Gradient"><input type="radio" name="TMOD_Floor_Gradient1" class="TMOD_Input" data-saveto="floor_gradient1_type" data-savevalue="value-diagonal" title="Diagonal Floor Gradient"><input type="radio" name="TMOD_Floor_Gradient1" class="TMOD_Input" data-saveto="floor_gradient1_type" data-savevalue="value-rdiagonal" title="Opposite Diagonal Floor Gradient"><input type="radio" name="TMOD_Floor_Gradient1" class="TMOD_Input" data-saveto="floor_gradient1_type" data-savevalue="value-flags" title="Flags">' + span_6 + '<button class="TMOD_ChooseColor" data-saveto="floor_gradient1_color1" title="Floor Gradient Color 1" /><input type="number" class="TMOD_Input" data-saveto="floor_gradient1_opacity1" min="0" max="1" step="0.05" title="Opacity">' + span_6 + '<button class="TMOD_ChooseColor" data-saveto="floor_gradient1_color2" title="Floor Gradient Color 2" /><input type="number" class="TMOD_Input" data-saveto="floor_gradient1_opacity2" min="0" max="1" step="0.05" title="Opacity">' + span_6 + '<input type="number" class="TMOD_Input" data-saveto="floor_gradient1_size" min="0" max="100" title="Size"></div>');
        $('.TMOD_Section_Floor').append('<div class="TMOD_InputContainer"><span class="TMOD_InputContainerLabel">Gradient #2:</span><input type="checkbox" class="TMOD_Input" data-saveto="floor_gradient2" title="Floor Gradient #2">' + span_6 + '<input type="radio" name="TMOD_Floor_Gradient2" class="TMOD_Input" data-saveto="floor_gradient2_type" data-savevalue="value-centerline" title="Linear Floor Gradient"><input type="radio" name="TMOD_Floor_Gradient2" class="TMOD_Input" data-saveto="floor_gradient2_type" data-savevalue="value-centercircle" title="Radial Floor Gradient"><input type="radio" name="TMOD_Floor_Gradient2" class="TMOD_Input" data-saveto="floor_gradient2_type" data-savevalue="value-diagonal" title="Diagonal Floor Gradient"><input type="radio" name="TMOD_Floor_Gradient2" class="TMOD_Input" data-saveto="floor_gradient2_type" data-savevalue="value-rdiagonal" title="Opposite Diagonal Floor Gradient"><input type="radio" name="TMOD_Floor_Gradient2" class="TMOD_Input" data-saveto="floor_gradient2_type" data-savevalue="value-flags" title="Flags">' + span_6 + '<button class="TMOD_ChooseColor" data-saveto="floor_gradient2_color1" title="Floor Gradient Color 1" /><input type="number" class="TMOD_Input" data-saveto="floor_gradient2_opacity1" min="0" max="1" step="0.05" title="Opacity">' + span_6 + '<button class="TMOD_ChooseColor" data-saveto="floor_gradient2_color2" title="Floor Gradient Color 2" /><input type="number" class="TMOD_Input" data-saveto="floor_gradient2_opacity2" min="0" max="1" step="0.05" title="Opacity">' + span_6 + '<input type="number" class="TMOD_Input" data-saveto="floor_gradient2_size" min="0" max="100" title="Size"></div>');
        $('.TMOD_Section_Floor').append('<div class="TMOD_InputContainer"><span class="TMOD_InputContainerLabel">Contour:</span><input type="checkbox" class="TMOD_Input" data-saveto="floor_contour" title="Contour Floor Gradient"><button class="TMOD_ChooseColor" data-saveto="floor_contour_color" title="Contour Color" /><input type="number" class="TMOD_Input" data-saveto="floor_contour_opacity" min="0" max="1" step="0.05" title="Opacity"><input type="number" class="TMOD_Input" data-saveto="floor_contour_size" min="1" title="Size"><input type="number" class="TMOD_Input" data-saveto="floor_contour_multiplier" min="1" title="Multiplier"></div>');
        $('.TMOD_Section_Floor').append('<div class="TMOD_InputContainer"><span class="TMOD_InputContainerLabel">Checker:</span><input type="number" class="TMOD_Input" data-saveto="checker1_size" min="0" title="Checker Size (0 for none)"><input type="number" class="TMOD_Input" data-saveto="checker1_margin" title="Checker Margin"><button class="TMOD_ChooseColor" data-saveto="checker1_color" title="Color" /><input type="number" class="TMOD_Input" data-saveto="checker1_opacity" min="0" max="1" step="0.01" title="Opacity"><input type="checkbox" class="TMOD_Input" data-saveto="checker1_normal" title="Normal"><input type="checkbox" class="TMOD_Input" data-saveto="checker1_random" title="Random"><input type="checkbox" class="TMOD_Input" data-saveto="checker1_straight" title="Straight"><input type="checkbox" class="TMOD_Input" data-saveto="checker1_stripes" title="Stripes (Size is the number of stripes. Margin is Blur.)"></div>');
        $('.TMOD_Section_Floor').append('<div class="TMOD_InputContainer"><span class="TMOD_InputContainerLabel">Grid 1:</span><input type="number" class="TMOD_Input" data-saveto="grid1_size" min="0" title="Grid Size (0 for none)"><input type="number" class="TMOD_Input" data-saveto="grid1_length" title="Line Length"><input type="number" class="TMOD_Input" data-saveto="grid1_width" title="Line Width"><button class="TMOD_ChooseColor" data-saveto="grid1_color" title="Color" /><input type="number" class="TMOD_Input" data-saveto="grid1_opacity" min="0" max="1" step="0.01" title="Opacity"><input type="checkbox" class="TMOD_Input" data-saveto="grid1_square" title="Square"><input type="checkbox" class="TMOD_Input" data-saveto="grid1_diagonal" title="Diagonal"><input type="checkbox" class="TMOD_Input" data-saveto="grid1_rectangles" title="Rectangles"><input type="checkbox" class="TMOD_Input" data-saveto="grid1_lines" title="Lines"><input type="checkbox" class="TMOD_Input" data-saveto="grid1_crosses" title="Crosses"><input type="checkbox" class="TMOD_Input" data-saveto="grid1_shadow" title="Also Draw Shadow"></div>');
        $('.TMOD_Section_Floor').append('<div class="TMOD_InputContainer"><span class="TMOD_InputContainerLabel">Grid 2:</span><input type="number" class="TMOD_Input" data-saveto="grid2_size" min="0" title="Grid Size (0 for none)"><input type="number" class="TMOD_Input" data-saveto="grid2_length" title="Line Length"><input type="number" class="TMOD_Input" data-saveto="grid2_width" title="Line Width"><button class="TMOD_ChooseColor" data-saveto="grid2_color" title="Color" /><input type="number" class="TMOD_Input" data-saveto="grid2_opacity" min="0" max="1" step="0.01" title="Opacity"><input type="checkbox" class="TMOD_Input" data-saveto="grid2_square" title="Square"><input type="checkbox" class="TMOD_Input" data-saveto="grid2_diagonal" title="Diagonal"><input type="checkbox" class="TMOD_Input" data-saveto="grid2_rectangles" title="Rectangles"><input type="checkbox" class="TMOD_Input" data-saveto="grid2_lines" title="Lines"><input type="checkbox" class="TMOD_Input" data-saveto="grid2_crosses" title="Crosses"><input type="checkbox" class="TMOD_Input" data-saveto="grid2_shadow" title="Also Draw Shadow"></div>');
        $('.TMOD_Section_Floor').append('<div class="TMOD_InputContainer"><span class="TMOD_InputContainerLabel">Filter:</span><input type="text" class="TMOD_Input" data-saveto="floor_filter" style="max-width:220px; width:220px;" title="' + FilterStringOptionsTitle + '"></div');
        $('.TMOD_Section_Floor').append(loadSelectIntoMenu('Image #1', 'Floor Image #1', 'TMOD_texture_Floor1', 'texture_floor1', 'texture'));
        $('.TMOD_Section_Floor').append('<div class="TMOD_InputContainer"><input type="text" class="TMOD_Input" data-saveto="texture_floor1_filter" style="max-width:220px; width:220px;" title="' + FilterStringOptionsTitle + '"><input type="number" class="TMOD_Input" data-saveto="texture_floor1_size" min="0" max="2" step="0.05" title="Scale">' + loadGcoOptionsIntoMenu('texture_floor1') + '</div>');
        $('.TMOD_Section_Floor').append(loadSelectIntoMenu('Image #2', 'Floor Image #2', 'TMOD_texture_Floor2', 'texture_floor2', 'texture'));
        $('.TMOD_Section_Floor').append('<div class="TMOD_InputContainer"><input type="text" class="TMOD_Input" data-saveto="texture_floor2_filter" style="max-width:220px; width:220px;" title="' + FilterStringOptionsTitle + '"><input type="number" class="TMOD_Input" data-saveto="texture_floor2_size" min="0" max="2" step="0.05" title="Scale">' + loadGcoOptionsIntoMenu('texture_floor2') + '</div>');
        $('.TMOD_Section_Floor').append(loadSelectIntoMenu('Image #3', 'Floor Image #3', 'TMOD_texture_Floor3', 'texture_floor3', 'texture'));
        $('.TMOD_Section_Floor').append('<div class="TMOD_InputContainer"><input type="text" class="TMOD_Input" data-saveto="texture_floor3_filter" style="max-width:220px; width:220px;" title="' + FilterStringOptionsTitle + '"><input type="number" class="TMOD_Input" data-saveto="texture_floor3_size" min="0" max="2" step="0.05" title="Scale">' + loadGcoOptionsIntoMenu('texture_floor3') + '</div>');

        $('#TMOD_Advanced').append('<div class="TMOD_Title TMOD_Section_Team">Team Tiles</div>');
        $('.TMOD_Section_Team').append('<div class="TMOD_InputContainer"><span class="TMOD_InputContainerLabel">Plain:</span><input type="checkbox" class="TMOD_Input" data-saveto="plainteam" title="Plain Team Tiles"><input type="checkbox" class="TMOD_Input" data-saveto="plainteam_color_use" title="Use Plain Team Tiles Color"><button class="TMOD_ChooseColor" data-saveto="plainteam_color_red" title="Red Team Tiles Color" /><button class="TMOD_ChooseColor" data-saveto="plainteam_color_blue" title="Blue Team Tiles Color" /><button class="TMOD_ChooseColor" data-saveto="plainteam_color_yellow" title="Yellow Team Tiles Color" /></div>');
        $('.TMOD_Section_Team').append('<div class="TMOD_InputContainer"><span class="TMOD_InputContainerLabel">Highlight:</span><input type="checkbox" class="TMOD_Input" data-saveto="teamtile_gradient" title="TeamTile Highlight"></div>');
        $('.TMOD_Section_Team').append('<div class="TMOD_InputContainer"><span class="TMOD_InputContainerLabel">Filter:</span><input type="text" class="TMOD_Input" data-saveto="teamtile_filter" style="max-width:220px; width:220px;" title="' + FilterStringOptionsTitle + '"></div');
        $('.TMOD_Section_Team').append(loadSelectIntoMenu('Image', 'Team Tile Image', 'TMOD_texture_Team', 'texture_team', 'texture'));
        $('.TMOD_Section_Team').append('<div class="TMOD_InputContainer"><input type="text" class="TMOD_Input" data-saveto="texture_team_filter" style="max-width:220px; width:220px;" title="' + FilterStringOptionsTitle + '"><input type="number" class="TMOD_Input" data-saveto="texture_team_size" min="0" max="2" step="0.05" title="Scale">' + loadGcoOptionsIntoMenu('texture_team') + '</div>');

        $('#TMOD_Advanced').append('<div class="TMOD_Title TMOD_Section_Endzone">Endzone</div>');
        $('.TMOD_Section_Endzone').append('<div class="TMOD_InputContainer"><span class="TMOD_InputContainerLabel">Plain:</span><input type="checkbox" class="TMOD_Input" data-saveto="plainendzone" title="Plain Endzones"><input type="checkbox" class="TMOD_Input" data-saveto="plainendzone_color_use" title="Use Plain Endzone Color"><button class="TMOD_ChooseColor" data-saveto="plainendzone_color_red" title="Red Endzone Color" /><button class="TMOD_ChooseColor" data-saveto="plainendzone_color_blue" title="Blue Endzone Color" /></div>');
        $('.TMOD_Section_Endzone').append('<div class="TMOD_InputContainer"><span class="TMOD_InputContainerLabel">Checker:</span><input type="number" class="TMOD_Input" data-saveto="endzone_checker_size" min="0" title="Checker Size (0 for none)"><input type="number" class="TMOD_Input" data-saveto="endzone_checker_margin" title="Checker Margin"><button class="TMOD_ChooseColor" data-saveto="endzone_checker_color" title="Color" /><input type="number" class="TMOD_Input" data-saveto="endzone_checker_opacity" min="0" max="1" step="0.01" title="Opacity"><input type="checkbox" class="TMOD_Input" data-saveto="endzone_checker_normal" title="Normal"><input type="checkbox" class="TMOD_Input" data-saveto="endzone_checker_random" title="Random"><input type="checkbox" class="TMOD_Input" data-saveto="endzone_checker_straight" title="Straight"></div>'); //<input type="checkbox" class="TMOD_Input" data-saveto="endzone_checker_stripes" title="Stripes"><input type="text" class="TMOD_Input" data-saveto="endzone_checker_stripes_pattern" style="max-width:80px; width:80px;" title="Custom Stripes Pattern [Position, Line Width, ...]. If empty uses Size & Margin.">
        $('.TMOD_Section_Endzone').append('<div class="TMOD_InputContainer"><span class="TMOD_InputContainerLabel">Filter:</span><input type="text" class="TMOD_Input" data-saveto="endzone_filter" style="max-width:220px; width:220px;" title="' + FilterStringOptionsTitle + '"></div');
        $('.TMOD_Section_Endzone').append(loadSelectIntoMenu('Image', 'Endzone Image', 'TMOD_texture_Endzone', 'texture_endzone', 'texture'));
        $('.TMOD_Section_Endzone').append('<div class="TMOD_InputContainer"><input type="text" class="TMOD_Input" data-saveto="texture_endzone_filter" style="max-width:220px; width:220px;" title="' + FilterStringOptionsTitle + '"><input type="number" class="TMOD_Input" data-saveto="texture_endzone_size" min="0" max="2" step="0.05" title="Scale">' + loadGcoOptionsIntoMenu('texture_endzone') + '</div>');

        $('#TMOD_Advanced').append('<div class="TMOD_Title TMOD_Section_Walls">Walls</div>');
        $('.TMOD_Section_Walls').append('<div class="TMOD_InputContainer"><span class="TMOD_InputContainerLabel">Plain:</span><input type="checkbox" class="TMOD_Input" data-saveto="plainwalls" title="Use Plain Walls"><button class="TMOD_ChooseColor" data-saveto="plainwalls_color" title="Plain Walls Color" /></div>');
        $('.TMOD_Section_Walls').append('<div class="TMOD_InputContainer"><span class="TMOD_InputContainerLabel">Shadows:</span><input type="number" class="TMOD_Input" data-saveto="wallshadow_size" min="-10" max="10" title="Wall Shadow Size"><input type="number" class="TMOD_Input" data-saveto="wallshadow_blur" min="-10" max="10" title="Wall Shadow Blur (0 for None)"><button class="TMOD_ChooseColor" data-saveto="wallshadow_color" title="Wall Shadow Color" /><input type="number" class="TMOD_Input" data-saveto="wallshadow_opacity" min="0" max="1" step="0.05" title="Wall Shadow Opacity"><input type="number" class="TMOD_Input" data-saveto="wallshadow_multiplier" min="1" max="10" title="Wall Shadow Multiplier">' + span_6 + '<input type="checkbox" class="TMOD_Input" data-saveto="wallshadow_inner" title="Inner Shadow"><input type="checkbox" class="TMOD_Input" data-saveto="wallshadow_outer" title="Outer Shadow"></div>');
        $('.TMOD_Section_Walls').append('<div class="TMOD_InputContainer"><span class="TMOD_InputContainerLabel">Outline:</span><input type="number" class="TMOD_Input" data-saveto="walloutline1_size" min="0" max="40" title="Inner Size"><button class="TMOD_ChooseColor" data-saveto="walloutline1_color" title="Inner Color" />' + span_10 + '<input type="number" class="TMOD_Input" data-saveto="walloutline2_size" min="0" max="40" title="Middle Size"><button class="TMOD_ChooseColor" data-saveto="walloutline2_color" title="Middle Color" /><input type="checkbox" class="TMOD_Input" data-saveto="walloutline2_dashed" title="Middle Dashed">&nbsp;<input type="number" class="TMOD_Input" data-saveto="walloutline3_size" min="0" max="40" title="Outer Size"><button class="TMOD_ChooseColor" data-saveto="walloutline3_color" title="Outer Color" /><input type="number" class="TMOD_Input" data-saveto="walloutline3_opacity" min="0" max="1" step="0.05" title="Outer Opacity"></div>');
        $('.TMOD_Section_Walls').append('<div class="TMOD_InputContainer"><span class="TMOD_InputContainerLabel">Filter:</span><input type="text" class="TMOD_Input" data-saveto="walls_filter" style="max-width:220px; width:220px;" title="' + FilterStringOptionsTitle + '"></div');
        $('.TMOD_Section_Walls').append(loadSelectIntoMenu('Image #1', 'Wall Image #1', 'TMOD_texture_Walls1', 'texture_walls1', 'texture'));
        $('.TMOD_Section_Walls').append('<div class="TMOD_InputContainer"><input type="text" class="TMOD_Input" data-saveto="texture_walls1_filter" style="max-width:220px; width:220px;" title="' + FilterStringOptionsTitle + '"><input type="number" class="TMOD_Input" data-saveto="texture_walls1_size" min="0" max="2" step="0.05" title="Scale">' + loadGcoOptionsIntoMenu('texture_walls1') + '</div>');
        $('.TMOD_Section_Walls').append(loadSelectIntoMenu('Image #2', 'Wall Image #2', 'TMOD_texture_Walls2', 'texture_walls2', 'texture'));
        $('.TMOD_Section_Walls').append('<div class="TMOD_InputContainer"><input type="text" class="TMOD_Input" data-saveto="texture_walls2_filter" style="max-width:220px; width:220px;" title="' + FilterStringOptionsTitle + '"><input type="number" class="TMOD_Input" data-saveto="texture_walls2_size" min="0" max="2" step="0.05" title="Scale">' + loadGcoOptionsIntoMenu('texture_walls2') + '</div>');

        $('#TMOD_Advanced').append('<div class="TMOD_Title TMOD_Section_Bases">Bases</div>');
        $('.TMOD_Section_Bases').append('<div class="TMOD_InputContainer"><span class="TMOD_InputContainerLabel">Circle 1:</span><input type="number" class="TMOD_Input" data-saveto="basecircle1_linewidth" min="0" title="Line Width (0 for none)"><input type="number" class="TMOD_Input" data-saveto="basecircle1_radius" min="0" title="Radius"><button class="TMOD_ChooseColor" data-saveto="basecircle1_color" title="Circle 1 Color" /><input type="number" class="TMOD_Input" data-saveto="basecircle1_opacity" min="0" max="1" step="0.05" title="Opacity"><input type="number" class="TMOD_Input" data-saveto="basecircle1_blur" min="0" title="Blur (0 for none)" style="max-width:32px;"><input type="number" class="TMOD_Input" data-saveto="basecircle1_glow" min="0" title="Glow Size (0 for none)" style="max-width:32px;"><input type="number" class="TMOD_Input" data-saveto="basecircle1_glow_multiplier" min="1" title="Base Circle Glow Multiplier" style="max-width:32px;"><input type="text" class="TMOD_Input" data-saveto="basecircle1_dashpattern" title="Dash Pattern [Length, Space, ...] (empty for solid)" style="max-width:60px;"><input type="checkbox" class="TMOD_Input" data-saveto="basecircle1_gradient" title="Use Gradient"><input type="checkbox" class="TMOD_Input" data-saveto="basecircle1_fill" title="Fill"></div>');
        $('.TMOD_Section_Bases').append('<div class="TMOD_InputContainer"><span class="TMOD_InputContainerLabel">Circle 2:</span><input type="number" class="TMOD_Input" data-saveto="basecircle2_linewidth" min="0" title="Line Width (0 for none)"><input type="number" class="TMOD_Input" data-saveto="basecircle2_radius" min="0" title="Radius"><button class="TMOD_ChooseColor" data-saveto="basecircle2_color" title="Circle 2 Color" /><input type="number" class="TMOD_Input" data-saveto="basecircle2_opacity" min="0" max="1" step="0.05" title="Opacity"><input type="number" class="TMOD_Input" data-saveto="basecircle2_blur" min="0" title="Blur (0 for none)" style="max-width:32px;"><input type="number" class="TMOD_Input" data-saveto="basecircle2_glow" min="0" title="Glow Size (0 for none)" style="max-width:32px;"><input type="number" class="TMOD_Input" data-saveto="basecircle2_glow_multiplier" min="1" title="Base Circle Glow Multiplier" style="max-width:32px;"><input type="text" class="TMOD_Input" data-saveto="basecircle2_dashpattern" title="Dash Pattern [Length, Space, ...] (empty for solid)" style="max-width:60px;"><input type="checkbox" class="TMOD_Input" data-saveto="basecircle2_gradient" title="Use Gradient"><input type="checkbox" class="TMOD_Input" data-saveto="basecircle2_fill" title="Fill"></div>');
        $('.TMOD_Section_Bases').append('<div class="TMOD_InputContainer"><span class="TMOD_InputContainerLabel">Center Line:</span><input type="number" class="TMOD_Input" data-saveto="centerline_linewidth" min="0" title="Line Width (0 for none)""><button class="TMOD_ChooseColor" data-saveto="centerline_color" /><input type="number" class="TMOD_Input" data-saveto="centerline_opacity" min="0" max="1" step="0.05" title="Opacity"><input type="text" class="TMOD_Input" data-saveto="centerline_dashpattern" title="Dash Pattern [Length, Space, ...] (empty for solid)" style="max-width:80px;"><input type="number" class="TMOD_Input" data-saveto="centerline_glow" min="0" title="Glow Size (0 for none)" style="max-width:32px;"></div>');
        $('.TMOD_Section_Bases').append('<div class="TMOD_InputContainer"><span class="TMOD_InputContainerLabel">Flag Line:</span><input type="number" class="TMOD_Input" data-saveto="flagline_linewidth" min="0" title="Line Width (0 for none)"><button class="TMOD_ChooseColor" data-saveto="flagline_color" /><input type="number" class="TMOD_Input" data-saveto="flagline_opacity" min="0" max="1" step="0.05" title="Opacity"><input type="text" class="TMOD_Input" data-saveto="flagline_dashpattern" title="Dash Pattern [Length, Space, ...] (empty for solid)" style="max-width:80px;"><input type="number" class="TMOD_Input" data-saveto="flagline_glow" min="0" title="Glow Size (0 for none)" style="max-width:32px;"></div>');
        $('.TMOD_Section_Bases').append(loadSelectIntoMenu('Base Image', 'Base Image', 'TMOD_Base_Circle_Image', 'texture_base', 'texture'));
        $('.TMOD_Section_Bases').append('<div class="TMOD_InputContainer"><input type="text" class="TMOD_Input" data-saveto="texture_base_filter" style="max-width:220px; width:220px;" title="' + FilterStringOptionsTitle + '"><input type="number" class="TMOD_Input" data-saveto="texture_base_size" min="0" max="2" step="0.05" title="Scale">' + loadGcoOptionsIntoMenu('texture_base') + '</div>');
        $('.TMOD_Section_Bases').append(loadSelectIntoMenu('Center Image', 'Center Image', 'TMOD_Center_Image', 'texture_center', 'texture'));
        $('.TMOD_Section_Bases').append('<div class="TMOD_InputContainer"><input type="text" class="TMOD_Input" data-saveto="texture_center_filter" style="max-width:220px; width:220px;" title="' + FilterStringOptionsTitle + '"><input type="number" class="TMOD_Input" data-saveto="texture_center_size" min="0" max="2" step="0.05" title="Scale"></div>');

        $('#TMOD_Advanced').append('<div class="TMOD_Title TMOD_Section_Logos">Competitive Logos</div>');
        $('.TMOD_Section_Logos').append('<div class="TMOD_InputContainer" title="Logos get matched by the Red/Blue Team Names from the Group and will be rendered at the correct base. The values below will be ignored if this option is checked. The Team Name has to be exact for this to work (e.g. &quot;ABO&quot;, &quot;MABO&quot; and &quot;MLTP-MABO&quot; will all work, but &quot;MBAO&quot; will fail.)\n\nUncheck to use the options below (logos will also be drawn in pubs if unchecked)."><span class="TMOD_InputContainerLabel">Use Group Names:</span><input type="checkbox" class="TMOD_Input" data-saveto="texture_logo_automatic"></div>');
        $('.TMOD_Section_Logos').append(loadSelectIntoMenu('Red Team Logo', 'Red Team Logo', 'TMOD_Base_Logo_Red_Image', 'texture_logo_red', 'texture'));
        $('.TMOD_Section_Logos').append('<div class="TMOD_InputContainer"><input type="text" class="TMOD_Input" data-saveto="texture_logo_red_filter" style="max-width:180px; width:180px;" title="' + FilterStringOptionsTitle + '"><input type="number" class="TMOD_Input" data-saveto="texture_logo_red_size" min="0" max="2" step="0.05" title="Scale"><input type="number" class="TMOD_Input" data-saveto="texture_logo_red_xOffset" title="X Offset"><input type="number" class="TMOD_Input" data-saveto="texture_logo_red_yOffset" title="Y Offset"></div>');
        $('.TMOD_Section_Logos').append(loadSelectIntoMenu('Blue Team Logo', 'Blue Team Logo', 'TMOD_Base_Logo_Blue_Image', 'texture_logo_blue', 'texture'));
        $('.TMOD_Section_Logos').append('<div class="TMOD_InputContainer"><input type="text" class="TMOD_Input" data-saveto="texture_logo_blue_filter" style="max-width:180px; width:180px;" title="' + FilterStringOptionsTitle + '"><input type="number" class="TMOD_Input" data-saveto="texture_logo_blue_size" min="0" max="2" step="0.05" title="Scale"><input type="number" class="TMOD_Input" data-saveto="texture_logo_blue_xOffset" title="X Offset"><input type="number" class="TMOD_Input" data-saveto="texture_logo_blue_yOffset" title="Y Offset"></div>');

        $('#TMOD_Advanced').append('<div class="TMOD_Title TMOD_Section_Balls">Balls</div>');
        $('.TMOD_Section_Balls').append('<div style="position:relative;">' +
                                        '  <div class="TMOD_InputContainer"><span class="TMOD_InputContainerLabel">Ball Opacity:</span><input type="number" class="TMOD_Input" data-saveto="balls_opacity" min="0" max="1" step="0.05" title="Ball Opacity">' + span_10 + '<span class="TMOD_InputContainerLabel">Plain Balls:</span><input type="checkbox" class="TMOD_Input" data-saveto="balls_plain" title="Use Plain Balls"><button class="TMOD_ChooseColor" data-saveto="balls_plain_color_red" title="Plain Red Ball Color" /> <button class="TMOD_ChooseColor" data-saveto="balls_plain_color_blue" title="Plain Blue Ball Color" />' + span_10 + '<span class="TMOD_InputContainerLabel">Hole Radius:</span><input type="number" class="TMOD_Input" data-saveto="balls_hole_radius" min="0" max="20" title="Turn a ball into a disc"></div>' +
                                        '  <div class="TMOD_InputContainer"><span class="TMOD_InputContainerLabel">Ball Outline 1:</span><input type="checkbox" class="TMOD_Input" data-saveto="ball_outline1" title="Add Ball Outline"><input type="number" class="TMOD_Input" data-saveto="ball_outline1_linewidth" min="1" title="Line Width"><input type="number" class="TMOD_Input" data-saveto="ball_outline1_segments" min="0" title="# Segments"><input type="number" class="TMOD_Input" data-saveto="ball_outline1_radius" min="1" max="20" title="Radius"><button class="TMOD_ChooseColor" data-saveto="ball_outline1_color_red" title="Red Color" /><button class="TMOD_ChooseColor" data-saveto="ball_outline1_color_blue" title="Blue Color" /><input type="number" class="TMOD_Input" data-saveto="ball_outline1_opacity" min="0" max="1" step="0.05" title="Opacity"></div>' +
                                        '  <div class="TMOD_InputContainer"><span class="TMOD_InputContainerLabel">Ball Outline 2:</span><input type="checkbox" class="TMOD_Input" data-saveto="ball_outline2" title="Add Ball Outline"><input type="number" class="TMOD_Input" data-saveto="ball_outline2_linewidth" min="1" title="Line Width"><input type="number" class="TMOD_Input" data-saveto="ball_outline2_segments" min="0" title="# Segments"><input type="number" class="TMOD_Input" data-saveto="ball_outline2_radius" min="1" max="20" title="Radius"><button class="TMOD_ChooseColor" data-saveto="ball_outline2_color_red" title="Red Color" /><button class="TMOD_ChooseColor" data-saveto="ball_outline2_color_blue" title="Blue Color" /><input type="number" class="TMOD_Input" data-saveto="ball_outline2_opacity" min="0" max="1" step="0.05" title="Opacity"></div>' +
                                        '  <div class="TMOD_InputContainer"><span class="TMOD_InputContainerLabel">Ball Outline 3:</span><input type="checkbox" class="TMOD_Input" data-saveto="ball_outline3" title="Add Ball Outline"><input type="number" class="TMOD_Input" data-saveto="ball_outline3_linewidth" min="1" title="Line Width"><input type="number" class="TMOD_Input" data-saveto="ball_outline3_segments" min="0" title="# Segments"><input type="number" class="TMOD_Input" data-saveto="ball_outline3_radius" min="1" max="20" title="Radius"><button class="TMOD_ChooseColor" data-saveto="ball_outline3_color_red" title="Red Color" /><button class="TMOD_ChooseColor" data-saveto="ball_outline3_color_blue" title="Blue Color" /><input type="number" class="TMOD_Input" data-saveto="ball_outline3_opacity" min="0" max="1" step="0.05" title="Opacity"></div>' +
                                        '  <div class="TMOD_InputContainer"><span class="TMOD_InputContainerLabel">Ball Skins:</span><input type="checkbox" class="TMOD_Input" data-saveto="ballskins" title="Use Ball Skins"><input type="number" min="0" max="1" step="0.05" class="TMOD_Input" data-saveto="ballskins_opacity" title="Ball Skin Opacity">' + loadGcoOptionsIntoMenu('ballskins') + '</div>' +
                                        '  <div class="TMOD_InputContainer"><div id="TMOD_Options_Skins" style="display:flex; flex-flow:column wrap; width:300px; height:114px; transform:scale(0.7); margin:-16px 0 -12px 0; overflow-x:scroll; overflow-y:hidden;"></div></div>' +
                                        '  <div class="TMOD_InputContainer"><span class="TMOD_InputContainerLabel">Red:</span><input type="number" min="0" max="1" step="0.05" class="TMOD_Input" data-saveto="ballskins_scale_red" title="Scale (40px = 0.83; 48px = 1)"><input type="text" class="TMOD_Input" data-saveto="ballskins_filter_red" style="max-width:220px; width:220px;" title="' + FilterStringOptionsTitle + '"></div>' + //<input type="number" min="0" max="1" step="0.05" class="TMOD_Input" data-saveto="ballskins_brightness_red" title="Red Ballskin Brightness">
                                        '  <div class="TMOD_InputContainer"><span class="TMOD_InputContainerLabel">Blue:</span><input type="number" min="0" max="1" step="0.05" class="TMOD_Input" data-saveto="ballskins_scale_blue" title="Scale (40px = 0.83; 48px = 1)"><input type="text" class="TMOD_Input" data-saveto="ballskins_filter_blue" style="max-width:220px; width:220px;" title="' + FilterStringOptionsTitle + '"></div>' + //<input type="number" min="0" max="1" step="0.05" class="TMOD_Input" data-saveto="ballskins_brightness_blue" title="Blue Ballskin Brightness">
                                        '</div>');

        $('#TMOD_Advanced').append('<div class="TMOD_Title TMOD_Section_Extras">Other</div>');
        $('.TMOD_Section_Extras').append('<div style="position:relative;">' +
                                         '  <div class="TMOD_InputContainer"><span class="TMOD_InputContainerLabel">Custom Spike:</span><input type="checkbox" class="TMOD_Input" data-saveto="spikes_generic" title="Draw Custom Spike"><button class="TMOD_ChooseColor" data-saveto="spikes_generic_color" title="Color" /><input type="number" class="TMOD_Input" data-saveto="spikes_generic_points" min="0" title="# Points"><input type="number" class="TMOD_Input" data-saveto="spikes_generic_innerradius" min="0" title="Inner Radius (Outer Radius is 14px)"><input type="number" class="TMOD_Input" data-saveto="spikes_generic_holeradius" min="0" title="Hole Radius"></div>' +
                                         '  <div class="TMOD_InputContainer"><span class="TMOD_InputContainerLabel">Spikes:</span><input type="text" class="TMOD_Input" data-saveto="spikes_filter" style="max-width:200px; width:200px;" title="' + FilterStringOptionsTitle + '">' + span_6 + '<input type="checkbox" class="TMOD_Input" data-saveto="spikes_border" title="Add Border"><button class="TMOD_ChooseColor" data-saveto="spikes_border_color" title="Color" /></div>' +
                                         '  <div class="TMOD_InputContainer"><span class="TMOD_InputContainerLabel">Custom Button:</span><input type="checkbox" class="TMOD_Input" data-saveto="buttons_generic" title="Draw Custom Button"><button class="TMOD_ChooseColor" data-saveto="buttons_generic_color_inner" title="Center Color" /><button class="TMOD_ChooseColor" data-saveto="buttons_generic_color_outer" title="Mid Color" /><button class="TMOD_ChooseColor" data-saveto="buttons_generic_color_border" title="Border Color" /></div>' +
                                         '  <div class="TMOD_InputContainer"><span class="TMOD_InputContainerLabel">Bombs Outline:</span><input type="checkbox" class="TMOD_Input" data-saveto="bombs_outline" title="Add Bomb Outline"><input type="number" class="TMOD_Input" data-saveto="bombs_outline_linewidth" min="1" title="Line Width"><input type="number" class="TMOD_Input" data-saveto="bombs_outline_segments" min="0" title="# Segments"><input type="number" class="TMOD_Input" data-saveto="bombs_outline_radius" min="1" max="16" title="Radius"><button class="TMOD_ChooseColor" data-saveto="bombs_outline_color" title="Color" /><input type="number" class="TMOD_Input" data-saveto="bombs_outline_opacity" min="0" max="1" step="0.05" title="Opacity">' + span_10 + '<input type="checkbox" class="TMOD_Input" data-saveto="bombs_draw_exploded_20pc" title="Draw Exploded Bomb as 20% Opacity of Normal Bomb Tile"></div>' +
                                         '  <div class="TMOD_InputContainer"><span class="TMOD_InputContainerLabel">Bombs Filter:</span><input type="text" class="TMOD_Input" data-saveto="bombs_filter" style="max-width:200px; width:200px;" title="' + FilterStringOptionsTitle + '"></div>' +
                                         '  <div class="TMOD_InputContainer"><span class="TMOD_InputContainerLabel">Gates:</span><input type="checkbox" class="TMOD_Input" data-saveto="gates_plain_neutral" title="Use Plain Neutral Gates"><button class="TMOD_ChooseColor" data-saveto="gates_plain_neutral_color" title="Plain Neutral Gate Color" />' + span_6 + '<input type="number" class="TMOD_Input" data-saveto="gates_neutral_opacity" min="0" max="1" step="0.05" title="Neutral Gate Opacity"><input type="number" class="TMOD_Input" data-saveto="gates_neutral_margin" min="0" max="10" title="Neutral Gate Margin"><input type="checkbox" class="TMOD_Input" data-saveto="gates_neutral_outline" title="Neutral Gate Border">' + span_10 + '<input type="checkbox" class="TMOD_Input" data-saveto="gates_plain_grb" title="Use Plain Colored Gates (Green/Red/Blue)"><button class="TMOD_ChooseColor" data-saveto="gates_plain_grb_green" title="Plain Green Gate Color" /><button class="TMOD_ChooseColor" data-saveto="gates_plain_grb_red" title="Plain Red Gate Color" /><button class="TMOD_ChooseColor" data-saveto="gates_plain_grb_blue" title="Plain Blue Gate Color" />' + span_10 + '<input type="checkbox" class="TMOD_Input" data-saveto="gate_shadows" title="Add Gate Shadows"></div>' +
                                         '  <div class="TMOD_InputContainer"><span class="TMOD_InputContainerLabel">Glow Gates:</span><input type="checkbox" class="TMOD_Input" data-saveto="gates_glow" title="Use Glow Gates"><button class="TMOD_ChooseColor" data-saveto="gates_glow_color_green" title="Green Glow Gates Color" /><button class="TMOD_ChooseColor" data-saveto="gates_glow_color_red" title="Red Glow Gates Color" /><button class="TMOD_ChooseColor" data-saveto="gates_glow_color_blue" title="Blue Glow Gates Color" />' + span_6 + '<input type="checkbox" class="TMOD_Input" data-saveto="gates_glow_outline" title="Add White Outline"></div>' +
                                         '  <div class="TMOD_InputContainer"><span class="TMOD_InputContainerLabel">Flags Outline:</span><input type="checkbox" class="TMOD_Input" data-saveto="flags_outline" title="Add Flag Outline"><input type="number" class="TMOD_Input" data-saveto="flags_outline_linewidth" min="1" title="Line Width"><input type="number" class="TMOD_Input" data-saveto="flags_outline_segments" min="0" title="# Segments"><button class="TMOD_ChooseColor" data-saveto="flags_outline_color" title="Color" /><input type="number" class="TMOD_Input" data-saveto="flags_outline_opacity" min="0" max="1" step="0.05" title="Opacity"></div>' +
                                         '  <div class="TMOD_InputContainer"><span class="TMOD_InputContainerLabel">Flags Glow:</span><input type="checkbox" class="TMOD_Input" data-saveto="flags_glow" title="Use Glow Flags"><button class="TMOD_ChooseColor" data-saveto="flags_glow_color_red" title="Red Flags Glow Color" /><button class="TMOD_ChooseColor" data-saveto="flags_glow_color_blue" title="Blue Flags Glow Color" /><button class="TMOD_ChooseColor" data-saveto="flags_glow_color_yellow" title="Yellow Flags Glow Color" /></div>' +
                                         '  <div class="TMOD_InputContainer"><span class="TMOD_InputContainerLabel">Pups Glow:</span><input type="checkbox" class="TMOD_Input" data-saveto="pups_glow" title="Use Glow Pups"><button class="TMOD_ChooseColor" data-saveto="pups_glow_color_tp" title="TagPro Glow Color" /><button class="TMOD_ChooseColor" data-saveto="pups_glow_color_rb" title="Rolling Bomb Glow Color" /><button class="TMOD_ChooseColor" data-saveto="pups_glow_color_jj" title="Juke Juice Glow Color" /><input type="checkbox" class="TMOD_Input" data-saveto="pups_glow_outline" title="Add White Outline"></div>' +
                                         '  <div class="TMOD_InputContainer"><span class="TMOD_InputContainerLabel">Boosts:</span><input type="checkbox" class="TMOD_Input" data-saveto="boosts_outline" title="Add Outline"><button class="TMOD_ChooseColor" data-saveto="boosts_outline_color_red" title="Red" /><button class="TMOD_ChooseColor" data-saveto="boosts_outline_color_blue" title="Blue" /><button class="TMOD_ChooseColor" data-saveto="boosts_outline_color_yellow" title="Yellow" /><input type="number" class="TMOD_Input" data-saveto="boosts_outline_opacity" min="0" max="1" step="0.05" title="Opacity"><input type="number" class="TMOD_Input" data-saveto="boosts_outline_linewidth" min="1" max="10" step="0.5" title="Line Width"><input type="text" class="TMOD_Input" data-saveto="boosts_outline_dashpattern" title="Dash Pattern [Length, Space, ...] (empty for solid)" style="max-width:50px;"></div>' +
                                         '  <div class="TMOD_InputContainer"><span class="TMOD_InputContainerLabel">Portals:</span><input type="checkbox" class="TMOD_Input" data-saveto="portals_outline" title="Add Outline"><button class="TMOD_ChooseColor" data-saveto="portals_outline_color" title="Color" /><input type="number" class="TMOD_Input" data-saveto="portals_outline_opacity" min="0" max="1" step="0.05" title="Opacity"><input type="number" class="TMOD_Input" data-saveto="portals_outline_linewidth" min="1" max="10" step="0.5" title="Line Width"><input type="text" class="TMOD_Input" data-saveto="portals_outline_dashpattern" title="Dash Pattern [Length, Space, ...] (empty for solid)" style="max-width:50px;"><input type="checkbox" class="TMOD_Input" data-saveto="portals_outline_fill" title="Fill"></div>' +
                                         '  <div class="TMOD_InputContainer"><span class="TMOD_InputContainerLabel">GravityWell:</span><input type="number" class="TMOD_Input" data-saveto="gravityWell_linewidth" min="0" max="100" step="1" title="Line Width (0 for none)"><button class="TMOD_ChooseColor" data-saveto="gravityWell_color" title="Color" /><input type="number" class="TMOD_Input" data-saveto="gravityWell_opacity" min="0" max="1" step="0.05" title="Opacity"><input type="text" class="TMOD_Input" data-saveto="gravityWell_dashpattern" title="Dash Pattern [Length, Space, ...] (empty for solid)" style="max-width:50px;"><input type="checkbox" class="TMOD_Input" data-saveto="gravityWell_gradient" title="Use Fading Gradient"></div>' +
                                         '  <div class="TMOD_InputContainer"><input type="checkbox" class="TMOD_Input" data-saveto="kblogo" title="Add a Koalabeast to the center of the map"><span class="TMOD_InputContainerLabel">Add Koalabeast</span><input type="checkbox" class="TMOD_Input" data-saveto="fill_empty_with_walls" title="Fill empty space around the outside of the map with wall tiles" style="margin-left:10px !important;"><span class="TMOD_InputContainerLabel">Fill Empty Space</span></div>' +
                                         '</div>');



        function removeRedundantExportValues(options) {
            let keys = {
                'grid1_size':                 { test:'0',                 prefix:'grid1' }, //means: if grid1_size === 0 then remove all other options that start with 'grid1'
                'grid2_size':                 { test:'0',                 prefix:'grid2' },
                'checker1_size':              { test:'0',                 prefix:'checker1' },
                'floor_gradient':             { test:'value-none',        prefix:'floor_gradient' },
                'plainfloor':                 { test:false,               prefix:'plainfloor' },
                'plainteam':                  { test:false,               prefix:'plainteam' },
                'plainendzone':               { test:false,               prefix:'plainendzone' },
                'plainwalls':                 { test:false,               prefix:'plainwalls' },
                'walloutline1_size':          { test:'0',                 prefix:'walloutline1' },
                'walloutline2_size':          { test:'0',                 prefix:'walloutline2' },
                'walloutline3_size':          { test:'0',                 prefix:'walloutline3' },
                'endzone_checker_size':       { test:'0',                 prefix:'endzone_checker' },
                'floor_contour':              { test:false,               prefix:'floor_contour' },
                'flagline_linewidth':         { test:'0',                 prefix:'flagline' },
                'centerline_linewidth':       { test:'0',                 prefix:'centerline' },
                'texture_floor1':             { test:'select-none',       prefix:'texture_floor1' },
                'texture_floor2':             { test:'select-none',       prefix:'texture_floor2' },
                'texture_floor3':             { test:'select-none',       prefix:'texture_floor3' },
                'texture_team':               { test:'select-none',       prefix:'texture_team' },
                'texture_endzone':            { test:'select-none',       prefix:'texture_endzone' },
                'texture_walls1':             { test:'select-none',       prefix:'texture_walls1' },
                'texture_walls2':             { test:'select-none',       prefix:'texture_walls2' },
                'texture_base':               { test:'select-none',       prefix:'texture_base' },
                'wallshadow_inner':           { test:false,               prefix:'wallshadow',          second:'wallshadow_outer' },
                'balls_plain':                { test:false,               prefix:'balls_plain' },
                'ball_outline1':              { test:false,               prefix:'ball_outline1' },
                'ball_outline2':              { test:false,               prefix:'ball_outline2' },
                'ball_outline3':              { test:false,               prefix:'ball_outline3' },
                'bombs_outline':              { test:false,               prefix:'bombs_outline' },
                'ballskins':                  { test:false,               prefix:'ballskins' },
                'spikes_generic':             { test:false,               prefix:'spikes_generic' },
                'spikes_border':              { test:false,               prefix:'spikes_border' },
                'buttons_generic':            { test:false,               prefix:'buttons_generic' },
                'gates_plain_neutral':        { test:false,               prefix:'gates_plain_neutral' },
                'gates_plain_grb':            { test:false,               prefix:'gates_plain_grb' },
                'gravityWell_linewidth':      { test:'0',                 prefix:'gravityWell' },
                'texture_center':             { test:'select-none',       prefix:'texture_center' },
                'texture_logo_automatic':     { test:true,                prefix:'texture_logo' },
            };

            Object.keys(keys).forEach(key => {
                console.log(key, options[key]);
                if (!options.hasOwnProperty(key) && (keys[key].hasOwnProperty('second') ? !options.hasOwnProperty(keys[key].second) : true) ||
                    (options.hasOwnProperty(key) && options[key] === keys[key].test) && (keys[key].hasOwnProperty('second') ? options.hasOwnProperty(keys[key].second) && options[keys[key].second] === keys[key].test : true) ) {
                    Object.keys(options).forEach(optionsKey => {
                        if (optionsKey.startsWith(keys[key].prefix) && optionsKey !== key) {
                            console.log('EXPORT DELETING:',optionsKey);
                            delete options[optionsKey];
                        }
                    });
                }
            });
        }

        function convertInputsToJSON() {
            let xOptions = {};

            $('.TMOD_Input').each(function(index, element) {
                if (element.dataset.saveto === undefined) {
                    if (element.id !== 'TMOD_Color_Input') console.warn('Preset Mods - WARNING! undefined saveto for Export:', element);
                    return;
                }
                if (!defaultOptions.hasOwnProperty(element.dataset.saveto)) {
                    console.warn('Preset Mods - WARNING! No default value for Export:', element.dataset.saveto);
                    return;
                }

                if (element.type === 'checkbox') {
                    if (defaultOptions[element.dataset.saveto] !== element.checked) {
                        xOptions[element.dataset.saveto] = element.checked;
                    }

                } else if (element.type === 'radio') {
                    if (element.checked === true && defaultOptions[element.dataset.saveto] !== element.dataset.savevalue) {
                        if (element.checked === true) xOptions[element.dataset.saveto] = element.dataset.savevalue;
                    }

                } else {
                    if (defaultOptions[element.dataset.saveto] !== element.value) {
                        xOptions[element.dataset.saveto] = element.value;
                    }
                }
            });

            $('.TMOD_ChooseColor').each(function(index, element) {
                if (defaultOptions[element.dataset.saveto] !== savedOptions[element.dataset.saveto]) {
                    xOptions[element.dataset.saveto] = savedOptions[element.dataset.saveto];
                }
            });

            if (xOptions.ballskins) {
                xOptions.ballskins_red_x = savedOptions.ballskins_red_x;
                xOptions.ballskins_red_y = savedOptions.ballskins_red_y;
                xOptions.ballskins_blue_x = savedOptions.ballskins_blue_x;
                xOptions.ballskins_blue_y = savedOptions.ballskins_blue_y;
            }

            xOptions.texture_tiles = $('#tiles').val();
            xOptions.texture_speedpad = $('#speedpad').val();
            xOptions.texture_speedpadRed = $('#speedpadRed').val();
            xOptions.texture_speedpadBlue = $('#speedpadBlue').val();
            xOptions.texture_portal = $('#portal').val();
            xOptions.texture_splats = $('#splats').val();
            xOptions.texture_gravityWell = $('#gravityWell').val();

            return xOptions;
        }


        //My Saves...
        $('#TMOD_MySaves_Add').on('click', function() {
            let name = prompt('Options save name:');
            if (name !== null) name = name.trim();

            if (name) {
                let mysaves = GM_getValue('mysaves', {});
                let isNewSave = true;

                if (mysaves.hasOwnProperty('select-' + name)) {
                    if (!confirm('"' + name + '" already exists - OK to overwrite?\n\n')) return;

                    isNewSave = false;
                    delete mysaves['select-' + name];
                }

                let xOptions = convertInputsToJSON();

                removeRedundantExportValues(xOptions);
                delete xOptions.preset;
                delete xOptions.mysaves;
                mysaves['select-' + name] = xOptions;
                GM_setValue('mysaves', mysaves);

                if (isNewSave) {
                    $('#TMOD_Select_mysaves').append('<option value="select-' + name + '" data-saveto="mysaves" data-savevalue="select-' + name + '" data-update="mysaves" title="' + name + '">' + name + '</option>');
                }

                $('#TMOD_Select_preset').val('');
                $('#TMOD_Select_mysaves').val('select-' + name);
                savedOptions.preset = '';
                savedOptions.mysaves = 'select-' + name;
                GM_setValue('savedOptions', savedOptions);
            }
        });
        $('#TMOD_MySaves_Remove').on('click', function() {
            let mysaves = GM_getValue('mysaves', {});
            let name = $('#TMOD_Select_mysaves').val();

            if (name && mysaves.hasOwnProperty(name)) {
                if (!confirm('Delete saved options "' + name.slice(7) + '?\n\n')) return;

                delete mysaves[name];
                GM_setValue('mysaves', mysaves);
                $('#TMOD_Select_mysaves :selected').remove();
                if ($('#TMOD_Select_mysaves :selected').data('savevalue')) {
                    savedOptions.mysaves = $('#TMOD_Select_mysaves :selected').data('savevalue');
                    changePreset(savedOptions.mysaves, 'mysaves');
                } else { //no more saved presets so set preset to none
                    savedOptions.mysaves = '';
                    savedOptions.preset = 'select-none';
                    $('#TMOD_Select_preset').val('select-none');
                    changePreset(savedOptions.preset, 'preset');
                }
                GM_setValue('savedOptions', savedOptions);
            }
        });


        //Import/Export...
        if (defaultValues.enableExport) {
            $('#TMOD_Advanced').append('<div><button id="TMOD_Import_JSON" style="margin:10px; color:black;" title="Import from JSON">Import</button> <button id="TMOD_Export_JSON" style="margin:10px; color:black;" title="Export to JSON (console)">Export</button></div>');

            //Import...
            $('#TMOD_Import_JSON').after('<div id="TMOD_JSON_Input" style="display:none; position:absolute; margin:-100px 0 0; padding:5px; width:400px; color:black; background:#8bc34a; border:2px outset #ace87e; border-radius:8px; box-shadow:5px 5px 15px black; z-index:999">' +
                                         '  <textarea id="TMOD_JSON_Input_Textarea" placeholder="Paste JSON here..." spellcheck=false style="width:100%; height:200px; color:black; resize:none;"></textarea>' +
                                         '  <div style="display:flex; justify-content:space-evenly;"><button id="TMOD_JSON_Input_OK" style="color:black; border-radius:5px; margin:5px; width: 100px;">Import</button> <button id="TMOD_JSON_Input_Close" style="color:black; border-radius:5px; margin:5px; width: 100px;">Cancel</button></div>' +
                                         '</div>');
            $('#TMOD_JSON_Input_OK').on('click', function() {
                let response = $('#TMOD_JSON_Input_Textarea').val();
                let optionsJSON = {};

                if (!response) return;

                try {
                    optionsJSON = JSON.parse(response);
                } catch(e) {
                    alert('An error has occurred. Data string not in JSON format?\n\n',e);
                    return;
                }

                let showall = savedOptions.showall;
                savedOptions = Object.assign({}, defaultOptions);
                Object.assign(savedOptions, optionsJSON);
                savedOptions.preset = '';
                savedOptions.showall = showall;
                GM_setValue('savedOptions', savedOptions);
                updatePreviewImage();
                loadOptions();
                setBallskin();
                $('#TMOD_Select_preset').val('');

                $('#TMOD_JSON_Input').fadeOut(200);
            });
            $('#TMOD_JSON_Input_Close').on('click', function() {
                $('#TMOD_JSON_Input').fadeOut(100);
            });
            $('#TMOD_Import_JSON').on('click', function() {
                $('#TMOD_JSON_Input').fadeIn(100);
            });

            //Export...
            $('#TMOD_Export_JSON').on('click', function() {
                let xOptions = convertInputsToJSON();

                removeRedundantExportValues(xOptions);
                let name = (xOptions.preset || xOptions.mysaves);
                delete xOptions.preset;
                delete xOptions.mysaves;

                console.log('\'' + name + '\': ' + JSON.stringify(xOptions));
            });
        }

        //Color Picker stuff...
        let colorPickerColors = [
            '#ffebee','#fce4ec','#f3e5f5','#ede7f6','#e8eaf6','#e3f2fd','#e1f5fe','#e0f7fa','#e0f2f1','#e8f5e9','#f1f8e9','#f9fbe7','#fffde7','#fff8e1','#fff3e0','#fbe9e7','#efebe9','#fafafa','#eceff1','#f2f4f4','#eaecee',
            '#ffcdd2','#f8bbd0','#e1bee7','#d1c4e9','#c5cae9','#bbdefb','#b3e5fc','#b2ebf2','#b2dfdb','#c8e6c9','#dcedc8','#f0f4c3','#fff9c4','#ffecb3','#ffe0b2','#ffccbc','#d7ccc8','#f5f5f5','#cfd8dc','#e5e8e8','#d5d8dc',
            '#ef9a9a','#f48fb1','#ce93d8','#b39ddb','#9fa8da','#90caf9','#81d4fa','#80deea','#80cbc4','#a5d6a7','#c5e1a5','#e6ee9c','#fff59d','#ffe082','#ffcc80','#ffab91','#bcaaa4','#eeeeee','#b0bec5','#ccd1d1','#abb2b9',
            '#e57373','#f06292','#ba68c8','#9575cd','#7986cb','#64b5f6','#4fc3f7','#4dd0e1','#4db6ac','#81c784','#aed581','#dce775','#fff176','#ffd54f','#ffb74d','#ff8a65','#a1887f','#e0e0e0','#90a4ae','#b2babb','#808b96',
            '#ef5350','#ec407a','#ab47bc','#7e57c2','#5c6bc0','#42a5f5','#29b6f6','#26c6da','#26a69a','#66bb6a','#9ccc65','#d4e157','#ffee58','#ffca28','#ffa726','#ff7043','#8d6e63','#bdbdbd','#78909c','#99a3a4','#566573',
            '#f44336','#e91e63','#9c27b0','#673ab7','#3f51b5','#2196f3','#03a9f4','#00bcd4','#009688','#4caf50','#8bc34a','#cddc39','#ffeb3b','#ffc107','#ff9800','#ff5722','#795548','#9e9e9e','#607d8b','#7f8c8d','#2c3e50',
            '#e53935','#d81b60','#8e24aa','#5e35b1','#3949ab','#1e88e5','#039be5','#00acc1','#00897b','#43a047','#7cb342','#c0ca33','#fdd835','#ffb300','#fb8c00','#f4511e','#6d4c41','#757575','#546e7a','#707b7c','#273746',
            '#d32f2f','#c2185b','#7b1fa2','#512da8','#303f9f','#1976d2','#0288d1','#0097a7','#00796b','#388e3c','#689f38','#afb42b','#fbc02d','#ffa000','#f57c00','#e64a19','#5d4037','#616161','#455a64','#616a6b','#212f3d',
            '#c62828','#ad1457','#6a1b9a','#4527a0','#283593','#1565c0','#0277bd','#00838f','#00695c','#2e7d32','#558b2f','#9e9d24','#f9a825','#ff8f00','#ef6c00','#d84315','#4e342e','#424242','#37474f','#515a5a','#1c2833',
            '#b71c1c','#880e4f','#4a148c','#311b92','#1a237e','#0d47a1','#01579b','#006064','#004d40','#1b5e20','#33691e','#827717','#f57f17','#ff6f00','#e65100','#bf360c','#3e2723','#212121','#263238','#424949','#17202a',
            '#a30d0d','#6d0534','#300871','#1b0c78','#0c1162','#052d89','#003c82','#004448','#003327','#0c420f','#1d4d0e','#675b0a','#f2630a','#ff5300','#de3600','#ad1f04','#261411','#101010','#131c21','#292f2f','#0a0f16',
            '#900606','#560222','#1e035b','#0f0561','#05084c','#021c73','#00286c','#002f33','#002018','#052e07','#103706','#504504','#ee4d04','#ff3d00','#d52300','#9b1201','#160a08','#080808','#0a0f13','#191e1e','#04070b',
            ''       ,''       ,''       ,''       ,''       ,''       ,''       ,''       ,''       ,''       ,''       ,''       ,''       ,''       ,''       ,''       ,''       ,''       ,''       ,''       ,''       ,
            '#c04040','#c07c40','#c0be40','#7fc040','#40c040','#40c07f','#40c0be','#4082c0','#4043c0','#7c40c0','#be40c0','#c0407f','#4585a2','#614761','#614754','#614747','#615247','#615f47','#615f47','#476147','#474961',
            '#903030','#905d30','#908f30','#609030','#309030','#30905f','#30908f','#306290','#303290','#5d3090','#8f3090','#903060','#34637a','#493549','#493540','#493536','#493e35','#494735','#404935','#354935','#353749',
            '#5a1e1e','#5a3a1e','#5a591e','#3c5a1e','#1e5a1e','#1e5a3c','#1e5a59','#1e3d5a','#1e1f5a','#3a1e5a','#591e5a','#5a1e3c','#213f4c','#2d222d','#2d2227','#2d2222','#2d2722','#2d2d22','#282d22','#222d22','#22232d',
            '#ff0000','#ff8000','#ffff00','#80ff00','#00ff00','#00ff80','#00ffff','#0080ff','#0000ff','#7f00ff','#ff00ff','#ff007f','#1696d1','#6d3a6e','#6e3a54','#6e3a3a','#6e523a','#6e6c3a','#546e3a','#3a6e3b','#3a3f6e',
            '#800000','#803c00','#807e00','#3f8000','#008000','#00803f','#00807e','#004280','#000380','#3c0080','#7e0080','#80003f','#0c4b68','#371d37','#371d2b','#371d1e','#37291d','#37361d','#2b371d','#1d371d','#1d2037',
            '#400000','#401e00','#403f00','#204000','#004000','#004020','#00403f','#002140','#000240','#1e0040','#3f0040','#400020','#072534','#1c0f1c','#1c0f15','#1c0f0f','#1c150f','#1c1b0f','#161c0f','#0f1c0f','#0f101c',
            ''       ,''       ,''       ,''       ,''       ,''       ,''       ,''       ,''       ,''       ,''       ,''       ,''       ,''       ,''       ,''       ,''       ,''       ,''       ,''       ,''       ,
            '#ffffff','#000000'
        ];

        $('#TMOD_Advanced').append('<div id="TMOD_ColorPicker" style="position:absolute; display:flex; flex-flow:row wrap; margin:0px 0px 0px 260px; width:380px; top:-50px; background:#111; border:1px dotted white; z-index:1;"></div>'); //bottom:5px; left:5px;
        colorPickerColors.forEach(function(value) {
            if (value) $('#TMOD_ColorPicker').append('<div class="TMOD_Color" data-color="' + value + '" title="' + value + '" style="background:' + value + ';"></div>');
            else $('#TMOD_ColorPicker').append('<div class="TMOD_Color_Empty"></div>');
        });
        $('#TMOD_ColorPicker').append('' + span_6 + '<div id="TMOD_Color_Auto" class="TMOD_Color" data-color="auto" style="background:linear-gradient(#a00, #0a0, #00a);" title="Auto"></div>');
        $('#TMOD_ColorPicker').append(span_10 + '<input type="color" id="TMOD_Color_Input" class="TMOD_Input">');
        $('#TMOD_ColorPicker').append('<button id="TMOD_Color_Cancel" style="position:absolute; color:black; font-size:9px; height:16px; bottom:2px; right:2px;">Cancel</button>');

        function addColorToTitle(saveto, color) {
            let title = 'Color';
            if ($('.TMOD_ChooseColor[data-saveto="' + saveto + '"]').attr('title')) title = $('.TMOD_ChooseColor[data-saveto="' + saveto + '"]').attr('title').replace(' [auto]', '');

            if (title.indexOf('[#') >= 0) {
                title = title.slice(0, title.indexOf('[#') - 1);
            }

            $('.TMOD_ChooseColor[data-saveto="' + saveto + '"]').attr('title', title + ' [' + color + ']');
        }
        function saveColorInput(saveto, color) {
            savedOptions[saveto] = color;
            GM_setValue('savedOptions', savedOptions);

            if (color === 'auto') $('.TMOD_ChooseColor[data-saveto="' + saveto + '"]').css('background', 'linear-gradient(#a00, #0a0, #00a)');
            else if (color !== undefined) $('.TMOD_ChooseColor[data-saveto="' + saveto + '"]').css('background', color);

            addColorToTitle(saveto, color);

            $('#TMOD_ColorPicker').data('saveto', '');
            $('#TMOD_ColorPicker').hide();
        }

        $('#TMOD_ColorPicker').hide();
        $('.TMOD_ChooseColor').each(function(key, value) {
            if (this.dataset.saveto && savedOptions[this.dataset.saveto]) {
                this.style.background = savedOptions[this.dataset.saveto];
            }
            this.style.boxShadow = '0px 0px 1px white';

        });
        $('.TMOD_ChooseColor').on('click', function() {
            if ($('#TMOD_ColorPicker').is(':visible')) {
                $('#TMOD_ColorPicker').hide();
                return;
            }

            let saveto = this.dataset.saveto;

            $(this).after( $('#TMOD_ColorPicker') );
            $('#TMOD_ColorPicker').data('saveto', this.dataset.saveto);
            $('#TMOD_Color_Input').data('saveto', $('#TMOD_ColorPicker').data('saveto'));
            $('#TMOD_Color_Input').val(savedOptions[saveto]);
            $('#TMOD_ColorPicker').fadeIn(100);

            $('.TMOD_Color').each(function(key, value) {
                if (this.dataset.color === savedOptions[saveto]) {
                    this.style.border = '1px dashed #444';
                    this.style.boxShadow = '0px 0px 1px #fff';
                } else {
                    this.style.border = 'none';
                    this.style.boxShadow = 'none';
                }

            });
        });
        $('#TMOD_ColorPicker').on('click', '.TMOD_Color', function() {
            if (!this.dataset.color) return;

            saveColorInput($('#TMOD_ColorPicker').data('saveto'), this.dataset.color);
        });


        $('#TMOD_ShowAll').on('click', function() {
            if (savedOptions.showall) {
                savedOptions.showall = false;
                $('#TMOD_Advanced').slideUp();
            } else {
                savedOptions.showall = true;
                $('#TMOD_Advanced').slideDown();
            }

            GM_setValue('savedOptions', savedOptions);
        });


        function cacheImage(saveto) {
            let url = defaultValues[saveto][savedOptions[saveto]].url;
            let image = new Image();

            image.crossOrigin = 'Anonymous';
            image.src = url;
        }

        $('#TMOD_ImageSelect').on('load', function() {
            let filter = $('#TMOD_ImageSelect').data('filter') || 'none';
            $('#TMOD_ImageSelect').css('filter', filter);
            $('#TMOD_ImageSelect').data('filter', 'none')
        });

        $('body').append('<div id="TMOD_Mask" style="position:absolute; display:none; left:0px; top:0px; width:100%; height:100%; background:rgba(0,0,0,0.6); z-index:999;"></div>');
        $('body').append('<div id="TMOD_PreviewBox" style="position:absolute; display:none; left:120px; top:80px; width:auto; height:auto; border:2px solid #aaa; border-radius:12px; z-index:1000;"><img id="TMOD_PreviewBoxImage" style="border-radius:12px;"/></div>');

        $('#TMOD_ImageSelect').on('click', function() {
            (async() => {
                while (!document.querySelector('#TMOD_ImageSelect').naturalWidth || !document.querySelector('#TMOD_ImageSelect').naturalHeight) {
                    await new Promise(resolve => setTimeout(resolve, 20));
                }

                let screen_width = $(window).width();
                let screen_height = $(window).height();
                let screen_top = $(window).scrollTop();
                let image_width = document.querySelector('#TMOD_ImageSelect').naturalWidth;
                let image_height = document.querySelector('#TMOD_ImageSelect').naturalHeight;

                $('#TMOD_PreviewBox').css('left', (screen_width - image_width) / 2);
                $('#TMOD_PreviewBox').css('top', (screen_height - image_height) / 2 + screen_top);

                $('#TMOD_PreviewBoxImage').attr('src', $('#TMOD_ImageSelect').attr('src'));
                $('#TMOD_Mask, #TMOD_PreviewBox').fadeIn(200);
            })();
        });

        $('#TMOD_Mask, #TMOD_PreviewBox').on('click', function() {
            $('#TMOD_Mask, #TMOD_PreviewBox').fadeOut(100);
        });

        function updatePreviewImage(saveto) {
            const blank_image = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';

            if (saveto && defaultValues[saveto].hasOwnProperty(savedOptions[saveto])) {
                if (saveto === 'preset') {
                    if (defaultValues.preset_previews.hasOwnProperty(savedOptions[saveto]) && defaultValues.preset_previews[savedOptions[saveto]]) {
                        $('#TMOD_ImageSelect').attr('src', defaultValues.preset_previews[savedOptions[saveto]]);
                    } else {
                        $('#TMOD_ImageSelect').attr('src', blank_image);
                    }
                } else {
                    let filter = $('.TMOD_Input[data-saveto="' + saveto + '_filter"]').val() || '';
                    filter = filter.replace(/opacity[(\d)%]*/, '');
                    $('#TMOD_ImageSelect').data('filter', filter.trim());
                    $('#TMOD_ImageSelect').attr('src', defaultValues[saveto][savedOptions[saveto]].url); //
                }
            } else {
                $('#TMOD_ImageSelect').attr('src', blank_image);
            }
        }

        function changePreset(preset, update) {
            let showall = savedOptions.showall;

            savedOptions = Object.assign({}, defaultOptions);

            if (update === 'mysaves') {
                let mysaves = GM_getValue('mysaves', {});
                if (mysaves.hasOwnProperty(preset)) Object.assign(savedOptions, mysaves[preset]);
                savedOptions.preset = '';
                savedOptions.mysaves = preset;
                updatePreviewImage();
            } else {
                if (preset !== 'select-none' && defaultValues[update].hasOwnProperty(preset)) Object.assign(savedOptions, defaultValues[update][preset]);
                savedOptions.preset = preset;
                savedOptions.mysaves = '';
                updatePreviewImage(update);
            }

            savedOptions.showall = showall;
            GM_setValue('savedOptions', savedOptions);

            loadOptions();
            setBallskin();
        }

        function loadOptions(loadTextures=true) {
            Object.keys(savedOptions).forEach(key => {
                if (savedOptions[key] === true || savedOptions[key] === false) { //checkbox
                    $('input.TMOD_Input[data-saveto="' + key + '"]').prop('checked', savedOptions[key]);
                } else if (savedOptions[key].toString().startsWith('value-')) { //radio
                    $('input.TMOD_Input[data-saveto="' + key + '"][data-savevalue="' + savedOptions[key] + '"]').prop('checked', true);
                } else if (savedOptions[key].toString().startsWith('select-')) { //select
                    $('#TMOD_Select_' + key).val(savedOptions[key]);
                } else if ((savedOptions[key].toString().startsWith('#') || savedOptions[key] === 'auto') && !key.startsWith('background_color')) { //color picker
                    $('.TMOD_ChooseColor[data-saveto="' + key + '"]').css('background', savedOptions[key] === 'auto' ? 'linear-gradient(#a00, #0a0, #00a)' : savedOptions[key]);
                    addColorToTitle(key, savedOptions[key]);
                } else { //other
                    $('.TMOD_Input[data-saveto="' + key + '"]').val(savedOptions[key]);
                }
            });

            //if (GM_getValue('LoadTexturePack', true)) {
            if (defaultValues.globalOptions.load_texture_pack) {
                $('#TMOD_LoadTexturePack').prop('checked', true);

                if (loadTextures) {
                    if (savedOptions.texture_tiles) $('#tiles').val(savedOptions.texture_tiles);
                    if (savedOptions.texture_speedpad) $('#speedpad').val(savedOptions.texture_speedpad);
                    if (savedOptions.texture_speedpadRed) $('#speedpadRed').val(savedOptions.texture_speedpadRed);
                    if (savedOptions.texture_speedpadBlue) $('#speedpadBlue').val(savedOptions.texture_speedpadBlue);
                    if (savedOptions.texture_portal) $('#portal').val(savedOptions.texture_portal);
                    //if (savedOptions.texture_portalRed) $('#portal').val(savedOptions.texture_portalRed);
                    //if (savedOptions.texture_portalBlue) $('#portal').val(savedOptions.texture_portalBlue);
                    if (savedOptions.texture_splats) $('#splats').val(savedOptions.texture_splats);
                    if (savedOptions.texture_gravityWell) $('#gravityWell').val(savedOptions.texture_gravityWell);

                    if (savedOptions.preset !== 'select-none') {
                        $('#custom-textures-btn').trigger('click'); //save the textures
                    }
                }
            }

            if (defaultValues.globalOptions.transparent_viewport) {
                $('#TMOD_Transparent_Viewport').prop('checked', true);
            }

            if (defaultValues.globalOptions.no_splats) {
                $('#TMOD_No_Splats').prop('checked', true);
            }

            let vpEffect = GM_getValue('ViewportEffect', 'none');
            $('input[data-savevalue="' + vpEffect + '"]').prop('checked', true);

            $('select.TMOD_Input[data-update="texture"]').each(function(index, element) {
                if (element.value !== 'select-none') {
                    if (defaultValues[element.dataset.saveto].hasOwnProperty(savedOptions[element.dataset.saveto]) && defaultValues[element.dataset.saveto][savedOptions[element.dataset.saveto]].url) {
                        cacheImage(element.dataset.saveto); //browser cache
                    } else {
                        element.value = 'select-none';
                        $('input.TMOD_Input[data-saveto="' + element.dataset.saveto + '_filter' + '"]').val('');
                        $('input.TMOD_Input[data-saveto="' + element.dataset.saveto + '_size' + '"]').val('1');
                    }
                }
            });

            if (savedOptions.showall) $('#TMOD_Advanced').show();
            else $('#TMOD_Advanced').hide();
        }
        loadOptions(false);
        if (savedOptions.preset) updatePreviewImage('preset');
        else updatePreviewImage();

        let skins_image = new Image;
        skins_image.onload = loadBallskinImages;
        skins_image.crossOrigin = 'Anonymous';
        skins_image.src = defaultValues.texture_ballskins['select-Skins'].url;

        function loadBallskinImages() {
            let width = Math.floor(skins_image.width);
            let height = Math.floor(skins_image.height);

            let skinsCanvas = new OffscreenCanvas(width, height);
            let skinsCtx = skinsCanvas.getContext("2d");

            skinsCtx.drawImage(skins_image, 0,0);

            for (let y=0; y<height; y+=48) {
                for (let x=0; x<width; x+=48) {
                    let pixelData = skinsCtx.getImageData(x+4, y+4, 25, 25).data;
                    let isPixelDataTransparent = isTransparent(pixelData);

                    if (!isPixelDataTransparent) {
                        $('#TMOD_Options_Skins').append('  <span class="TMOD_Skin" data-color="red" data-x="' + x + '" data-y="' + y + '" style="background-color:#f77; background-image:url(' + defaultValues.texture_ballskins['select-Skins'].url + '); background-position:-' + x + 'px -' + y + 'px; " title="Red Ball"></span>' +
                                                        '  <span class="TMOD_Skin" data-color="blue" data-x="' + x + '" data-y="' + y + '" style="background-color:#77f; background-image:url(' + defaultValues.texture_ballskins['select-Skins'].url + '); background-position:-' + x + 'px -' + y + 'px;" title="Blue Ball"></span>');
                    }
                }
            }

            $('.TMOD_Skin').on('click', function() {
                if (savedOptions['ballskins_' + this.dataset.color + '_x'] === this.dataset.x && savedOptions['ballskins_' + this.dataset.color + '_y'] === this.dataset.y) {
                    savedOptions['ballskins_' + this.dataset.color + '_x'] = '-1';
                    savedOptions['ballskins_' + this.dataset.color + '_y'] = '-1';
                } else {
                    savedOptions['ballskins_' + this.dataset.color + '_x'] = this.dataset.x;
                    savedOptions['ballskins_' + this.dataset.color + '_y'] = this.dataset.y;
                }

                GM_setValue('savedOptions', savedOptions);

                $('#TMOD_Options_Skins .TMOD_Selected').removeClass('TMOD_Selected');
                $('#TMOD_Options_Skins').find('span[data-color="red"][data-x="' + savedOptions.ballskins_red_x + '"][data-y="' + savedOptions.ballskins_red_y + '"]').addClass('TMOD_Selected');
                $('#TMOD_Options_Skins').find('span[data-color="blue"][data-x="' + savedOptions.ballskins_blue_x + '"][data-y="' + savedOptions.ballskins_blue_y + '"]').addClass('TMOD_Selected');
            });

            skinsCanvas = null;

            setBallskin();
        }

        function setBallskin() {
            $('#TMOD_Options_Skins .TMOD_Selected').removeClass('TMOD_Selected');
            $('#TMOD_Options_Skins').find('span[data-color="red"][data-x="' + savedOptions.ballskins_red_x + '"][data-y="' + savedOptions.ballskins_red_y + '"]').addClass('TMOD_Selected');
            $('#TMOD_Options_Skins').find('span[data-color="blue"][data-x="' + savedOptions.ballskins_blue_x + '"][data-y="' + savedOptions.ballskins_blue_y + '"]').addClass('TMOD_Selected');
        }

        function isTransparent(data) {
            let length = data.length;
            let i = -4;

            while ((i += 4) < length) {
                if (data[i+3]) return false; //found an opaque pixel in the alpha channel
            }

            return true; //all pixels were transparent
        }

        $('.TMOD_ImageSelect').on('click', function() {
            updatePreviewImage(this.dataset.target);
        });

        document.getElementById('TMOD_Color_Cancel').addEventListener('click', function(input) {
            $('#TMOD_ColorPicker').hide();
        });

        document.getElementById('TMOD_Options_Inner').addEventListener('change', function(input) {
            let target = input.target;

            if (target.type === 'color') {
                if (target.id === 'TMOD_Color_Input') {
                    saveColorInput($('#TMOD_Color_Input').data('saveto'), target.value);
                } else {
                    saveColorInput(target.dataset.saveto, target.value);
                }
            }
        });

        document.getElementById('TMOD_Options_Inner').addEventListener('input', function(input) {
            let target = input.target;

            if (target.type === 'color') {
                return false;
            }

            $('#TMOD_ColorPicker').hide();


            if (target.id === 'TMOD_LoadTexturePack') {
                defaultValues.globalOptions.load_texture_pack = target.checked;
                GM_setValue('globalOptions', defaultValues.globalOptions);

                //change the custom texture links and save them...
                if (target.checked) {
                    let response = confirm('Do you want to load the Texture Pack for this Preset now?\n\n');

                    if (response) {
                        if (savedOptions.texture_tiles) $('#tiles').val(savedOptions.texture_tiles);
                        if (savedOptions.texture_speedpad) $('#speedpad').val(savedOptions.texture_speedpad);
                        if (savedOptions.texture_speedpadRed) $('#speedpadRed').val(savedOptions.texture_speedpadRed);
                        if (savedOptions.texture_speedpadBlue) $('#speedpadBlue').val(savedOptions.texture_speedpadBlue);
                        if (savedOptions.texture_portal) $('#portal').val(savedOptions.texture_portal);
                        //if (savedOptions.texture_portalRed) $('#portal').val(savedOptions.texture_portalRed);
                        //if (savedOptions.texture_portalBlue) $('#portal').val(savedOptions.texture_portalBlue);
                        if (savedOptions.texture_splats) $('#splats').val(savedOptions.texture_splats);
                        if (savedOptions.texture_gravityWell) $('#gravityWell').val(savedOptions.texture_gravityWell);

                        $('#custom-textures-btn').trigger('click'); //save the textures
                    }
                }

                return;

            } else if (target.id === 'TMOD_Transparent_Viewport') {
                defaultValues.globalOptions.transparent_viewport = target.checked;
                GM_setValue('globalOptions', defaultValues.globalOptions);

                return;

            } else if (target.id === 'TMOD_No_Splats') {
                defaultValues.globalOptions.no_splats = target.checked;
                GM_setValue('globalOptions', defaultValues.globalOptions);

                return;

            }

            if (target.name === 'TMOD_VP_Effect') {
                GM_setValue('ViewportEffect', target.dataset.savevalue);

                return;
            }

            if (!target.className.includes('TMOD_Input')) return;

            if (target.type === 'checkbox') {
                savedOptions[target.dataset.saveto] = target.checked;

            } else if (target.type === 'radio') {
                if (target.dataset.savevalue) {
                    savedOptions[target.dataset.saveto] = target.dataset.savevalue;
                } else {
                    const radioButtons = document.getElementsByName(target.name);
                    radioButtons.forEach(function(button) {
                        if (button.checked) savedOptions[button.dataset.saveto] = true;
                        else savedOptions[button.dataset.saveto] = false;
                    });
                }

                updatePreviewImage(target.dataset.target);

            } else {
                savedOptions[target.dataset.saveto] = target.value;

                if (target.type === 'select-one') {
                    target = target.options[target.selectedIndex];

                    if (target.dataset.update === 'texture') {
                        if (target.value === 'select-none') {
                            savedOptions[target.dataset.saveto + '_filter'] = '';
                            $('input.TMOD_Input[data-saveto="' + target.dataset.saveto + '_filter' + '"]').val('');
                            savedOptions[target.dataset.saveto + '_size'] = '1';
                            $('input.TMOD_Input[data-saveto="' + target.dataset.saveto + '_size' + '"]').val('1');
                            savedOptions[target.dataset.saveto + '_gco'] = '';
                            $('select.TMOD_Input[data-saveto="' + target.dataset.saveto + '_gco' + '"]').val('source-atop');

                            savedOptions[target.dataset.saveto + '_xOffset'] = '0';
                            $('select.TMOD_Input[data-saveto="' + target.dataset.saveto + '_xOffset' + '"]').val('0');
                            savedOptions[target.dataset.saveto + '_yOffset'] = '0';
                            $('select.TMOD_Input[data-saveto="' + target.dataset.saveto + '_yOffset' + '"]').val('0');

                        } else {
                            savedOptions[target.dataset.saveto + '_filter'] = defaultValues[target.dataset.saveto][target.value].filter;
                            $('input.TMOD_Input[data-saveto="' + target.dataset.saveto + '_filter' + '"]').val(defaultValues[target.dataset.saveto][target.value].filter);
                            savedOptions[target.dataset.saveto + '_size'] = defaultValues[target.dataset.saveto][target.value].size;
                            $('input.TMOD_Input[data-saveto="' + target.dataset.saveto + '_size' + '"]').val(defaultValues[target.dataset.saveto][target.value].size);

                            savedOptions[target.dataset.saveto + '_xOffset'] = defaultValues[target.dataset.saveto][target.value].xOffset;
                            $('input.TMOD_Input[data-saveto="' + target.dataset.saveto + '_xOffset' + '"]').val(defaultValues[target.dataset.saveto][target.value].xOffset);
                            savedOptions[target.dataset.saveto + '_yOffset'] = defaultValues[target.dataset.saveto][target.value].yOffset;
                            $('input.TMOD_Input[data-saveto="' + target.dataset.saveto + '_yOffset' + '"]').val(defaultValues[target.dataset.saveto][target.value].yOffset);
                        }

                        updatePreviewImage(target.dataset.saveto);
                    }
                }
            }

            GM_setValue('savedOptions', savedOptions);

            if (target.dataset.update === 'preset' || target.dataset.update === 'mysaves') {
                changePreset(target.value, target.dataset.update);
            }
        });

        GM_addStyle('.TMOD_Input { color:black; font-size:11px; max-width:40px; margin:0 2px 0 0 !important; }');
        GM_addStyle('.TMOD_Input[type=number] { height:15px; max-width:44px; font-size:10px; }');
        GM_addStyle('.TMOD_Input[type=text] { height:15px; font-size:10px; }')
        GM_addStyle('.TMOD_Input[type=color] { height:15px; border:0px; padding:0px; }');
        GM_addStyle('.TMOD_Title { position:relative; font-size:14px; background:#181818; margin:9px 0 1px 0; padding:4px; }');
        GM_addStyle('.TMOD_InputContainer { position:relative; display:flex; flex-flow:row wrap; align-items:center; justify-content:center; padding:2px 0 0 0; }');
        GM_addStyle('.TMOD_InputContainerLabel { font-size:10px; margin:0 2px 2px 0px; }');
        GM_addStyle('.TMOD_Color { width:17px; height:17px; margin:1px 0 0 1px; }');
        GM_addStyle('.TMOD_Color:hover { border:1px outset #555; cursor:pointer; }');
        GM_addStyle('.TMOD_Color_Empty { width:17px; height:17px; margin:1px 0 0 1px; }');
        GM_addStyle('.TMOD_ChooseColor { width:16px; height:12px; background:linear-gradient(#a00, #0a0, #00a); border:none; margin:0 1px; padding:0px; }');
        GM_addStyle('.TMOD_Skin { margin:1.5px; width:50px; height:50px; }');
        GM_addStyle('.TMOD_Selected { border:1px solid chartreuse; border-radius:50%; }');
        GM_addStyle('#TMOD_Options_Skins::-webkit-scrollbar { height:6px; }');
        GM_addStyle('#TMOD_Options_Skins::-webkit-scrollbar-thumb { background:#292; border-radius:4px; }');
        GM_addStyle('#TMOD_Options_Skins::-webkit-scrollbar-track { background:#ddd; border-radius:4px; }');



    //------------- IN A GAME -------------
        } else if (location.pathname === '/game' || location.port || location.pathname === '/tagpro-vcr/game.html') {
        // TinyColor v1.4.1
        // https://github.com/bgrins/TinyColor
        // 2016-07-07, Brian Grinstead, MIT License
        !function(a){function b(a,d){if(a=a?a:"",d=d||{},a instanceof b)return a;if(!(this instanceof b))return new b(a,d);var e=c(a);this._originalInput=a,this._r=e.r,this._g=e.g,this._b=e.b,this._a=e.a,this._roundA=P(100*this._a)/100,this._format=d.format||e.format,this._gradientType=d.gradientType,this._r<1&&(this._r=P(this._r)),this._g<1&&(this._g=P(this._g)),this._b<1&&(this._b=P(this._b)),this._ok=e.ok,this._tc_id=O++}function c(a){var b={r:0,g:0,b:0},c=1,e=null,g=null,i=null,j=!1,k=!1;return"string"==typeof a&&(a=K(a)),"object"==typeof a&&(J(a.r)&&J(a.g)&&J(a.b)?(b=d(a.r,a.g,a.b),j=!0,k="%"===String(a.r).substr(-1)?"prgb":"rgb"):J(a.h)&&J(a.s)&&J(a.v)?(e=G(a.s),g=G(a.v),b=h(a.h,e,g),j=!0,k="hsv"):J(a.h)&&J(a.s)&&J(a.l)&&(e=G(a.s),i=G(a.l),b=f(a.h,e,i),j=!0,k="hsl"),a.hasOwnProperty("a")&&(c=a.a)),c=z(c),{ok:j,format:a.format||k,r:Q(255,R(b.r,0)),g:Q(255,R(b.g,0)),b:Q(255,R(b.b,0)),a:c}}function d(a,b,c){return{r:255*A(a,255),g:255*A(b,255),b:255*A(c,255)}}function e(a,b,c){a=A(a,255),b=A(b,255),c=A(c,255);var d,e,f=R(a,b,c),g=Q(a,b,c),h=(f+g)/2;if(f==g)d=e=0;else{var i=f-g;switch(e=h>.5?i/(2-f-g):i/(f+g),f){case a:d=(b-c)/i+(c>b?6:0);break;case b:d=(c-a)/i+2;break;case c:d=(a-b)/i+4}d/=6}return{h:d,s:e,l:h}}function f(a,b,c){function d(a,b,c){return 0>c&&(c+=1),c>1&&(c-=1),1/6>c?a+6*(b-a)*c:.5>c?b:2/3>c?a+6*(b-a)*(2/3-c):a}var e,f,g;if(a=A(a,360),b=A(b,100),c=A(c,100),0===b)e=f=g=c;else{var h=.5>c?c*(1+b):c+b-c*b,i=2*c-h;e=d(i,h,a+1/3),f=d(i,h,a),g=d(i,h,a-1/3)}return{r:255*e,g:255*f,b:255*g}}function g(a,b,c){a=A(a,255),b=A(b,255),c=A(c,255);var d,e,f=R(a,b,c),g=Q(a,b,c),h=f,i=f-g;if(e=0===f?0:i/f,f==g)d=0;else{switch(f){case a:d=(b-c)/i+(c>b?6:0);break;case b:d=(c-a)/i+2;break;case c:d=(a-b)/i+4}d/=6}return{h:d,s:e,v:h}}function h(b,c,d){b=6*A(b,360),c=A(c,100),d=A(d,100);var e=a.floor(b),f=b-e,g=d*(1-c),h=d*(1-f*c),i=d*(1-(1-f)*c),j=e%6,k=[d,h,g,g,i,d][j],l=[i,d,d,h,g,g][j],m=[g,g,i,d,d,h][j];return{r:255*k,g:255*l,b:255*m}}function i(a,b,c,d){var e=[F(P(a).toString(16)),F(P(b).toString(16)),F(P(c).toString(16))];return d&&e[0].charAt(0)==e[0].charAt(1)&&e[1].charAt(0)==e[1].charAt(1)&&e[2].charAt(0)==e[2].charAt(1)?e[0].charAt(0)+e[1].charAt(0)+e[2].charAt(0):e.join("")}function j(a,b,c,d,e){var f=[F(P(a).toString(16)),F(P(b).toString(16)),F(P(c).toString(16)),F(H(d))];return e&&f[0].charAt(0)==f[0].charAt(1)&&f[1].charAt(0)==f[1].charAt(1)&&f[2].charAt(0)==f[2].charAt(1)&&f[3].charAt(0)==f[3].charAt(1)?f[0].charAt(0)+f[1].charAt(0)+f[2].charAt(0)+f[3].charAt(0):f.join("")}function k(a,b,c,d){var e=[F(H(d)),F(P(a).toString(16)),F(P(b).toString(16)),F(P(c).toString(16))];return e.join("")}function l(a,c){c=0===c?0:c||10;var d=b(a).toHsl();return d.s-=c/100,d.s=B(d.s),b(d)}function m(a,c){c=0===c?0:c||10;var d=b(a).toHsl();return d.s+=c/100,d.s=B(d.s),b(d)}function n(a){return b(a).desaturate(100)}function o(a,c){c=0===c?0:c||10;var d=b(a).toHsl();return d.l+=c/100,d.l=B(d.l),b(d)}function p(a,c){c=0===c?0:c||10;var d=b(a).toRgb();return d.r=R(0,Q(255,d.r-P(255*-(c/100)))),d.g=R(0,Q(255,d.g-P(255*-(c/100)))),d.b=R(0,Q(255,d.b-P(255*-(c/100)))),b(d)}function q(a,c){c=0===c?0:c||10;var d=b(a).toHsl();return d.l-=c/100,d.l=B(d.l),b(d)}function r(a,c){var d=b(a).toHsl(),e=(d.h+c)%360;return d.h=0>e?360+e:e,b(d)}function s(a){var c=b(a).toHsl();return c.h=(c.h+180)%360,b(c)}function t(a){var c=b(a).toHsl(),d=c.h;return[b(a),b({h:(d+120)%360,s:c.s,l:c.l}),b({h:(d+240)%360,s:c.s,l:c.l})]}function u(a){var c=b(a).toHsl(),d=c.h;return[b(a),b({h:(d+90)%360,s:c.s,l:c.l}),b({h:(d+180)%360,s:c.s,l:c.l}),b({h:(d+270)%360,s:c.s,l:c.l})]}function v(a){var c=b(a).toHsl(),d=c.h;return[b(a),b({h:(d+72)%360,s:c.s,l:c.l}),b({h:(d+216)%360,s:c.s,l:c.l})]}function w(a,c,d){c=c||6,d=d||30;var e=b(a).toHsl(),f=360/d,g=[b(a)];for(e.h=(e.h-(f*c>>1)+720)%360;--c;)e.h=(e.h+f)%360,g.push(b(e));return g}function x(a,c){c=c||6;for(var d=b(a).toHsv(),e=d.h,f=d.s,g=d.v,h=[],i=1/c;c--;)h.push(b({h:e,s:f,v:g})),g=(g+i)%1;return h}function y(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[a[c]]=c);return b}function z(a){return a=parseFloat(a),(isNaN(a)||0>a||a>1)&&(a=1),a}function A(b,c){D(b)&&(b="100%");var d=E(b);return b=Q(c,R(0,parseFloat(b))),d&&(b=parseInt(b*c,10)/100),a.abs(b-c)<1e-6?1:b%c/parseFloat(c)}function B(a){return Q(1,R(0,a))}function C(a){return parseInt(a,16)}function D(a){return"string"==typeof a&&-1!=a.indexOf(".")&&1===parseFloat(a)}function E(a){return"string"==typeof a&&-1!=a.indexOf("%")}function F(a){return 1==a.length?"0"+a:""+a}function G(a){return 1>=a&&(a=100*a+"%"),a}function H(b){return a.round(255*parseFloat(b)).toString(16)}function I(a){return C(a)/255}function J(a){return!!V.CSS_UNIT.exec(a)}function K(a){a=a.replace(M,"").replace(N,"").toLowerCase();var b=!1;if(T[a])a=T[a],b=!0;else if("transparent"==a)return{r:0,g:0,b:0,a:0,format:"name"};var c;return(c=V.rgb.exec(a))?{r:c[1],g:c[2],b:c[3]}:(c=V.rgba.exec(a))?{r:c[1],g:c[2],b:c[3],a:c[4]}:(c=V.hsl.exec(a))?{h:c[1],s:c[2],l:c[3]}:(c=V.hsla.exec(a))?{h:c[1],s:c[2],l:c[3],a:c[4]}:(c=V.hsv.exec(a))?{h:c[1],s:c[2],v:c[3]}:(c=V.hsva.exec(a))?{h:c[1],s:c[2],v:c[3],a:c[4]}:(c=V.hex8.exec(a))?{r:C(c[1]),g:C(c[2]),b:C(c[3]),a:I(c[4]),format:b?"name":"hex8"}:(c=V.hex6.exec(a))?{r:C(c[1]),g:C(c[2]),b:C(c[3]),format:b?"name":"hex"}:(c=V.hex4.exec(a))?{r:C(c[1]+""+c[1]),g:C(c[2]+""+c[2]),b:C(c[3]+""+c[3]),a:I(c[4]+""+c[4]),format:b?"name":"hex8"}:(c=V.hex3.exec(a))?{r:C(c[1]+""+c[1]),g:C(c[2]+""+c[2]),b:C(c[3]+""+c[3]),format:b?"name":"hex"}:!1}function L(a){var b,c;return a=a||{level:"AA",size:"small"},b=(a.level||"AA").toUpperCase(),c=(a.size||"small").toLowerCase(),"AA"!==b&&"AAA"!==b&&(b="AA"),"small"!==c&&"large"!==c&&(c="small"),{level:b,size:c}}var M=/^\s+/,N=/\s+$/,O=0,P=a.round,Q=a.min,R=a.max,S=a.random;b.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var a=this.toRgb();return(299*a.r+587*a.g+114*a.b)/1e3},getLuminance:function(){var b,c,d,e,f,g,h=this.toRgb();return b=h.r/255,c=h.g/255,d=h.b/255,e=.03928>=b?b/12.92:a.pow((b+.055)/1.055,2.4),f=.03928>=c?c/12.92:a.pow((c+.055)/1.055,2.4),g=.03928>=d?d/12.92:a.pow((d+.055)/1.055,2.4),.2126*e+.7152*f+.0722*g},setAlpha:function(a){return this._a=z(a),this._roundA=P(100*this._a)/100,this},toHsv:function(){var a=g(this._r,this._g,this._b);return{h:360*a.h,s:a.s,v:a.v,a:this._a}},toHsvString:function(){var a=g(this._r,this._g,this._b),b=P(360*a.h),c=P(100*a.s),d=P(100*a.v);return 1==this._a?"hsv("+b+", "+c+"%, "+d+"%)":"hsva("+b+", "+c+"%, "+d+"%, "+this._roundA+")"},toHsl:function(){var a=e(this._r,this._g,this._b);return{h:360*a.h,s:a.s,l:a.l,a:this._a}},toHslString:function(){var a=e(this._r,this._g,this._b),b=P(360*a.h),c=P(100*a.s),d=P(100*a.l);return 1==this._a?"hsl("+b+", "+c+"%, "+d+"%)":"hsla("+b+", "+c+"%, "+d+"%, "+this._roundA+")"},toHex:function(a){return i(this._r,this._g,this._b,a)},toHexString:function(a){return"#"+this.toHex(a)},toHex8:function(a){return j(this._r,this._g,this._b,this._a,a)},toHex8String:function(a){return"#"+this.toHex8(a)},toRgb:function(){return{r:P(this._r),g:P(this._g),b:P(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+P(this._r)+", "+P(this._g)+", "+P(this._b)+")":"rgba("+P(this._r)+", "+P(this._g)+", "+P(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:P(100*A(this._r,255))+"%",g:P(100*A(this._g,255))+"%",b:P(100*A(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+P(100*A(this._r,255))+"%, "+P(100*A(this._g,255))+"%, "+P(100*A(this._b,255))+"%)":"rgba("+P(100*A(this._r,255))+"%, "+P(100*A(this._g,255))+"%, "+P(100*A(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":this._a<1?!1:U[i(this._r,this._g,this._b,!0)]||!1},toFilter:function(a){var c="#"+k(this._r,this._g,this._b,this._a),d=c,e=this._gradientType?"GradientType = 1, ":"";if(a){var f=b(a);d="#"+k(f._r,f._g,f._b,f._a)}return"progid:DXImageTransform.Microsoft.gradient("+e+"startColorstr="+c+",endColorstr="+d+")"},toString:function(a){var b=!!a;a=a||this._format;var c=!1,d=this._a<1&&this._a>=0,e=!b&&d&&("hex"===a||"hex6"===a||"hex3"===a||"hex4"===a||"hex8"===a||"name"===a);return e?"name"===a&&0===this._a?this.toName():this.toRgbString():("rgb"===a&&(c=this.toRgbString()),"prgb"===a&&(c=this.toPercentageRgbString()),("hex"===a||"hex6"===a)&&(c=this.toHexString()),"hex3"===a&&(c=this.toHexString(!0)),"hex4"===a&&(c=this.toHex8String(!0)),"hex8"===a&&(c=this.toHex8String()),"name"===a&&(c=this.toName()),"hsl"===a&&(c=this.toHslString()),"hsv"===a&&(c=this.toHsvString()),c||this.toHexString())},clone:function(){return b(this.toString())},_applyModification:function(a,b){var c=a.apply(null,[this].concat([].slice.call(b)));return this._r=c._r,this._g=c._g,this._b=c._b,this.setAlpha(c._a),this},lighten:function(){return this._applyModification(o,arguments)},brighten:function(){return this._applyModification(p,arguments)},darken:function(){return this._applyModification(q,arguments)},desaturate:function(){return this._applyModification(l,arguments)},saturate:function(){return this._applyModification(m,arguments)},greyscale:function(){return this._applyModification(n,arguments)},spin:function(){return this._applyModification(r,arguments)},_applyCombination:function(a,b){return a.apply(null,[this].concat([].slice.call(b)))},analogous:function(){return this._applyCombination(w,arguments)},complement:function(){return this._applyCombination(s,arguments)},monochromatic:function(){return this._applyCombination(x,arguments)},splitcomplement:function(){return this._applyCombination(v,arguments)},triad:function(){return this._applyCombination(t,arguments)},tetrad:function(){return this._applyCombination(u,arguments)}},b.fromRatio=function(a,c){if("object"==typeof a){var d={};for(var e in a)a.hasOwnProperty(e)&&(d[e]="a"===e?a[e]:G(a[e]));a=d}return b(a,c)},b.equals=function(a,c){return a&&c?b(a).toRgbString()==b(c).toRgbString():!1},b.random=function(){return b.fromRatio({r:S(),g:S(),b:S()})},b.mix=function(a,c,d){d=0===d?0:d||50;var e=b(a).toRgb(),f=b(c).toRgb(),g=d/100,h={r:(f.r-e.r)*g+e.r,g:(f.g-e.g)*g+e.g,b:(f.b-e.b)*g+e.b,a:(f.a-e.a)*g+e.a};return b(h)},b.readability=function(c,d){var e=b(c),f=b(d);return(a.max(e.getLuminance(),f.getLuminance())+.05)/(a.min(e.getLuminance(),f.getLuminance())+.05)},b.isReadable=function(a,c,d){var e,f,g=b.readability(a,c);switch(f=!1,e=L(d),e.level+e.size){case"AAsmall":case"AAAlarge":f=g>=4.5;break;case"AAlarge":f=g>=3;break;case"AAAsmall":f=g>=7}return f},b.mostReadable=function(a,c,d){var e,f,g,h,i=null,j=0;d=d||{},f=d.includeFallbackColors,g=d.level,h=d.size;for(var k=0;k<c.length;k++)e=b.readability(a,c[k]),e>j&&(j=e,i=b(c[k]));return b.isReadable(a,i,{level:g,size:h})||!f?i:(d.includeFallbackColors=!1,b.mostReadable(a,["#fff","#000"],d))};var T=b.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},U=b.hexNames=y(T),V=function(){var a="[-\\+]?\\d+%?",b="[-\\+]?\\d*\\.\\d+%?",c="(?:"+b+")|(?:"+a+")",d="[\\s|\\(]+("+c+")[,|\\s]+("+c+")[,|\\s]+("+c+")\\s*\\)?",e="[\\s|\\(]+("+c+")[,|\\s]+("+c+")[,|\\s]+("+c+")[,|\\s]+("+c+")\\s*\\)?";return{CSS_UNIT:new RegExp(c),rgb:new RegExp("rgb"+d),rgba:new RegExp("rgba"+e),hsl:new RegExp("hsl"+d),hsla:new RegExp("hsla"+e),hsv:new RegExp("hsv"+d),hsva:new RegExp("hsva"+e),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();"undefined"!=typeof module&&module.exports?module.exports=b:"function"==typeof define&&define.amd?define(function(){return b}):window.tinycolor=b}(Math);

        let isEvent = false;
        let scriptNameSearch = '-' + new Date().getFullYear() + '.js';
        if ($('script[src]').toArray().some(e => e.src.endsWith(scriptNameSearch))) { //eg: https://static.koalabeast.com/events/halloween-2019/scripts/halloween-2019.js
            isEvent = true;
        }

        let tr = tagpro.renderer;
        let tilesImage = tagpro.tiles.image;
        let mapWidth, mapHeight;
        let wallEdgePath;
        let tilesCanvas = new OffscreenCanvas(640, 440);
        let tilesCtx = tilesCanvas.getContext('2d');
        let imageCache = {};
        let groupSettingsReady = false;
        let redTeamName; //for competitive logos
        let blueTeamName;


        tilesCtx.drawImage(tagpro.tiles.image, 0, 0);
        tagpro.tiles.image = null; //so readyToDrawBackground() will return false. We'll put it back shortly.
        tagpro.tiles.redball.draw = true; //so tagpro.tiles.draw will return, but without erroring
        tagpro.tiles.blueball.draw = true;



        let vpEffect = GM_getValue('ViewportEffect', false);
        let vpEffectTimeout = 0;

        if (vpEffect === 'zoomfadein') { //Zoom & Fade In...
            vpEffectTimeout = 600;
            GM_addStyle('@keyframes PM_VP_Effect { ' +
                        '    0% { transform:scale(0.5); opacity:0; } ' +
                        '    100% { transform:scale(1); opacity:1; } ' +
                        '}');
            GM_addStyle('.PM_Effect { animation:PM_VP_Effect ' + vpEffectTimeout + 'ms ease-in; }');

        } else if (vpEffect === 'blur') { //Blur...
            GM_addStyle('@keyframes PM_VP_Effect { ' +
                        '    0% { filter:blur(10px); } ' +
                        '    60% { filter:blur(10px); } ' +
                        '}');
            GM_addStyle('.PM_Effect { animation:PM_VP_Effect 700ms ease-in; }');

        } else if (vpEffect === 'expando') { //Expando...
            vpEffectTimeout = 700;
            GM_addStyle('@keyframes PM_VP_Effect { ' +
                        '    0% { transform:scaleX(0); margin 1s; } ' +
                        '    100% { transform:scaleX(1); margin 1s; } ' +
                        '}');
            GM_addStyle('.PM_Effect { animation:PM_VP_Effect ' + vpEffectTimeout + 'ms ease-in; }');

        } else if (vpEffect === 'spin') { //Spin...
            vpEffectTimeout = 700;
            GM_addStyle('@keyframes PM_VP_Effect { ' +
                        '    0% { transform:rotateY(180deg); } ' +
                        '    100% { transform:rotateY(360deg); } ' +
                        '}');
            GM_addStyle('.PM_Effect { animation:PM_VP_Effect ' + vpEffectTimeout + 'ms cubic-bezier(0.4, 0, 0.2, 1); }');

        } else if (vpEffect === 'invert') { //Invert...
            GM_addStyle('@keyframes PM_VP_Effect { ' +
                        '    0% { filter:invert(100%); } ' +
                        '    100% { filter:none; } ' +
                        '}');
            GM_addStyle('.PM_Effect { animation:PM_VP_Effect 600ms cubic-bezier(0.4, 0, 0.2, 1); }');

        } else if (vpEffect === 'sepia') { //Bright Sepia...
            GM_addStyle('@keyframes PM_VP_Effect { ' +
                        '    0% { filter:brightness(200%) sepia(100%); } ' +
                        '    100% { filter:none; } ' +
                        '}');
            GM_addStyle('.PM_Effect { animation:PM_VP_Effect 800ms cubic-bezier(0.4, 0, 0.2, 1); }');

        } else if (vpEffect === 'huerotate') { //Hue Rotate...
            GM_addStyle('@keyframes PM_VP_Effect { ' +
                        '    0% { filter:hue-rotate(360deg); } ' +
                        '    100% { filter:none; } ' +
                        '}');
            GM_addStyle('.PM_Effect { animation:PM_VP_Effect 1500ms cubic-bezier(0.4, 0, 0.2, 1); }');
        }


        function updateCSSBackground() {
            let color1 = (savedOptions.background_useballcolors ? hexToRgbA(averageTileColors.redball, 1.85) : savedOptions.background_color1);
            let color2 = (savedOptions.background_useballcolors ? hexToRgbA(averageTileColors.blueball, 1.85) : savedOptions.background_color2);
            let size = savedOptions.background_size / 2;

            if (savedOptions.background === 'value-conic') {
                $('body').css('background', 'conic-gradient(' + color1 + ', ' + color2 + ', ' + color1 + ', ' + color2 + ', ' + color1 + ', ' + color2 + ', ' + color1 + ', ' + color2 + ', ' + color1);

            } else if (savedOptions.background === 'value-linear') {
                let angle = elementPositions.halfway.x ? 90 : 0;
                $('body').css('background', 'linear-gradient(' + angle + 'deg, ' + color1 + ' ' + size + '%, ' + color2 + ' ' + (100 - size) + '%)');

            } else if (savedOptions.background === 'value-ellipse') {
                $('body').css('background', 'radial-gradient(ellipse, ' + color1 + ', ' + color1 + ', ' + savedOptions.background_size + '%, ' + color2 + ', ' + color2 + ')');

            } else if (savedOptions.background === 'value-corner') {
                $('body').css('background', 'linear-gradient(to bottom right, ' + color1 + ' ' + size + '%, ' + color2 + ' ' + (100 - size) + '%)');

            } else if (savedOptions.background === 'value-rainbow') {
                $('body').css('background', 'linear-gradient(217deg, rgba(255,0,0,.8), rgba(255,0,0,0) 70.71%), linear-gradient(127deg, rgba(0,255,0,.8), rgba(0,255,0,0) 70.71%), linear-gradient(336deg, rgba(0,0,255,.8), rgba(0,0,255,0) 70.71%)');

            } else if (defaultValues.background.hasOwnProperty(savedOptions.background) && defaultValues.background[savedOptions.background].url) {
                $('body.game-page').css({ 'background':'url("' + defaultValues.background[savedOptions.background].url + '")', 'background-size':'cover' });

            } else {
                $('body').css('background', '');
            }
        }

        function adjustDashForPerfectFit(radius, dashpattern, target='radius') {
            if (target === 'radius') { //change radius so the dashes fit the circle perfectly (dashpattern unchanged)
                let segments = dashpattern.split(',');
                let sum = segments.reduce((a,b) => a + Number(b), 0);
                let a = radius * Math.PI * 2;
                let b = Math.floor(a / sum);

                return sum * b / Math.PI / 2;

            } else if (target === 'single') { //change single dashsize (e.g. 4) to fit (radius unchanged)
                return radius * Math.PI / dashpattern; //dashpattern = # segments

            } else if (target === 'first') { //change first segment size (e.g. 4,5 -> 4.424,5) to fit (radius unchanged)
                let segments = dashpattern.split(',');
                let sum = segments.reduce((a,b) => a + Number(b), 0);
                let a = radius * Math.PI * 2;
                let b = Math.floor(a / sum);
                let remainder = (a / b) - Math.floor(a / b);

                segments[0] = +segments[0] + remainder;

                return segments;
            }
        }

        let floorCanvas, floorCtx;
        let teamTileCanvas, teamTileCtx;
        let endzoneCanvas, endzoneCtx;
        let spikeCanvas, spikeCtx;
        let wallCanvas, wallCtx;
        let wallRawCanvas, wallRawCtx;
        let extrasCanvas, extrasCtx;
        let fwCanvas, fwCtx;
        let gateCanvas, gateCtx;

        function initCanvases() {
            floorCanvas = new OffscreenCanvas(mapWidth, mapHeight);
            floorCtx = floorCanvas.getContext('2d');
            teamTileCanvas = new OffscreenCanvas(mapWidth, mapHeight);
            teamTileCtx = teamTileCanvas.getContext('2d');
            endzoneCanvas = new OffscreenCanvas(mapWidth, mapHeight);
            endzoneCtx = endzoneCanvas.getContext('2d');
            spikeCanvas = new OffscreenCanvas(mapWidth, mapHeight);
            spikeCtx = spikeCanvas.getContext('2d');
            wallRawCanvas = new OffscreenCanvas(mapWidth, mapHeight);
            wallRawCtx = wallRawCanvas.getContext('2d');
            wallCanvas = new OffscreenCanvas(mapWidth, mapHeight);
            wallCtx = wallCanvas.getContext('2d');
            extrasCanvas = new OffscreenCanvas(mapWidth, mapHeight);
            extrasCtx = extrasCanvas.getContext('2d');
            fwCanvas = new OffscreenCanvas(mapWidth, mapHeight);
            fwCtx = fwCanvas.getContext('2d');
            gateCanvas = new OffscreenCanvas(mapWidth, mapHeight);
            gateCtx = gateCanvas.getContext('2d');
        }

        function modifyTilesImage() {
            let tempCanvas = new OffscreenCanvas(40, 40);
            let tempCtx = tempCanvas.getContext('2d');

            let clearTempCtx = function() {
                tempCtx.clearRect(0,0,40,40);
                tempCtx.globalAlpha = 1;
                tempCtx.filter = 'none';
                tempCtx.globalCompositeOperation = 'source-over';
            };

            //directly modify certain tiles on the tiles image before they're used...
            if (savedOptions.balls_plain) {
                tilesCtx.clearRect(560, 0, 80, 40);

                tilesCtx.fillStyle = hexToRgbA(savedOptions.balls_plain_color_red === 'auto' ? averageTileColors.redball : savedOptions.balls_plain_color_red, savedOptions.balls_opacity);
                tilesCtx.beginPath();
                tilesCtx.arc(580, 20, 19, 0, Math.PI * 2);
                tilesCtx.closePath();
                tilesCtx.fill();

                tilesCtx.fillStyle = hexToRgbA(savedOptions.balls_plain_color_blue === 'auto' ? averageTileColors.blueball : savedOptions.balls_plain_color_blue, savedOptions.balls_opacity);
                tilesCtx.beginPath();
                tilesCtx.arc(620, 20, 19, 0, Math.PI * 2);
                tilesCtx.closePath();
                tilesCtx.fill();

            } else if (savedOptions.balls_opacity < 1) {
                tilesCtx.clearRect(560, 0, 80, 40);

                tilesCtx.globalAlpha = savedOptions.balls_opacity;
                tilesCtx.drawImage(tilesImage, 560, 0, 80, 40, 560, 0, 80, 40);
                tilesCtx.globalAlpha = 1;
            }

            if (savedOptions.balls_hole_radius > 0) {
                tilesCtx.globalCompositeOperation = 'destination-out';
                tilesCtx.fillStyle = '#000000';
                tilesCtx.beginPath();
                tilesCtx.arc(580, 20, savedOptions.balls_hole_radius, 0, Math.PI * 2);
                tilesCtx.arc(620, 20, savedOptions.balls_hole_radius, 0, Math.PI * 2);
                tilesCtx.closePath();
                tilesCtx.fill();
                tilesCtx.globalCompositeOperation = 'source-over';
            }

            if (savedOptions.ballskins) {
                let scale, newsize, offset;

                //redball...
                if (savedOptions.ballskins_red_x >= 0 && savedOptions.ballskins_red_y >= 0) {
                    scale = savedOptions.ballskins_scale_red;
                    newsize = Math.floor(48 * scale);
                    offset = (40 - newsize) / 2;
                    clearTempCtx();
                    tempCtx.drawImage(tilesCanvas, 560, 0, 40, 40, 0, 0, 40, 40);
                    tempCtx.globalCompositeOperation = savedOptions.ballskins_gco;
                    if (savedOptions.ballskins_filter_red) tempCtx.filter = savedOptions.ballskins_filter_red;
                    if (savedOptions.ballskins_opacity < 1) tempCtx.globalAlpha = savedOptions.ballskins_opacity;
                    tempCtx.drawImage(imageCache[defaultValues.texture_ballskins['select-Skins'].url], savedOptions.ballskins_red_x, savedOptions.ballskins_red_y, 48, 48,  offset, offset, newsize, newsize);
                    tilesCtx.clearRect(560,0,40,40);
                    tilesCtx.drawImage(tempCanvas, 0, 0, 40, 40, 560, 0, 40, 40);
                }

                //blueball...
                if (savedOptions.ballskins_blue_x >= 0 && savedOptions.ballskins_blue_y >= 0) {
                    scale = savedOptions.ballskins_scale_blue;
                    newsize = Math.floor(48 * scale);
                    offset = (40 - newsize) / 2;
                    clearTempCtx();
                    tempCtx.drawImage(tilesCanvas, 600, 0, 40, 40, 0, 0, 40, 40);
                    tempCtx.globalCompositeOperation = savedOptions.ballskins_gco;
                    if (savedOptions.ballskins_filter_blue) tempCtx.filter = savedOptions.ballskins_filter_blue;
                    if (savedOptions.ballskins_opacity < 1) tempCtx.globalAlpha = savedOptions.ballskins_opacity;
                    tempCtx.drawImage(imageCache[defaultValues.texture_ballskins['select-Skins'].url], savedOptions.ballskins_blue_x, savedOptions.ballskins_blue_y, 48, 48,  offset, offset, newsize, newsize);
                    tilesCtx.clearRect(600,0,40,40);
                    tilesCtx.drawImage(tempCanvas, 0, 0, 40, 40, 600, 0, 40, 40);
                }
            }

            if (savedOptions.ball_outline1) {
                let lineWidth = savedOptions.ball_outline1_linewidth;
                let radius = savedOptions.ball_outline1_radius - lineWidth / 2;
                let dashsize = adjustDashForPerfectFit(radius, savedOptions.ball_outline1_segments, 'single');
                let color;

                tilesCtx.lineWidth = lineWidth;
                if (savedOptions.ball_outline1_segments > 0) tilesCtx.setLineDash([dashsize]);

                if (savedOptions.ball_outline1_color_red === 'auto') color = averageTileColors.redball;
                else color = savedOptions.ball_outline1_color_red;
                tilesCtx.strokeStyle = hexToRgbA(color, savedOptions.ball_outline1_opacity); //redball
                tilesCtx.beginPath();
                tilesCtx.arc(580, 20, radius, 0, Math.PI * 2);
                tilesCtx.closePath();
                tilesCtx.stroke();

                if (savedOptions.ball_outline1_color_blue === 'auto') color = averageTileColors.blueball;
                else color = savedOptions.ball_outline1_color_blue;
                tilesCtx.strokeStyle = hexToRgbA(color, savedOptions.ball_outline1_opacity); //blueball
                tilesCtx.beginPath();
                tilesCtx.arc(620, 20, radius, 0, Math.PI * 2);
                tilesCtx.closePath();
                tilesCtx.stroke();
            }

            if (savedOptions.ball_outline2) {
                let lineWidth = savedOptions.ball_outline2_linewidth;
                let radius = savedOptions.ball_outline2_radius - lineWidth / 2;
                let dashsize = adjustDashForPerfectFit(radius, savedOptions.ball_outline2_segments, 'single');
                let color;

                tilesCtx.lineWidth = lineWidth;
                if (savedOptions.ball_outline2_segments > 0) tilesCtx.setLineDash([dashsize]);
                else tilesCtx.setLineDash([]);

                if (savedOptions.ball_outline2_color_red === 'auto') {
                    let new_color = tinyColor(averageTileColors.redball);
                    color = new_color.darken(20).toString();
                } else {
                    color = savedOptions.ball_outline2_color_red;
                }
                tilesCtx.strokeStyle = hexToRgbA(color, savedOptions.ball_outline2_opacity); //redball
                tilesCtx.beginPath();
                tilesCtx.arc(580, 20, radius, 0, Math.PI * 2);
                tilesCtx.closePath();
                tilesCtx.stroke();

                if (savedOptions.ball_outline2_color_blue === 'auto') {
                    let new_color = tinyColor(averageTileColors.blueball);
                    color = new_color.darken(20).toString();
                } else {
                    color = savedOptions.ball_outline2_color_blue;
                }
                tilesCtx.strokeStyle = hexToRgbA(color, savedOptions.ball_outline2_opacity); //blueball
                tilesCtx.beginPath();
                tilesCtx.arc(620, 20, radius, 0, Math.PI * 2);
                tilesCtx.closePath();
                tilesCtx.stroke();
            }

            if (savedOptions.ball_outline3) {
                let lineWidth = savedOptions.ball_outline3_linewidth;
                let radius = savedOptions.ball_outline3_radius - lineWidth / 2;
                let dashsize = adjustDashForPerfectFit(radius, savedOptions.ball_outline3_segments, 'single');
                let color;

                tilesCtx.lineWidth = lineWidth;
                if (savedOptions.ball_outline3_segments > 0) tilesCtx.setLineDash([dashsize]);
                else tilesCtx.setLineDash([]);

                if (savedOptions.ball_outline3_color_red === 'auto') {
                    let new_color = tinyColor(averageTileColors.redball);
                    color = new_color.darken(20).toString();
                } else {
                    color = savedOptions.ball_outline3_color_red;
                }
                tilesCtx.strokeStyle = hexToRgbA(color, savedOptions.ball_outline3_opacity); //redball
                tilesCtx.beginPath();
                tilesCtx.arc(580, 20, radius, 0, Math.PI * 2);
                tilesCtx.closePath();
                tilesCtx.stroke();

                if (savedOptions.ball_outline3_color_blue === 'auto') {
                    let new_color = tinyColor(averageTileColors.blueball);
                    color = new_color.darken(20).toString();
                } else {
                    color = savedOptions.ball_outline3_color_blue;
                }
                tilesCtx.strokeStyle = hexToRgbA(color, savedOptions.ball_outline3_opacity); //blueball
                tilesCtx.beginPath();
                tilesCtx.arc(620, 20, radius, 0, Math.PI * 2);
                tilesCtx.closePath();
                tilesCtx.stroke();
            }

            if (savedOptions.bombs_outline) {
                let lineWidth = savedOptions.bombs_outline_linewidth;
                let radius = savedOptions.bombs_outline_radius - lineWidth / 2;
                let dashsize = adjustDashForPerfectFit(radius, savedOptions.bombs_outline_segments, 'single');

                tilesCtx.lineWidth = lineWidth;
                if (savedOptions.bombs_outline_segments > 0) tilesCtx.setLineDash([dashsize]);
                else tilesCtx.setLineDash([]);

                tilesCtx.strokeStyle = hexToRgbA(savedOptions.bombs_outline_color === 'auto' ? '#fff' : savedOptions.bombs_outline_color, savedOptions.bombs_outline_opacity); //bomb
                tilesCtx.beginPath();
                tilesCtx.arc(500, 60, radius, 0, Math.PI * 2);
                tilesCtx.closePath();
                tilesCtx.stroke();

                if (!savedOptions.bombs_draw_exploded_20pc) {
                    tilesCtx.strokeStyle = hexToRgbA(savedOptions.bombs_outline_color === 'auto' ? '#fff' : savedOptions.bombs_outline_color, savedOptions.bombs_outline_opacity / 3); //exploded bomb
                    tilesCtx.beginPath();
                    tilesCtx.arc(500, 100, radius, 0, Math.PI * 2);
                    tilesCtx.closePath();
                    tilesCtx.stroke();
                }
            }

            if (savedOptions.bombs_draw_exploded_20pc) {
                tilesCtx.clearRect(480,80,40,40);
                tilesCtx.globalAlpha = 0.2;
                tilesCtx.drawImage(tilesCanvas, 480,40,40,40, 480,80,40,40);
                tilesCtx.globalAlpha = 1;
            }

            if (savedOptions.flags_outline) {
                let lineWidth = savedOptions.flags_outline_linewidth;
                let radius = 15 - lineWidth / 2;
                let dashsize = adjustDashForPerfectFit(radius, savedOptions.flags_outline_segments, 'single');

                tilesCtx.lineWidth = lineWidth;
                if (savedOptions.flags_outline_segments > 0) tilesCtx.setLineDash([dashsize]);
                else tilesCtx.setLineDash([]);

                tilesCtx.strokeStyle = hexToRgbA(savedOptions.flags_outline_color === 'auto' ? '#fff' : savedOptions.flags_outline_color, savedOptions.flags_outline_opacity);

                tilesCtx.beginPath(); //yellowflag
                tilesCtx.arc(540, 60, radius, 0, Math.PI * 2);
                tilesCtx.closePath();
                tilesCtx.stroke();

                tilesCtx.beginPath(); //redflag
                tilesCtx.arc(580, 60, radius, 0, Math.PI * 2);
                tilesCtx.closePath();
                tilesCtx.stroke();

                tilesCtx.beginPath(); //blueflag
                tilesCtx.arc(620, 60, radius, 0, Math.PI * 2);
                tilesCtx.closePath();
                tilesCtx.stroke();

                tilesCtx.strokeStyle = hexToRgbA(savedOptions.flags_outline_color === 'auto' ? '#fff' : savedOptions.flags_outline_color, savedOptions.flags_outline_opacity / 4);

                tilesCtx.beginPath(); //yellowflag taken
                tilesCtx.arc(540, 100, radius, 0, Math.PI * 2);
                tilesCtx.closePath();
                tilesCtx.stroke();

                tilesCtx.beginPath(); //redflag taken
                tilesCtx.arc(580, 100, radius, 0, Math.PI * 2);
                tilesCtx.closePath();
                tilesCtx.stroke();

                tilesCtx.beginPath(); //blueflag taken
                tilesCtx.arc(620, 100, radius, 0, Math.PI * 2);
                tilesCtx.closePath();
                tilesCtx.stroke();
            }

            tilesCtx.setLineDash([]);

            if (savedOptions.gates_plain_neutral || savedOptions.gates_neutral_opacity < 1 || savedOptions.gates_neutral_margin > 0 || savedOptions.gates_neutral_outline) {
                clearTempCtx();
                tilesCtx.clearRect(480, 120, 40, 40);

                if (savedOptions.gates_neutral_opacity < 1) {
                    tempCtx.globalAlpha = savedOptions.gates_neutral_opacity;
                }

                if (savedOptions.gates_plain_neutral) {
                    tempCtx.fillStyle = savedOptions.gates_plain_neutral_color === 'auto' ? averageTileColors.neutralgate : savedOptions.gates_plain_neutral_color;
                    tempCtx.fillRect(+savedOptions.gates_neutral_margin, +savedOptions.gates_neutral_margin, 40 - savedOptions.gates_neutral_margin * 2, 40 - savedOptions.gates_neutral_margin * 2);
                } else {
                    tempCtx.drawImage(tilesImage, 480, 120, 40, 40,  +savedOptions.gates_neutral_margin, +savedOptions.gates_neutral_margin, 40 - savedOptions.gates_neutral_margin * 2, 40 - savedOptions.gates_neutral_margin * 2);
                }

                tempCtx.globalAlpha = 1;

                if (savedOptions.gates_neutral_outline) {
                    tempCtx.lineWidth = 1;
                    tempCtx.strokeStyle = savedOptions.gates_plain_neutral_color === 'auto' ? averageTileColors.neutralgate : savedOptions.gates_plain_neutral_color;
                    tempCtx.beginPath();
                    tempCtx.rect(0, 0, 40, 40);
                    tempCtx.stroke();
                    tempCtx.closePath();
                }

                tilesCtx.drawImage(tempCanvas, 0, 0, 40, 40, 480, 120, 40, 40);
            }

            tilesCtx.globalAlpha = 1;

            if (savedOptions.gates_plain_grb) {
                let altColor;
                let altBrightness;
                let colors = { green:520, red:560, blue:600 };

                tilesCtx.clearRect(520, 120, 120, 40);

                for (let color in colors) {
                    clearTempCtx();

                    tempCtx.fillStyle = savedOptions['gates_plain_grb_' + color] === 'auto' ? averageTileColors[color + 'gate'] : savedOptions['gates_plain_grb_' + color];
                    tempCtx.fillRect(0, 0, 40, 40);

                    altColor = tinycolor(tempCtx.fillStyle);
                    altBrightness = altColor.getBrightness();

                    tempCtx.strokeStyle = altBrightness > 35 ? altColor.darken(20).toString() : altColor.lighten(20).toString();
                    tempCtx.beginPath();
                    tempCtx.rect(0, 0, 40, 40);
                    tempCtx.moveTo(0, 0);
                    tempCtx.lineTo(40, 40);
                    tempCtx.moveTo(0, 40);
                    tempCtx.lineTo(40, 0);
                    tempCtx.closePath();
                    tempCtx.stroke();

                    tilesCtx.drawImage(tempCanvas, 0, 0, 40, 40, colors[color], 120, 40, 40);
                }
            }

            if (savedOptions.buttons_generic) {
                tilesCtx.clearRect(520, 240, 40, 40);

                //main button
                tilesCtx.fillStyle = savedOptions.buttons_generic_color_outer;
                tilesCtx.beginPath();
                tilesCtx.arc(540, 260, 7, 0, 2*Math.PI);
                tilesCtx.fill();

                //centre highlight
                tilesCtx.fillStyle = savedOptions.buttons_generic_color_inner;
                tilesCtx.beginPath();
                tilesCtx.arc(540, 260, 4, 0, 2*Math.PI);
                tilesCtx.fill();

                //border
                tilesCtx.strokeStyle = savedOptions.buttons_generic_color_border;
                tilesCtx.lineWidth = 1; //inner border
                tilesCtx.beginPath();
                tilesCtx.arc(540, 260, 4, 0, 2*Math.PI);
                tilesCtx.closePath();
                tilesCtx.stroke();
                tilesCtx.lineWidth = 2; //outer border
                tilesCtx.beginPath();
                tilesCtx.arc(540, 260, 7, 0, 2*Math.PI);
                tilesCtx.closePath();
                tilesCtx.stroke();
            }

            return tilesCanvas;
        }

        let averageTileColors = { floor:'#dddddd', floorAlt:'#444444', floorAlt2:'#888888', actualFloor:'#dddddd', actualFloorAlt:'#444444', redball:'#ff2020', blueball:'#0080ff', yellowflag:'#ffff00', redflag:'#ff0000', blueflag:'#0000ff', neutralgate:'#cccccc', greengate:'#40ff40', redgate:'#bb0000', bluegate:'#3164c7', yellowteam:'#ffff00', redteam:'#ff0000', blueteam:'#0000ff', redendzone:'#ff0000', blueendzone:'#0000ff', wall:'#444444', wallEdge:'#000000' };
        let elementPositions = { redflag:[], blueflag:[], yellowflag:[], ezred:{locs:[], x:null, y:null}, ezblue:{locs:[], x:null, y:null}, teamred:[], teamblue:[], teamyellow:[], halfway:{x:null, y:null}, bombs:[], spikes:[], pups:[], boosts:{ yellow:[], red:[], blue:[] }, buttons:[], portals:[], gates:[], gravityWells:[] };

        const PM_Loading = $('<div id="PM_Loading" style="position:absolute; width:100%; text-align:center; margin:0 auto; top:460px; font-size:20px; font-style:italic; color:#fff;">Modding Textures...</div>');
        $('#sound').after(PM_Loading);


        const images = ['texture_ballskins', 'texture_floor1', 'texture_floor2', 'texture_floor3', 'texture_team', 'texture_walls1', 'texture_walls2', 'texture_endzone', 'texture_base', 'texture_center']; //, 'texture_logo_red', 'texture_logo_blue'
        let images_urls = [];

        async function loadImages(imageUrlArray) {
            //from: https://stackoverflow.com/questions/37854355/wait-for-image-loading-to-complete-in-javascript
            const promiseArray = [];

            for (let url of imageUrlArray) {
                promiseArray.push(new Promise((resolve, reject) => {
                    imageCache[url] = new Image();
                    imageCache[url].onload = function() {
                        resolve();
                    };
                    imageCache[url].onerror = function() {
                        reject();
                    };
                    imageCache[url].crossOrigin = 'Anonymous';
                    imageCache[url].src = url;
                }));
            }

            await Promise.allSettled(promiseArray).then((results) => {
                results.forEach((result) => {
                    //console.log(result);
                })
            }).catch(error => {
                console.error(`An unknown error has occurred in loadImages(): ${error}`);
            });

            return promiseArray;
        }

        let getLogoFromGroupNames = function(teamName) {
            for (let value in defaultValues.texture_logo_red) {
                if (value.endsWith(teamName)) return value;
            }
        };

        let startCounter1 = 0;
        let cacheTextures = function() {
            if (savedOptions.texture_logo_automatic) { //wait for team names from group, then lookup the name and set the corresponding image url before we call loadImages()
                if (tagpro.group && tagpro.group.socket !== null && !groupSettingsReady) {
                    startCounter1++;

                    if (startCounter1 < 50) {
                        setTimeout(cacheTextures, 20);
                        return false;
                    }
                }

                if (tagpro.group && tagpro.group.socket !== null && tagpro.group.socket.connected) {
                    if (redTeamName && redTeamName !== 'Red') {
                        let value = getLogoFromGroupNames(redTeamName);

                        if (value) {
                            savedOptions.texture_logo_red = value;
                            savedOptions.texture_logo_red_filter = defaultValues.texture_logo_red[value].filter;
                            savedOptions.texture_logo_red_size = defaultValues.texture_logo_red[value].size;
                            savedOptions.texture_logo_red_xOffset = defaultValues.texture_logo_red[value].xOffset;
                            savedOptions.texture_logo_red_yOffset = defaultValues.texture_logo_red[value].yOffset;
                        }

                        images.push('texture_logo_red');
                    }

                    if (blueTeamName && blueTeamName !== 'Blue') {
                        let value = getLogoFromGroupNames(blueTeamName);

                        if (value) {
                            savedOptions.texture_logo_blue = value;
                            savedOptions.texture_logo_blue_filter = defaultValues.texture_logo_blue[value].filter;
                            savedOptions.texture_logo_blue_size = defaultValues.texture_logo_blue[value].size;
                            savedOptions.texture_logo_blue_xOffset = defaultValues.texture_logo_blue[value].xOffset;
                            savedOptions.texture_logo_blue_yOffset = defaultValues.texture_logo_blue[value].yOffset;
                        }

                        images.push('texture_logo_blue');
                    }
                }

            } else {
                images.push('texture_logo_red', 'texture_logo_blue');
            }

            for (const value of images) {
                if (savedOptions[value] !== 'select-none' && defaultValues[value].hasOwnProperty(savedOptions[value])) {
                    images_urls.push(defaultValues[value][savedOptions[value]].url);
                }
            }

            loadImages(images_urls).then((promiseArray) => {
                getAverageColors();
                tilesImage = modifyTilesImage();

            }).catch(error => {
                console.error(`An unknown error has occurred: ${error}`);

            }).finally(()=> {
                tagpro.tiles.image = tilesImage; //put things back to normal
                delete tagpro.tiles.redball.draw;
                delete tagpro.tiles.blueball.draw;
            });
        };
        cacheTextures();



        function makeWallEdgePath() {
            wallEdgePath = new Path2D();

            for (let x=0; x<tagpro.map.length; x++) {
                for (let y=0; y<tagpro.map[0].length; y++) {
                    let mapTileId = Math.floor(tagpro.map[x][y]);

                    if (mapTileId === 1) {
                        let x40 = x * 40;
                        let y40 = y * 40;
                        let x40p40 = x * 40 + 40;
                        let y40p40 = y * 40 + 40;

                        if (tagpro.map[x][y] === 1) { //square
                            if (x === 0 || Math.floor(tagpro.map[x-1][y]) !== 1 || tagpro.map[x-1][y] === 1.1 || tagpro.map[x-1][y] === 1.2) { //left edge
                                wallEdgePath.moveTo(x40, y40);
                                wallEdgePath.lineTo(x40, y40p40);
                            }
                            if (y === 0 || Math.floor(tagpro.map[x][y-1]) !== 1 || tagpro.map[x][y-1] === 1.2 || tagpro.map[x][y-1] === 1.3) { //top edge
                                wallEdgePath.moveTo(x40, y40);
                                wallEdgePath.lineTo(x40p40, y40);
                            }
                            if (x === tagpro.map.length-1 || Math.floor(tagpro.map[x+1][y]) !== 1 || tagpro.map[x+1][y] === 1.3 || tagpro.map[x+1][y] === 1.4) { //right edge
                                wallEdgePath.moveTo(x40p40, y40);
                                wallEdgePath.lineTo(x40p40, y40p40);
                            }
                            if (y === tagpro.map[0].length-1 || Math.floor(tagpro.map[x][y+1]) !== 1 || tagpro.map[x][y+1] === 1.1 || tagpro.map[x][y+1] === 1.4) { //bottom edge
                                wallEdgePath.moveTo(x40p40, y40p40);
                                wallEdgePath.lineTo(x40, y40p40);
                            }

                        } else if (tagpro.map[x][y] === 1.1) { //90° corner = SW ◣
                            if (x === 0 || Math.floor(tagpro.map[x-1][y]) !== 1 || tagpro.map[x-1][y] === 1.1 || tagpro.map[x-1][y] === 1.2) { //left edge
                                wallEdgePath.moveTo(x40, y40);
                                wallEdgePath.lineTo(x40, y40p40);
                            }
                            if (y === tagpro.map[0].length-1 || Math.floor(tagpro.map[x][y+1]) !== 1 || tagpro.map[x][y+1] === 1.1 || tagpro.map[x][y+1] === 1.4) { //bottom edge
                                wallEdgePath.moveTo(x40, y40p40);
                                wallEdgePath.lineTo(x40p40, y40p40);
                            }
                            wallEdgePath.moveTo(x40p40, y40p40); //diagonal ◣
                            wallEdgePath.lineTo(x40, y40);

                        } else if (tagpro.map[x][y] === 1.2) { //90° corner = NW ◤
                            if (x === 0 || Math.floor(tagpro.map[x-1][y]) !== 1 || tagpro.map[x-1][y] === 1.1 || tagpro.map[x-1][y] === 1.2) { //left edge
                                wallEdgePath.moveTo(x40, y40);
                                wallEdgePath.lineTo(x40, y40p40);
                            }
                            if (y === 0 || Math.floor(tagpro.map[x][y-1]) !== 1 || tagpro.map[x][y-1] === 1.2 || tagpro.map[x][y-1] === 1.3) { //top edge
                                wallEdgePath.moveTo(x40, y40);
                                wallEdgePath.lineTo(x40p40, y40);
                            }
                            wallEdgePath.moveTo(x40p40, y40); //diagonal ◤
                            wallEdgePath.lineTo(x40, y40p40);

                        } else if (tagpro.map[x][y] === 1.3) { //90° corner = NE ◥
                            if (x === tagpro.map.length-1 || Math.floor(tagpro.map[x+1][y]) !== 1 || tagpro.map[x+1][y] === 1.3 || tagpro.map[x+1][y] === 1.4) { //right edge
                                wallEdgePath.moveTo(x40p40, y40);
                                wallEdgePath.lineTo(x40p40, y40p40);
                            }
                            if (y === 0 || Math.floor(tagpro.map[x][y-1]) !== 1 || tagpro.map[x][y-1] === 1.2 || tagpro.map[x][y-1] === 1.3) { //top edge
                                wallEdgePath.moveTo(x40, y40);
                                wallEdgePath.lineTo(x40p40, y40);
                            }
                            wallEdgePath.moveTo(x40p40, y40p40); //diagonal ◥
                            wallEdgePath.lineTo(x40, y40);

                        } else if (tagpro.map[x][y] === 1.4) { //90° corner = SE ◢
                            if (x === tagpro.map.length-1 || Math.floor(tagpro.map[x+1][y]) !== 1 || tagpro.map[x+1][y] === 1.3 || tagpro.map[x+1][y] === 1.4) { //right edge
                                wallEdgePath.moveTo(x40p40, y40);
                                wallEdgePath.lineTo(x40p40, y40p40);
                            }
                            if (y === tagpro.map[0].length-1 || Math.floor(tagpro.map[x][y+1]) !== 1 || tagpro.map[x][y+1] === 1.1 || tagpro.map[x][y+1] === 1.4) { //bottom edge
                                wallEdgePath.moveTo(x40p40, y40p40);
                                wallEdgePath.lineTo(x40, y40p40);
                            }
                            wallEdgePath.moveTo(x40p40, y40); //diagonal ◢
                            wallEdgePath.lineTo(x40, y40p40);
                        }
                    }
                }
            }
        }

        function applyTextureToCanvas(ctx, target, globalCompositeOperation='source-atop', clipOutside=false) {
            let url = defaultValues[target][savedOptions[target]].url; //e.g. target = 'texture_floor1'
            let image = imageCache[url];

            if (!image || !image.naturalWidth || !image.naturalHeight) {
                return;
            }

            let scale = savedOptions[target + '_size'];
            let width = scale > 0 ? Math.floor(image.naturalWidth * scale) : mapWidth;
            let height = scale > 0 ? Math.floor(image.naturalHeight * scale) : mapHeight;
            let filter = savedOptions[target + '_filter']; // || 'none';
            let textureCanvas = new OffscreenCanvas(width, height);
            let textureCtx = textureCanvas.getContext('2d');

            if (filter) textureCtx.filter = filter;
            textureCtx.drawImage(image, 0, 0, width, height);

            let tempCanvas, tempCtx;
            if (clipOutside) {
                tempCanvas = new OffscreenCanvas(mapWidth, mapHeight);
                tempCtx = tempCanvas.getContext('2d');
                tempCtx.drawImage(ctx.canvas, 0, 0);
            }

            ctx.globalCompositeOperation = globalCompositeOperation;

            let pattern = ctx.createPattern(textureCanvas, 'repeat');
            ctx.fillStyle = pattern;
            ctx.fillRect(0,0, mapWidth,mapHeight);

            if (clipOutside) {
                ctx.globalCompositeOperation = 'destination-in';
                ctx.drawImage(tempCanvas, 0, 0);
            }

            ctx.globalCompositeOperation = 'source-over';
        }

        function getAverageColors() {
            //get the "average" colors from the tiles texture...
            let pixelData;
            pixelData = tilesCtx.getImageData(525, 165, 10, 10).data; //floor
            averageTileColors.floor = getAverageColor(pixelData, true);
            let floorcolor = tinycolor(averageTileColors.floor);
            let floorcolor2 = floorcolor.clone();
            let floorcolor_brightness = floorcolor.getBrightness();
            averageTileColors.floorcolor_brightness = floorcolor_brightness;
            averageTileColors.floorAlt = floorcolor_brightness > 30 ? floorcolor.darken(60).toString() : floorcolor.lighten(70).toString();
            averageTileColors.floorAlt2 = floorcolor_brightness < 60 ? floorcolor2.lighten(50).toString() : floorcolor2.darken(50).toString();
            averageTileColors.floorAlt3 = floorcolor_brightness < 128 ? '#ffffff' : '#000000';

            pixelData = tilesCtx.getImageData(565, 5, 30, 30).data; //redball
            averageTileColors.redball = getAverageColor(pixelData, true, true);
            pixelData = tilesCtx.getImageData(605, 5, 30, 30).data; //blueball
            averageTileColors.blueball = getAverageColor(pixelData, true, true);
            pixelData = tilesCtx.getImageData(530, 50, 20, 10).data; //yellow flag
            averageTileColors.yellowflag = getAverageColor(pixelData, true, true);
            pixelData = tilesCtx.getImageData(570, 50, 20, 10).data; //red flag
            averageTileColors.redflag = getAverageColor(pixelData, true, true);
            pixelData = tilesCtx.getImageData(610, 50, 20, 10).data; //blue flag
            averageTileColors.blueflag = getAverageColor(pixelData, true, true);
            pixelData = tilesCtx.getImageData(530, 210, 20, 20).data; //yellow team
            averageTileColors.yellowteam = getAverageColor(pixelData, true, true);
            pixelData = tilesCtx.getImageData(570, 170, 20, 20).data; //red team
            averageTileColors.redteam = getAverageColor(pixelData, true, true);
            pixelData = tilesCtx.getImageData(610, 170, 20, 20).data; //blue team
            averageTileColors.blueteam = getAverageColor(pixelData, true, true);
            pixelData = tilesCtx.getImageData(570, 210, 20, 20).data; //red endzone
            averageTileColors.redendzone = getAverageColor(pixelData, true, true);
            pixelData = tilesCtx.getImageData(610, 210, 20, 20).data; //blue endzone
            averageTileColors.blueendzone = getAverageColor(pixelData, true, true);

            pixelData = tilesCtx.getImageData(510, 120, 10, 10).data; //neutral gate
            averageTileColors.neutralgate = getAverageColor(pixelData, true, false);
            pixelData = tilesCtx.getImageData(550, 120, 10, 10).data; //green gate
            averageTileColors.greengate = getAverageColor(pixelData, true, true);
            pixelData = tilesCtx.getImageData(590, 120, 10, 10).data; //red gate
            averageTileColors.redgate = getAverageColor(pixelData, true, true);
            pixelData = tilesCtx.getImageData(630, 120, 10, 10).data; //blue gate
            averageTileColors.bluegate = getAverageColor(pixelData, true, true);

            pixelData = tilesCtx.getImageData(495, 5, 10, 5).data; //spike
            averageTileColors.spike = getAverageColor(pixelData, true, false);
            let spikecolor = tinycolor(averageTileColors.spike);
            pixelData = tilesCtx.getImageData(165, 125, 20, 20).data; //wall
            averageTileColors.wall = getAverageColor(pixelData, true, false);
        }

        function modifyBackgroundTexture(bgCtx) {
            initCanvases();

            let wallEdgeCanvas2 = new OffscreenCanvas(mapWidth, mapHeight);
            let wallEdgeCtx2 = wallEdgeCanvas2.getContext('2d');

            if (savedOptions.plainfloor) {
                floorCtx.fillStyle = savedOptions.plainfloor_color_use ? savedOptions.plainfloor_color : averageTileColors.floor;

            } else {
                if (savedOptions.plainfloor_color_use) { //shitty tint
                    tilesCtx.fillStyle = savedOptions.plainfloor_color;
                    tilesCtx.fillRect(520, 160, 40, 40);
                    tilesCtx.globalAlpha = 0.5;
                }

                tilesCtx.drawImage(tilesImage, 520, 160, 40, 40,  520, 160, 40, 40);

                if (savedOptions.plainfloor_color_use) {
                    tilesCtx.filter = 'saturate(400%) contrast(80%) brightness(80%)';
                    tilesCtx.drawImage(tilesCtx.canvas, 520, 160, 40, 40,  520, 160, 40, 40);
                    tilesCtx.filter = 'none';
                }
            }

            //Draw all the tiles...
            for (let x = 0; x < tagpro.map.length; x++) {
                for (let y = 0; y < tagpro.map[0].length; y++) {
                    let mapTileId = Math.floor(tagpro.map[x][y]);
                    let floorMapTileId = tagpro.floorMap[x][y];

                    //Draw a floor tile...
                    if (mapTileId >= 2 || floorMapTileId >= 2) {
                        if (savedOptions.plainfloor) {
                            floorCtx.fillRect(x*40, y*40, 40, 40);
                        } else {
                            floorCtx.drawImage(tilesCanvas, 520,160,40,40,  x*40,y*40,40,40);
                        }
                    }

                    //Draw any floorMap team or endzone tiles (under dynamic sprites & diagonal walls)...
                    if (floorMapTileId > 2) {
                        if (floorMapTileId === 11 || floorMapTileId === 12 || floorMapTileId === 23) {
                            if (savedOptions.plainteam) {
                                teamTileCtx.fillStyle = floorMapTileId === 11 ? savedOptions.plainteam_color_use && savedOptions.plainteam_color_red || averageTileColors.redteam : floorMapTileId === 12 ? savedOptions.plainteam_color_use && savedOptions.plainteam_color_blue || averageTileColors.blueteam : savedOptions.plainteam_color_use && savedOptions.plainteam_color_yellow || averageTileColors.yellowteam;
                                teamTileCtx.fillRect(x*40, y*40, 40, 40);
                            } else {
                                teamTileCtx.drawImage(tilesImage, tagpro.tiles[floorMapTileId].x*40, tagpro.tiles[floorMapTileId].y*40, 40, 40,  x*40, y*40, 40, 40);
                            }

                        } else if (floorMapTileId === 17 || floorMapTileId === 18) {
                            if (savedOptions.plainendzone) {
                                endzoneCtx.fillStyle = floorMapTileId === 17 ? (savedOptions.plainendzone_color_use && savedOptions.plainendzone_color_red) || averageTileColors.redendzone : (savedOptions.plainendzone_color_use && savedOptions.plainendzone_color_blue) || averageTileColors.blueendzone;
                                endzoneCtx.fillRect(x*40, y*40, 40, 40);
                            } else {
                                endzoneCtx.drawImage(tilesImage, tagpro.tiles[floorMapTileId].x*40, tagpro.tiles[floorMapTileId].y*40, 40, 40,  x*40, y*40, 40, 40);
                            }
                        }
                    }

                    //Draw other map tiles...
                    if (mapTileId > 2) {
                        if (mapTileId === 7 && !isEvent) { //spike
                            let tempCanvasSize = 128;
                            let tempCanvasOffset = (tempCanvasSize - 40) / 2;

                            if (!imageCache[mapTileId]) {
                                let tempCanvas = new OffscreenCanvas(tempCanvasSize, tempCanvasSize);
                                let tempCtx = tempCanvas.getContext('2d');

                                if (savedOptions.spikes_border) {
                                    tempCtx.translate(tempCanvasOffset, tempCanvasOffset);
                                    tempCtx.lineWidth = 1.5;
                                    tempCtx.strokeStyle = savedOptions.spikes_border_color;
                                    tempCtx.beginPath();
                                    tempCtx.arc(20, 20, 14, 0, Math.PI * 2);
                                    tempCtx.closePath();
                                    tempCtx.stroke();
                                    tempCtx.translate(-tempCanvasOffset, -tempCanvasOffset);
                                }

                                tempCtx.filter = savedOptions.spikes_filter;

                                if (savedOptions.spikes_generic) {
                                    drawStar(tempCtx, 20, 20, false, (savedOptions.spikes_generic_color === 'auto' ? '#ffffff' : savedOptions.spikes_generic_color), true, savedOptions.spikes_generic_holeradius, savedOptions.spikes_generic_points, 14, savedOptions.spikes_generic_innerradius);
                                } else {
                                    tempCtx.translate(tempCanvasOffset, tempCanvasOffset);
                                    tempCtx.drawImage(tilesImage, tagpro.tiles[mapTileId].x*40, tagpro.tiles[mapTileId].y*40, 40, 40,  0, 0, 40, 40);
                                    tempCtx.translate(-tempCanvasOffset, -tempCanvasOffset);
                                }

                                imageCache[mapTileId] = tempCanvas;
                            }

                            spikeCtx.drawImage(imageCache[mapTileId], 0, 0, tempCanvasSize, tempCanvasSize,  x*40-tempCanvasOffset, y*40-tempCanvasOffset, tempCanvasSize, tempCanvasSize);

                        } else if (mapTileId === 11 || mapTileId === 12 || mapTileId === 23) { //team
                            if (savedOptions.plainteam) {
                                teamTileCtx.fillStyle = mapTileId === 11 ? savedOptions.plainteam_color_use && savedOptions.plainteam_color_red || averageTileColors.redteam : mapTileId === 12 ? savedOptions.plainteam_color_use && savedOptions.plainteam_color_blue || averageTileColors.blueteam : savedOptions.plainteam_color_use && savedOptions.plainteam_color_yellow || averageTileColors.yellowteam;
                                teamTileCtx.fillRect(x*40, y*40, 40, 40);

                            } else {
                                teamTileCtx.drawImage(tilesImage, tagpro.tiles[mapTileId].x*40, tagpro.tiles[mapTileId].y*40, 40, 40,  x*40, y*40, 40, 40);
                            }

                        } else if (mapTileId === 17 || mapTileId === 18) { //endzone
                            if (savedOptions.plainendzone) {
                                endzoneCtx.fillStyle = mapTileId === 17 ? (savedOptions.plainendzone_color_use && savedOptions.plainendzone_color_red) || averageTileColors.redendzone : (savedOptions.plainendzone_color_use && savedOptions.plainendzone_color_blue) || averageTileColors.blueendzone;
                                endzoneCtx.fillRect(x*40, y*40, 40, 40);
                            } else {
                                endzoneCtx.drawImage(tilesImage, tagpro.tiles[mapTileId].x*40, tagpro.tiles[mapTileId].y*40, 40, 40,  x*40, y*40, 40, 40);
                            }

                        } else if (mapTileId === 8) { //button
                            spikeCtx.drawImage(tilesCanvas, tagpro.tiles[mapTileId].x*40, tagpro.tiles[mapTileId].y*40, 40, 40,  x*40, y*40, 40, 40);

                        } else if (mapTileId === 22) { //gravityWell
                            if (!tilesCtx.hasGravityWell) {
                                let pixelData = tilesCtx.getImageData(530, 10, 10, 10).data;
                                if (getAverageColor(pixelData) === null) { //no gravityWell in the texture pack (all pixels were transparent)
                                    tilesCtx.clearRect(520, 0, 40, 40);
                                    tilesCtx.drawImage($('#gravityWell')[0], 0, 0, 40, 40,  520, 0, 40, 40);
                                    tilesCtx.hasGravityWell = true;
                                }
                            }

                            spikeCtx.drawImage(tilesCanvas, 520, 0, 40, 40,  x*40, y*40, 40, 40);

                        } else if (mapTileId === 9) { //used for gate shadows
                            gateCtx.fillStyle = '#000000';
                            gateCtx.fillRect(x*40, y*40, 40, 40);
                        }

                    } else { //walls...
                        //Fill in empty tiles with a wall tile...
                        if (savedOptions.fill_empty_with_walls && (mapTileId === 0 || (tagpro.map[x][y] > 1 && floorMapTileId === 0))) { //empty space or diagonal wall on empty space
                            tagpro.map[x][y] = 1;
                            mapTileId = 1;
                            if (!savedOptions.plainwalls) savedOptions.plainwalls_color = averageTileColors.wall;
                            savedOptions.plainwalls = true;
                        }

                        if (mapTileId === 1) { //walls...
                            if (savedOptions.plainwalls) { //Just draw the correct wall shape (and modify it later). This way it draws ~1 in 4 of the wall tiles.
                                let wallTileId = tagpro.map[x][y];

                                if (wallTileId === 1) {
                                    wallRawCtx.drawImage(tilesImage, 160, 120, 40, 40,  x*40, y*40, 40, 40);
                                } else if (wallTileId === 1.1) { //◣
                                    wallRawCtx.drawImage(tilesImage, 200, 80, 40, 40,  x*40, y*40, 40, 40);
                                } else if (wallTileId === 1.2) { //◤
                                    wallRawCtx.drawImage(tilesImage, 200, 40, 40, 40,  x*40, y*40, 40, 40);
                                } else if (wallTileId === 1.3) { //◥
                                    wallRawCtx.drawImage(tilesImage, 240, 40, 40, 40,  x*40, y*40, 40, 40);
                                } else if (wallTileId === 1.4) { //◢
                                    wallRawCtx.drawImage(tilesImage, 240, 80, 40, 40,  x*40, y*40, 40, 40);
                                }

                            } else {
                                for (let q = 0; q < 4; q++) {
                                    let wallTileId = tagpro.wallMap[x][y][q];

                                    if (tagpro.tiles[wallTileId]) {
                                        let xo = 0;
                                        let yo = 0;
                                        if ((q === 1) || (q === 2)) xo = 20;
                                        if ((q === 2) || (q === 3)) yo = 20;

                                        wallRawCtx.drawImage(tilesImage, tagpro.tiles[wallTileId].x*40, tagpro.tiles[wallTileId].y*40, 20, 20,  x*40+xo, y*40+yo, 20, 20);
                                    }
                                }
                            }
                        }
                    }
                }
            }

            fwCtx.drawImage(floorCanvas, 0, 0);
            fwCtx.drawImage(wallRawCanvas, 0, 0);

            //Add Floor Image #1...
            if (savedOptions.texture_floor1 !== 'select-none') {
                if (defaultValues.texture_floor1.hasOwnProperty(savedOptions.texture_floor1) && defaultValues.texture_floor1[savedOptions.texture_floor1].url) {
                    applyTextureToCanvas(floorCtx, 'texture_floor1', savedOptions.texture_floor1_gco ? savedOptions.texture_floor1_gco : 'source-atop');
                }
            }


            //Add Floor Image #2...
            if (savedOptions.texture_floor2 !== 'select-none') {
                if (defaultValues.texture_floor2.hasOwnProperty(savedOptions.texture_floor2) && defaultValues.texture_floor2[savedOptions.texture_floor2].url) {
                    applyTextureToCanvas(floorCtx, 'texture_floor2', savedOptions.texture_floor2_gco ? savedOptions.texture_floor2_gco : 'source-atop');
                }
            }


            //Work out the average floor color (used when certain colors are set to 'auto')...
            let pixelData;
            let x = elementPositions.yellowflag.length ? elementPositions.yellowflag[0].x : elementPositions.redflag.length ? elementPositions.redflag[0].x : mapWidth/2;
            let y = elementPositions.yellowflag.length ? elementPositions.yellowflag[0].y : elementPositions.redflag.length ? elementPositions.redflag[0].y : mapHeight/2;
            pixelData = floorCtx.getImageData(x-50, y-50, x+50, y+50).data; //get an area of the floor around the flag
            averageTileColors.actualFloor = getAverageColor(pixelData, true, false, 5); //and get the average color of it
            let actualfloorcolor = tinycolor(averageTileColors.actualFloor);
            let actualfloorcolor_brightness = actualfloorcolor.getBrightness();
            averageTileColors.actualfloorcolor_brightness = actualfloorcolor_brightness;
            averageTileColors.actualFloorAlt = actualfloorcolor_brightness < 80 ? actualfloorcolor.lighten(50).greyscale().toString() : actualfloorcolor.darken(50).greyscale().toString();
            let actualfloorcolor2 = tinycolor(averageTileColors.actualFloorAlt);
            averageTileColors.actualFloorAlt2 = actualfloorcolor_brightness < 80 ? '#000000' : '#ffffff';


            //Add Base Logos...
            if (groupSettingsReady && savedOptions.texture_logo_automatic || savedOptions.texture_logo_red !== 'select-none' || savedOptions.texture_logo_blue !== 'select-none') {
                if (elementPositions.redflag.length && savedOptions.texture_logo_red !== 'select-none') {
                    let url = defaultValues.texture_logo_red.hasOwnProperty(savedOptions.texture_logo_red) ? defaultValues.texture_logo_red[savedOptions.texture_logo_red].url : '';
                    let iW, iH, iX, iY;

                    if (imageCache[url]) {
                        iW = imageCache[url].naturalWidth * savedOptions.texture_logo_red_size;
                        iH = imageCache[url].naturalHeight * savedOptions.texture_logo_red_size;
                        iX = iW / 2 - (savedOptions.texture_logo_red_xOffset || 0);
                        iY = iH / 2 - (savedOptions.texture_logo_red_yOffset || 0);
                    }

                    if (iW && iH) {
                        for (let i=0; i<elementPositions.redflag.length; i++) {
                            floorCtx.globalCompositeOperation = 'source-atop';
                            floorCtx.filter = savedOptions.texture_logo_red_filter;
                            floorCtx.drawImage(imageCache[url], elementPositions.redflag[i].x + 20 - iX, elementPositions.redflag[i].y + 20 - iY, iW, iH);
                            floorCtx.filter = 'none';
                            floorCtx.globalCompositeOperation = 'source-over';
                        }
                    }
                }

                if (elementPositions.blueflag.length && savedOptions.texture_logo_blue !== 'select-none') {
                    let url = defaultValues.texture_logo_blue.hasOwnProperty(savedOptions.texture_logo_blue) ? defaultValues.texture_logo_blue[savedOptions.texture_logo_blue].url : '';
                    let iW, iH, iX, iY;

                    if (imageCache[url]) {
                        iW = imageCache[url].naturalWidth * savedOptions.texture_logo_blue_size;
                        iH = imageCache[url].naturalHeight * savedOptions.texture_logo_blue_size;
                        iX = iW / 2 - (savedOptions.texture_logo_blue_xOffset || 0);
                        iY = iH / 2 - (savedOptions.texture_logo_blue_yOffset || 0);
                    }

                    if (iW && iH) {
                        for (let i=0; i<elementPositions.blueflag.length; i++) {
                            floorCtx.globalCompositeOperation = 'source-atop';
                            floorCtx.filter = savedOptions.texture_logo_blue_filter;
                            floorCtx.drawImage(imageCache[url], elementPositions.blueflag[i].x + 20 - iX, elementPositions.blueflag[i].y + 20 - iY, iW, iH);
                            floorCtx.filter = 'none';
                            floorCtx.globalCompositeOperation = 'source-over';
                        }
                    }
                }
            }


            //Add Base Circles/Images...
            let doBaseCircle1 = (savedOptions.basecircle1_linewidth > 0 || savedOptions.basecircle1_fill) && savedOptions.basecircle1_radius > 0;
            let doBaseCircle2 = (savedOptions.basecircle2_linewidth > 0 || savedOptions.basecircle2_fill) && savedOptions.basecircle2_radius > 0;

            if (doBaseCircle1 || doBaseCircle2 || savedOptions.texture_base !== 'select-none') {
                let url = defaultValues.texture_base.hasOwnProperty(savedOptions.texture_base) ? defaultValues.texture_base[savedOptions.texture_base].url : '';
                let iW, iH, iX, iY;

                if (savedOptions.texture_base !== 'select-none' && imageCache[url]) {
                    iW = imageCache[url].naturalWidth * savedOptions.texture_base_size;
                    iH = imageCache[url].naturalHeight * savedOptions.texture_base_size;
                    iX = iW / 2 - (defaultValues.texture_base[savedOptions.texture_base].xOffset || 0);
                    iY = iH / 2 - (defaultValues.texture_base[savedOptions.texture_base].yOffset || 0);
                }

                let newradius1 = +savedOptions.basecircle1_radius;
                let newradius2 = +savedOptions.basecircle2_radius;
                if (doBaseCircle1 && savedOptions.basecircle1_dashpattern) {
                    newradius1 = adjustDashForPerfectFit(savedOptions.basecircle1_radius, savedOptions.basecircle1_dashpattern, 'radius');
                }
                if (doBaseCircle2 && savedOptions.basecircle2_dashpattern) {
                    newradius2 = adjustDashForPerfectFit(savedOptions.basecircle2_radius, savedOptions.basecircle2_dashpattern, 'radius');
                }

                //yellow flags...
                if (elementPositions.yellowflag.length === 1) {
                    //From: https://stackoverflow.com/questions/8367512/how-do-i-detect-intersections-between-a-circle-and-any-other-circle-in-the-same
                    for (let i=0; i<elementPositions.yellowflag.length; i++) {
                        let intersects = false;
                        for (let j=1; j<elementPositions.yellowflag.length; j++) {
                            intersects = Math.hypot(elementPositions.yellowflag[i].x - elementPositions.yellowflag[j].x, elementPositions.yellowflag[i].y - elementPositions.yellowflag[j].y) <= (newradius1 + newradius1);
                            if (intersects) break;
                        }
                        if (!intersects) {
                            if (doBaseCircle1) {
                                drawCircle(extrasCtx, savedOptions.basecircle1_linewidth, newradius1, savedOptions.basecircle1_color === 'auto' ? averageTileColors.yellowflag : savedOptions.basecircle1_color, savedOptions.basecircle1_opacity, savedOptions.basecircle1_gradient, savedOptions.basecircle1_dashpattern.split(','), savedOptions.basecircle1_blur, elementPositions.yellowflag[i].x + 20, elementPositions.yellowflag[i].y + 20, savedOptions.basecircle1_fill, savedOptions.basecircle1_glow, savedOptions.basecircle1_glow_multiplier);
                            }
                            if (doBaseCircle2) {
                                drawCircle(extrasCtx, savedOptions.basecircle2_linewidth, newradius2, savedOptions.basecircle2_color === 'auto' ? averageTileColors.yellowflag : savedOptions.basecircle2_color, savedOptions.basecircle2_opacity, savedOptions.basecircle2_gradient, savedOptions.basecircle2_dashpattern.split(','), savedOptions.basecircle2_blur, elementPositions.yellowflag[i].x + 20, elementPositions.yellowflag[i].y + 20, savedOptions.basecircle2_fill, savedOptions.basecircle2_glow, savedOptions.basecircle2_glow_multiplier);
                            }
                            if (iW && iH) {
                                floorCtx.globalCompositeOperation = savedOptions.texture_base_gco ? savedOptions.texture_base_gco : 'source-atop';
                                floorCtx.filter = savedOptions.texture_base_filter + ' hue-rotate(60deg) saturate(150%)';
                                floorCtx.drawImage(imageCache[url], elementPositions.yellowflag[i].x + 20 - iX, elementPositions.yellowflag[i].y + 20 - iY, iW, iH);
                                floorCtx.filter = 'none';
                                floorCtx.globalCompositeOperation = 'source-over';
                            }
                        }
                    }
                }

                //red flags...
                if (elementPositions.redflag.length) {
                    for (let i=0; i<elementPositions.redflag.length; i++) {
                        let intersects = false;
                        for (let j=1; j<elementPositions.redflag.length; j++) {
                            intersects = Math.hypot(elementPositions.redflag[i].x - elementPositions.redflag[j].x, elementPositions.redflag[i].y - elementPositions.redflag[j].y) <= (newradius1 + newradius1);
                            if (intersects) break;
                        }
                        if (!intersects) {
                            for (let j=0; j<elementPositions.blueflag.length; j++) {
                                intersects = Math.hypot(elementPositions.redflag[i].x - elementPositions.blueflag[j].x, elementPositions.redflag[i].y - elementPositions.blueflag[j].y) <= (newradius1 + newradius1);
                                if (intersects) break;
                            }
                        }
                        if (!intersects) {
                            if (doBaseCircle1) {
                                drawCircle(extrasCtx, savedOptions.basecircle1_linewidth, newradius1, savedOptions.basecircle1_color === 'auto' ? averageTileColors.redball : savedOptions.basecircle1_color, savedOptions.basecircle1_opacity, savedOptions.basecircle1_gradient, savedOptions.basecircle1_dashpattern.split(','), savedOptions.basecircle1_blur, elementPositions.redflag[i].x + 20, elementPositions.redflag[i].y + 20, savedOptions.basecircle1_fill, savedOptions.basecircle1_glow, savedOptions.basecircle1_glow_multiplier);
                            }
                            if (doBaseCircle2) {
                                drawCircle(extrasCtx, savedOptions.basecircle2_linewidth, newradius2, savedOptions.basecircle2_color === 'auto' ? averageTileColors.redball : savedOptions.basecircle2_color, savedOptions.basecircle2_opacity, savedOptions.basecircle2_gradient, savedOptions.basecircle2_dashpattern.split(','), savedOptions.basecircle2_blur, elementPositions.redflag[i].x + 20, elementPositions.redflag[i].y + 20, savedOptions.basecircle2_fill, savedOptions.basecircle2_glow, savedOptions.basecircle2_glow_multiplier);
                            }

                            if (iW && iH) {
                                floorCtx.globalCompositeOperation = savedOptions.texture_base_gco ? savedOptions.texture_base_gco : 'source-atop';
                                floorCtx.filter = savedOptions.texture_base_filter + '';
                                floorCtx.drawImage(imageCache[url], elementPositions.redflag[i].x + 20 - iX, elementPositions.redflag[i].y + 20 - iY, iW, iH);
                                floorCtx.filter = 'none';
                                floorCtx.globalCompositeOperation = 'source-over';
                            }
                        }
                    }
                }

                //blue flags...
                if (elementPositions.blueflag.length) {
                    for (let i=0; i<elementPositions.blueflag.length; i++) {
                        let intersects = false;
                        for (let j=1; j<elementPositions.blueflag.length; j++) {
                            intersects = Math.hypot(elementPositions.blueflag[i].x - elementPositions.blueflag[j].x, elementPositions.blueflag[i].y - elementPositions.blueflag[j].y) <= (newradius1 + newradius1);
                            if (intersects) break;
                        }
                        if (!intersects) {
                            for (let j=0; j<elementPositions.redflag.length; j++) {
                                intersects = Math.hypot(elementPositions.blueflag[i].x - elementPositions.redflag[j].x, elementPositions.blueflag[i].y - elementPositions.redflag[j].y) <= (newradius1 + newradius1);
                                if (intersects) break;
                            }
                        }
                        if (!intersects) {
                            if (doBaseCircle1) {
                                drawCircle(extrasCtx, savedOptions.basecircle1_linewidth, newradius1, savedOptions.basecircle1_color === 'auto' ? averageTileColors.blueball : savedOptions.basecircle1_color, savedOptions.basecircle1_opacity, savedOptions.basecircle1_gradient, savedOptions.basecircle1_dashpattern.split(','), savedOptions.basecircle1_blur, elementPositions.blueflag[i].x + 20, elementPositions.blueflag[i].y + 20, savedOptions.basecircle1_fill, savedOptions.basecircle1_glow, savedOptions.basecircle1_glow_multiplier);
                            }
                            if (doBaseCircle2) {
                                drawCircle(extrasCtx, savedOptions.basecircle2_linewidth, newradius2, savedOptions.basecircle2_color === 'auto' ? averageTileColors.blueball : savedOptions.basecircle2_color, savedOptions.basecircle2_opacity, savedOptions.basecircle2_gradient, savedOptions.basecircle2_dashpattern.split(','), savedOptions.basecircle2_blur, elementPositions.blueflag[i].x + 20, elementPositions.blueflag[i].y + 20, savedOptions.basecircle2_fill, savedOptions.basecircle2_glow, savedOptions.basecircle2_glow_multiplier);
                            }
                            if (iW && iH) {
                                floorCtx.globalCompositeOperation = savedOptions.texture_base_gco ? savedOptions.texture_base_gco : 'source-atop';
                                floorCtx.filter = savedOptions.texture_base_filter + ' hue-rotate(240deg)';
                                floorCtx.drawImage(imageCache[url], elementPositions.blueflag[i].x + 20 - iX, elementPositions.blueflag[i].y + 20 - iY, iW, iH);
                                floorCtx.filter = 'none';
                                floorCtx.globalCompositeOperation = 'source-over';
                            }
                        }
                    }
                }
            }


            //Add Floor Gradient...
            if (savedOptions.floor_gradient1 || savedOptions.floor_gradient2) {
                let tempCanvas = new OffscreenCanvas(mapWidth, mapHeight);
                let tempCtx = tempCanvas.getContext('2d');

                if (savedOptions.floor_gradient1) {
                    let color1 = savedOptions.floor_gradient1_color1 === 'auto' ? averageTileColors.actualFloor : savedOptions.floor_gradient1_color1;
                    let color2 = savedOptions.floor_gradient1_color2 === 'auto' ? averageTileColors.actualFloorAlt : savedOptions.floor_gradient1_color2;

                    addGradient(tempCtx, 0, 0, mapWidth, mapHeight, savedOptions.floor_gradient1_type.slice(6), color1, color2, savedOptions.floor_gradient1_opacity1, savedOptions.floor_gradient1_opacity2, '0', savedOptions.floor_gradient1_size);
                }

                if (savedOptions.floor_gradient2) {
                    let color1 = savedOptions.floor_gradient2_color1 === 'auto' ? averageTileColors.actualFloor : savedOptions.floor_gradient2_color1;
                    let color2 = savedOptions.floor_gradient2_color2 === 'auto' ? averageTileColors.actualFloorAlt : savedOptions.floor_gradient2_color2;

                    if (savedOptions.floor_gradient1) tempCtx.globalCompositeOperation = 'screen';

                    addGradient(tempCtx, 0, 0, mapWidth, mapHeight, savedOptions.floor_gradient2_type.slice(6), color1, color2, savedOptions.floor_gradient2_opacity1, savedOptions.floor_gradient2_opacity2, '0', savedOptions.floor_gradient2_size);
                }

                floorCtx.globalCompositeOperation = 'source-atop';
                floorCtx.drawImage(tempCanvas, 0, 0);
                floorCtx.globalCompositeOperation = 'source-over';
            }


            //Add Floor Contour Gradient...
            if (savedOptions.floor_contour) {
                floorCtx.globalCompositeOperation = 'source-atop';

                let color = hexToRgbA(savedOptions.floor_contour_color, savedOptions.floor_contour_opacity);
                let filter = '';
                let filterr = 'drop-shadow(0 0 ' + savedOptions.floor_contour_size + 'px ' + color +') ';
                for (let i=1; i<=savedOptions.floor_contour_multiplier; i++) {
                    filter += filterr;
                }

                floorCtx.filter = filter;
                floorCtx.drawImage(wallRawCanvas, 0, 0);
                floorCtx.filter = 'none';
                floorCtx.globalCompositeOperation = 'source-over';
            }


            //Add Center Image...
            if (savedOptions.texture_center !== 'select-none' && (!elementPositions.yellowflag.length || elementPositions.yellowflag.length && savedOptions.texture_base === 'select-none')) {
                let url = defaultValues.texture_center.hasOwnProperty(savedOptions.texture_center) ? defaultValues.texture_center[savedOptions.texture_center].url : '';
                let iW, iH, iX, iY;

                if (savedOptions.texture_center !== 'select-none' && imageCache[url]) {
                    iW = imageCache[url].naturalWidth * savedOptions.texture_center_size;
                    iH = imageCache[url].naturalHeight * savedOptions.texture_center_size;
                    iX = iW / 2 - (savedOptions.texture_center_xOffset || 0);
                    iY = iH / 2 - (savedOptions.texture_center_yOffset || 0);
                }

                if (iW && iH) {
                    floorCtx.globalCompositeOperation = 'source-atop';
                    floorCtx.filter = savedOptions.texture_center_filter;

                    /* //TESTING...
                    let mapAngleBLTR = Math.atan((elementPositions.redflag[0].y === elementPositions.blueflag[0].y ? 0 : (elementPositions.redflag[0].y < elementPositions.blueflag[0].y ? -mapHeight : mapHeight)) / mapWidth);

                    floorCtx.translate(mapWidth / 2, mapHeight / 2);
                    floorCtx.rotate(mapAngleBLTR);
                    floorCtx.translate(-mapWidth / 2, -mapHeight / 2);
                    */

                    floorCtx.drawImage(imageCache[url], mapWidth / 2 - iW / 2, mapHeight / 2 - iH / 2, iW, iH);
                    floorCtx.filter = 'none';
                    floorCtx.globalCompositeOperation = 'source-over';
                }
            }


            //Add Checker...
            if (savedOptions.checker1_size > 0) addCheckered(extrasCtx, mapWidth, mapHeight, +savedOptions.checker1_size, +savedOptions.checker1_margin, (savedOptions.checker1_color === 'auto' ? averageTileColors.actualFloorAlt : savedOptions.checker1_color), +savedOptions.checker1_opacity, savedOptions.checker1_normal, savedOptions.checker1_random, savedOptions.checker1_straight, savedOptions.checker1_stripes, false);


            //Add Grids...
            if (savedOptions.grid1_size > 0) addGrid(extrasCtx, mapWidth, mapHeight, +savedOptions.grid1_size, +savedOptions.grid1_length, +savedOptions.grid1_width, (savedOptions.grid1_color === 'auto' ? averageTileColors.actualFloorAlt : savedOptions.grid1_color), +savedOptions.grid1_opacity, savedOptions.grid1_square, savedOptions.grid1_rectangles, savedOptions.grid1_lines, savedOptions.grid1_diagonal, savedOptions.grid1_crosses, savedOptions.grid1_shadow);
            if (savedOptions.grid2_size > 0) addGrid(extrasCtx, mapWidth, mapHeight, +savedOptions.grid2_size, +savedOptions.grid2_length, +savedOptions.grid2_width, (savedOptions.grid2_color === 'auto' ? averageTileColors.actualFloorAlt : savedOptions.grid2_color), +savedOptions.grid2_opacity, savedOptions.grid2_square, savedOptions.grid2_rectangles, savedOptions.grid2_lines, savedOptions.grid2_diagonal, savedOptions.grid2_crosses, savedOptions.grid2_shadow);


            //Add Floor Image #3...
            if (savedOptions.texture_floor3 !== 'select-none') {
                if (defaultValues.texture_floor3.hasOwnProperty(savedOptions.texture_floor3) && defaultValues.texture_floor3[savedOptions.texture_floor3].url) {
                    applyTextureToCanvas(floorCtx, 'texture_floor3', savedOptions.texture_floor3_gco ? savedOptions.texture_floor3_gco : 'source-atop');
                }
            }


            //Add Koalabeast...
            if (savedOptions.kblogo) {
                let xPos = (elementPositions.halfway.x ? elementPositions.halfway.x : tagpro.map.length * 40 / 2);
                let yPos = (elementPositions.halfway.y ? elementPositions.halfway.y : tagpro.map[0].length * 40 / 2);

                addKoalaBeast(extrasCtx, xPos, yPos);
            }


            //Add Gravity Well Outer Circle...
            if (elementPositions.gravityWells.length && savedOptions.gravityWell_linewidth > 0) {
                let radius = 260;
                if (savedOptions.gravityWell_linewidth > 1) radius = 260 + (savedOptions.gravityWell_linewidth / 2);

                for (let i = 0; i < elementPositions.gravityWells.length; i++) {
                    drawCircle(extrasCtx, savedOptions.gravityWell_linewidth, radius, savedOptions.gravityWell_color === 'auto' ? '#00bb55' : savedOptions.gravityWell_color, savedOptions.gravityWell_opacity, savedOptions.gravityWell_gradient, savedOptions.gravityWell_dashpattern.split(','), 0, elementPositions.gravityWells[i].x + 20, elementPositions.gravityWells[i].y + 20, savedOptions.gravityWell_fill);
                }
            }


            //Add Center Line...
            if (savedOptions.centerline_linewidth > 0) {
                let x1=0, y1=0, x2=0, y2=0;

                if (elementPositions.halfway.x) {
                    x1 = elementPositions.halfway.x + 0;
                    x2 = elementPositions.halfway.x + 0;
                    y2 = mapHeight;
                } else if (elementPositions.halfway.y) {
                    x2 = mapWidth;
                    y1 = elementPositions.halfway.y + 0;
                    y2 = elementPositions.halfway.y + 0;
                }

                drawLine(extrasCtx, x1, y1, x2, y2, hexToRgbA(savedOptions.centerline_color === 'auto' ? averageTileColors.actualFloorAlt : savedOptions.centerline_color, savedOptions.centerline_opacity), savedOptions.centerline_linewidth, savedOptions.centerline_dashpattern.split(','), savedOptions.centerline_glow);
            }


            //Add Base Circles/Images...


            //Add Flag Line...
            if (savedOptions.flagline_linewidth > 0) {
                if (elementPositions.yellowflag.length) {
                    //???
                } else {
                    for (let i=0; i<elementPositions.redflag.length; i++) {
                        for (let j=0; j<elementPositions.blueflag.length; j++) {
                            drawLine(extrasCtx, elementPositions.redflag[i].x + 20, elementPositions.redflag[i].y + 20, elementPositions.blueflag[j].x + 20, elementPositions.blueflag[j].y + 20, hexToRgbA(savedOptions.flagline_color === 'auto' ? averageTileColors.actualFloorAlt : savedOptions.flagline_color, savedOptions.flagline_opacity), savedOptions.flagline_linewidth, savedOptions.flagline_dashpattern.split(','), savedOptions.flagline_glow);
                        }
                    }
                }
            }

            if (savedOptions.boosts_outline) {
                let c1Canvas = new OffscreenCanvas(40, 40);
                let c1Ctx = c1Canvas.getContext('2d');
                let dashpattern = adjustDashForPerfectFit(13, savedOptions.boosts_outline_dashpattern, 'first');

                drawCircle(c1Ctx, savedOptions.boosts_outline_linewidth, 13, savedOptions.boosts_outline_color_red === 'auto' ? averageTileColors.redball : savedOptions.boosts_outline_color_red, savedOptions.boosts_outline_opacity, false, dashpattern, 0, 20, 20);
                for (let i=0; i<elementPositions.boosts.red.length; i++) {
                    extrasCtx.drawImage(c1Canvas, elementPositions.boosts.red[i].x, elementPositions.boosts.red[i].y);
                }

                c1Ctx.clearRect(0,0,40,40);
                drawCircle(c1Ctx, savedOptions.boosts_outline_linewidth, 13, savedOptions.boosts_outline_color_blue === 'auto' ? averageTileColors.blueball : savedOptions.boosts_outline_color_blue, savedOptions.boosts_outline_opacity, false, dashpattern, 0, 20, 20);
                for (let i=0; i<elementPositions.boosts.blue.length; i++) {
                    extrasCtx.drawImage(c1Canvas, elementPositions.boosts.blue[i].x, elementPositions.boosts.blue[i].y);
                }

                c1Ctx.clearRect(0,0,40,40);
                drawCircle(c1Ctx, savedOptions.boosts_outline_linewidth, 13, savedOptions.boosts_outline_color_yellow === 'auto' ? averageTileColors.yellowteam : savedOptions.boosts_outline_color_yellow, savedOptions.boosts_outline_opacity, false, dashpattern, 0, 20, 20);
                for (let i=0; i<elementPositions.boosts.yellow.length; i++) {
                    extrasCtx.drawImage(c1Canvas, elementPositions.boosts.yellow[i].x, elementPositions.boosts.yellow[i].y);
                }
            }

            if (savedOptions.portals_outline) {
                let c1Canvas = new OffscreenCanvas(40, 40);
                let c1Ctx = c1Canvas.getContext('2d');
                let dashpattern = adjustDashForPerfectFit(13.5, savedOptions.portals_outline_dashpattern, 'first');

                drawCircle(c1Ctx, savedOptions.portals_outline_linewidth, 13.5, savedOptions.portals_outline_color === 'auto' ? averageTileColors.actualFloorAlt : savedOptions.portals_outline_color, savedOptions.portals_outline_opacity, false, dashpattern, 0, 20, 20, savedOptions.portals_outline_fill);
                for (let i=0; i<elementPositions.portals.length; i++) {
                    extrasCtx.drawImage(c1Canvas, elementPositions.portals[i].x, elementPositions.portals[i].y);
                }
            }


            //Modify the Team Tile canvas...
            if (savedOptions.teamtile_gradient) {
                addGradientPattern(teamTileCtx, mapWidth, mapHeight, 'rdiagonal', 'diagonal', '#222222', '#dddddd', 0.25, 0.25, Math.max(mapWidth, mapHeight) / 30, Math.max(mapWidth, mapHeight) / 30);
            }

            if (savedOptions.texture_team !== 'select-none') {
                if (defaultValues.texture_team.hasOwnProperty(savedOptions.texture_team) && defaultValues.texture_team[savedOptions.texture_team].url) {
                    applyTextureToCanvas(teamTileCtx, 'texture_team', savedOptions.texture_team_gco ? savedOptions.texture_team_gco : 'source-atop', true);
                }
            }


            //Modify the Endzone canvas...
            if (savedOptions.texture_endzone !== 'select-none') {
                if (defaultValues.texture_endzone.hasOwnProperty(savedOptions.texture_endzone) && defaultValues.texture_endzone[savedOptions.texture_endzone].url) {
                    applyTextureToCanvas(endzoneCtx, 'texture_endzone', savedOptions.texture_endzone_gco ? savedOptions.texture_endzone_gco : 'source-atop', true);
                }
            }

            if (savedOptions.endzone_checker_size > 0) {
                let size = +savedOptions.endzone_checker_size;
                let margin = +savedOptions.endzone_checker_margin;
                //let pattern = savedOptions.endzone_checker_stripes_pattern || size + ',' + margin;// + ',' + (size + margin) + ',0';

                addCheckered(endzoneCtx, mapWidth, mapHeight, +savedOptions.endzone_checker_size, +savedOptions.endzone_checker_margin, (savedOptions.endzone_checker_color === 'auto' ? averageTileColors.actualFloor : savedOptions.endzone_checker_color), +savedOptions.endzone_checker_opacity, savedOptions.endzone_checker_normal, savedOptions.endzone_checker_random, savedOptions.endzone_checker_straight, false, '', 'source-atop');
            }


            //Modify the Wall canvas...
            wallCtx.drawImage(wallRawCanvas, 0, 0);

            if (savedOptions.plainwalls) {
                wallCtx.globalCompositeOperation = 'source-atop';
                wallCtx.fillStyle = savedOptions.plainwalls_color === 'auto' ? averageTileColors.wall : savedOptions.plainwalls_color;
                wallCtx.fillRect(0, 0, mapWidth, mapHeight);
                wallCtx.globalCompositeOperation = 'source-over';
            }

            //Add Wall Image #1...
            if (savedOptions.texture_walls1 !== 'select-none') {
                if (defaultValues.texture_walls1.hasOwnProperty(savedOptions.texture_walls1) && defaultValues.texture_walls1[savedOptions.texture_walls1].url) {
                    let gco = savedOptions.texture_walls1_gco ? savedOptions.texture_walls1_gco : 'source-atop';
                    let clip = gco === 'source-atop' ? false : true;
                    applyTextureToCanvas(wallCtx, 'texture_walls1', gco, clip);
                }
            }

            //Add Wall Image #2...
            if (savedOptions.texture_walls2 !== 'select-none') {
                if (defaultValues.texture_walls2.hasOwnProperty(savedOptions.texture_walls2) && defaultValues.texture_walls2[savedOptions.texture_walls2].url) {
                    let gco = savedOptions.texture_walls2_gco ? savedOptions.texture_walls2_gco : 'source-atop';
                    let clip = gco === 'source-atop' ? false : true;
                    applyTextureToCanvas(wallCtx, 'texture_walls2', gco, clip);
                }
            }


            //Add the Wall Shadows and/or Wall Outline...
            let walloutline_multi_size = (+savedOptions.walloutline1_size + +savedOptions.walloutline2_size + +savedOptions.walloutline3_size) * 2;
            if (savedOptions.wallshadow_inner || savedOptions.wallshadow_outer || walloutline_multi_size > 0) {
                if (!wallEdgePath) makeWallEdgePath();

                //Wall Shadow...
                if (savedOptions.wallshadow_inner || savedOptions.wallshadow_outer) {
                    let wallshadow_type = savedOptions.wallshadow_size + 'px ' + savedOptions.wallshadow_size + 'px';
                    let wallshadow_blur = savedOptions.wallshadow_blur + 'px ';
                    let wallshadow_color = savedOptions.wallshadow_color === 'auto' ? averageTileColors.actualFloorAlt : savedOptions.wallshadow_color;
                    let wallshadow_opacity = savedOptions.wallshadow_opacity;

                    wallEdgeCtx2.lineWidth = +walloutline_multi_size === 0 ? 1 : walloutline_multi_size;
                    wallEdgeCtx2.strokeStyle = wallshadow_color;
                    wallEdgeCtx2.lineCap = 'round';

                    wallEdgeCtx2.drawImage(wallRawCanvas, 0, 0);
                    wallEdgeCtx2.globalCompositeOperation = 'source-in';
                    wallEdgeCtx2.stroke(wallEdgePath);

                    let wallshadow_color_opacity = hexToRgbA(wallshadow_color, wallshadow_opacity);
                    let wallshadow = 'drop-shadow(' + wallshadow_type + ' ' + wallshadow_blur + ' ' + wallshadow_color_opacity + ') ';

                    wallCtx.filter = wallshadow;

                    for (let i=1; i<savedOptions.wallshadow_multiplier; i++) {
                        wallCtx.filter += wallshadow;
                    }

                    if (savedOptions.wallshadow_inner) {
                        wallCtx.globalCompositeOperation = 'source-atop';
                        wallCtx.drawImage(wallEdgeCanvas2, 0, 0);
                    }

                    if (savedOptions.wallshadow_outer) {
                        wallCtx.globalCompositeOperation = 'destination-over';
                        wallCtx.drawImage(wallEdgeCanvas2, 0, 0);
                    }
                }

                wallCtx.globalCompositeOperation = 'source-over';
                wallCtx.filter = 'none';


                //Wall Outline...
                if (walloutline_multi_size > 0) {
                    let resetWallEdgeCanvas = function(lineWidth) {
                        wallEdgeCtx2.clearRect(0, 0, wallEdgeCanvas2.width, wallEdgeCanvas2.height);

                        wallEdgeCtx2.lineWidth = lineWidth;
                        wallEdgeCtx2.setLineDash([]);
                        wallEdgeCtx2.filter = 'none';
                        wallEdgeCtx2.lineCap = 'round';

                        wallEdgeCtx2.globalCompositeOperation = 'source-over';
                        wallEdgeCtx2.drawImage(wallRawCanvas, 0, 0);
                        wallEdgeCtx2.globalCompositeOperation = 'source-in';
                        wallEdgeCtx2.stroke(wallEdgePath);
                    }


                    if (savedOptions.walloutline1_size > 0) { //inner
                        resetWallEdgeCanvas(walloutline_multi_size);
                        wallEdgeCtx2.strokeStyle = savedOptions.walloutline1_color === 'auto' ? averageTileColors.floorAlt3 : savedOptions.walloutline1_color;
                        wallEdgeCtx2.lineWidth = walloutline_multi_size;
                        wallEdgeCtx2.stroke(wallEdgePath);
                        wallCtx.drawImage(wallEdgeCanvas2, 0, 0);
                    }

                    if (savedOptions.walloutline2_size > 0) { //middle
                        let walloutline23_size = (+savedOptions.walloutline2_size + +savedOptions.walloutline3_size) * 2;
                        resetWallEdgeCanvas(walloutline23_size);
                        if (savedOptions.walloutline2_dashed) {
                            wallEdgeCtx2.setLineDash([3, 4]);
                            wallEdgeCtx2.lineCap = 'butt';
                        }
                        wallEdgeCtx2.strokeStyle = savedOptions.walloutline2_color === 'auto' ? averageTileColors.floor : savedOptions.walloutline2_color;
                        wallEdgeCtx2.lineWidth = walloutline23_size;
                        wallEdgeCtx2.stroke(wallEdgePath);
                        wallCtx.drawImage(wallEdgeCanvas2, 0, 0);
                    }

                    if (savedOptions.walloutline3_size > 0) { //outer
                        resetWallEdgeCanvas(+savedOptions.walloutline3_size * 2);
                        wallEdgeCtx2.strokeStyle = hexToRgbA(savedOptions.walloutline3_color === 'auto' ? averageTileColors.floorAlt3 : savedOptions.walloutline3_color, savedOptions.walloutline3_opacity);
                        wallEdgeCtx2.lineWidth = +savedOptions.walloutline3_size * 2;
                        wallEdgeCtx2.stroke(wallEdgePath);
                        wallCtx.drawImage(wallEdgeCanvas2, 0, 0);
                    }
                }
            }



            //Finally, draw all the canvases to make our background...

            //floor...
            if (savedOptions.floor_filter !== '') bgCtx.filter = savedOptions.floor_filter;
            bgCtx.globalCompositeOperation = 'source-over';
            bgCtx.drawImage(floorCanvas, 0, 0);
            if (savedOptions.texture_floor3 !== 'select-none') {
                if (defaultValues.texture_floor3.hasOwnProperty(savedOptions.texture_floor3) && defaultValues.texture_floor3[savedOptions.texture_floor3].url) {
                    applyTextureToCanvas(bgCtx, 'texture_floor3', savedOptions.texture_floor3_gco ? savedOptions.texture_floor3_gco : 'source-atop');
                }
            }
            bgCtx.filter = 'none';

            //extras...
            bgCtx.globalCompositeOperation = 'source-atop';
            bgCtx.drawImage(extrasCanvas, 0, 0);

            //team tiles...
            bgCtx.globalCompositeOperation = 'source-over';
            if (savedOptions.teamtile_filter !== '') bgCtx.filter = savedOptions.teamtile_filter;
            bgCtx.drawImage(teamTileCanvas, 0, 0);
            bgCtx.filter = 'none';

            //endzones...
            bgCtx.globalCompositeOperation = 'source-over';
            if (savedOptions.endzone_filter !== '') bgCtx.filter = savedOptions.endzone_filter;
            bgCtx.drawImage(endzoneCanvas, 0, 0);
            bgCtx.filter = 'none';

            //gate shadows...
            if (savedOptions.gate_shadows) {
                let tempCanvas = new OffscreenCanvas(mapWidth, mapHeight);
                let tempCtx = tempCanvas.getContext('2d');

                tempCtx.filter = 'drop-shadow(3px 3px 3px rgba(0,0,0,0.6))';
                tempCtx.drawImage(gateCanvas, 0, 0);
                tempCtx.filter = 'none';
                tempCtx.globalCompositeOperation = 'destination-out';
                tempCtx.drawImage(gateCanvas, 0, 0);
                bgCtx.drawImage(tempCanvas, 0, 0);
            }

            //walls...
            bgCtx.globalCompositeOperation = 'source-over';
            if (savedOptions.walls_filter !== '') bgCtx.filter = savedOptions.walls_filter;
            bgCtx.drawImage(wallCanvas, 0, 0);
            bgCtx.filter = 'none';

            //spikes...
            bgCtx.globalCompositeOperation = 'source-over';
            bgCtx.drawImage(spikeCanvas, 0, 0);
            bgCtx.filter = 'none';

            //remove anything left *outside* the map...
            bgCtx.globalCompositeOperation = 'destination-in';
            bgCtx.drawImage(fwCanvas, 0, 0);
        }


        tr.chunkifyBackground = function(bgCanvas) {
            let width = bgCanvas.width;
            let height = bgCanvas.height;
            let chunkSize = 2048; //256 or 512 or 1024 or 2048 or 4096 (TagPro default is 1024)

            if (tr.renderer.gl) {
                let maxSize = tr.renderer.gl.getParameter(tr.renderer.gl.MAX_TEXTURE_SIZE);
                if (chunkSize > maxSize) {
                    chunkSize = Math.pow(2, Math.round(Math.log(maxSize / 2) / Math.log(2)));
                    console.log("Chunk size was too large. Reducing to closest power of two below gl.MAX_TEXTURE_SIZE, which is " + chunkSize);
                }
            }

            tr.layers.background.removeChildren();

            for (let x = 0; x < width; x += chunkSize) {
                for (let y = 0; y < height; y += chunkSize) {
                    let w = x + chunkSize > width ? width - x : chunkSize;
                    let h = y + chunkSize > height ? height - y : chunkSize;

                    let canvas = new OffscreenCanvas(chunkSize, chunkSize);
                    let ctx = canvas.getContext('2d');

                    ctx.drawImage(bgCanvas,  x, y, w, h,  0, 0, w, h);
                    let texture = PIXI.Texture.fromCanvas(canvas);
                    let sprite = new PIXI.Sprite(texture);

                    sprite.x = x;
                    sprite.y = y;
                    tr.layers.background.addChild(sprite);
                }
            }
        };

        //Re-draw the background before it gets chunkified...
        tr.createBackgroundTexture = function(container) {
            tr.backgroundChunks = [];

            const bgCanvas = new OffscreenCanvas(mapWidth, mapHeight);
            const bgCtx = bgCanvas.getContext('2d');

            //add any modified dynamic tiles to the cache now so the draw doesn't pause the animation later...
            let tilesToPreDraw = [];
            if (savedOptions.gates_glow || savedOptions.gates_glow_outline) tilesToPreDraw.push(9.1, 9.2, 9.3);
            if (savedOptions.flags_glow || savedOptions.flags_outline) tilesToPreDraw.push(3, 4, 16);
            if (savedOptions.bombs_filter || savedOptions.bombs_outline) tilesToPreDraw.push(10, 10.1);
            if (savedOptions.pups_glow || savedOptions.pups_glow_outline) tilesToPreDraw.push(6, 6.1, 6.2, 6.3);
            if (tilesToPreDraw.length) drawCustomTiles(tilesToPreDraw);

            modifyBackgroundTexture(bgCtx);

            //Chunkify the new background...
            tr.chunkifyBackground(bgCanvas);
        };

        tr.drawGravityWells = function() {
            for (let x = 0; x < tagpro.map.length; x++) {
                for (let y = 0; y < tagpro.map[0].length; y++) {
                    if (tagpro.map[x][y] === 22) {
                        tr.createGravityWellEmitter(x * 40 + 20, y * 40 + 20);
                        tagpro.world.createGravityWell(x * 0.4, y * 0.4);
                    }
                }
            }
        };

        let startCounter2 = 0;
        tr.drawBackground = function() {
            const viewport = document.querySelector("#viewport");

            tr.gameContainer.visible = false;
            viewport.style.display = 'none';

            if (savedOptions.texture_logo_automatic && tagpro.group && tagpro.group.socket !== null && !tagpro.group.socket.connected) { // || (redTeamName === undefined || blueTeamName === undefined))) {
                startCounter2++;

                if (startCounter2 < 50) {
                    setTimeout(tr.drawBackground, 20);
                    return false;
                }
            }

            startCounter2 = 0;

            (async() => {
                while (!tr.readyToDrawBackground() && startCounter2 < 100) {
                    startCounter2++;
                    await new Promise(resolve => setTimeout(resolve, 50));
                }

                if (elementPositions.gravityWells.length) tr.drawGravityWells();

                tr.createBackgroundTexture(tr.layers.background);

                tr.gameContainer.addChildAt(tr.layers.background, 0);
                if (!defaultValues.globalOptions.no_splats) tr.drawStartingSplats();
                tr.drawDynamicTiles();
                requestAnimationFrame(tr.render);

                PM_Loading.remove();

                tr.layers.backgroundDrawn = true;

                setTimeout(function() {
                    viewport.style.display = 'inline-block';
                    tr.gameContainer.visible = true;

                    if (vpEffect && !document.hidden) {
                        $('#viewport').addClass('PM_Effect');
                    }

                    setTimeout(function() {
                        tagpro.renderer.centerView();
                    }, vpEffectTimeout + 100);
                }, 100);
            })();
        };


        let skipTileIds = [7, 8, 17, 18, 22];

        function drawCustomTiles(tiles) {
            let tilesArray = Array.isArray(tiles) ? tiles : [tiles];

            for (let i=0; i<tilesArray.length; i++) {
                let tileId = tilesArray[i];

                if (Math.floor(tileId) === 9) { //gates
                    let spriteCanvas = new OffscreenCanvas(80, 80);
                    let spriteCtx = spriteCanvas.getContext('2d');

                    spriteCtx.translate(20, 20);

                    if (savedOptions.gates_glow) {
                        let target = tileId === 9.2 ? 'red' : tileId === 9.3 ? 'blue' : 'green';
                        let glowColor;
                        if (savedOptions['gates_glow_color_' + target] === 'auto') {
                            let color = tinycolor(averageTileColors[target + 'gate']);
                            let brightness = color.getBrightness();
                            glowColor = color.saturate(100).brighten((255 - brightness) / 255 * 40).toHexString();
                        } else {
                            glowColor = savedOptions['gates_glow_color_' + target];
                        }

                        spriteCtx.filter = 'drop-shadow(0px 0px ' + defaultValues.gates_glow_size + 'px ' + glowColor + ')';
                        spriteCtx.drawImage(tilesImage, tagpro.tiles[tileId].x*40, tagpro.tiles[tileId].y*40, 40, 40,  0, 0, 40, 40);
                    }

                    if (savedOptions.gates_glow_outline) {
                        spriteCtx.filter = 'none';
                        spriteCtx.fillStyle = '#ffffff';
                        spriteCtx.fillRect(0,0,40,40);
                        spriteCtx.drawImage(tilesImage, tagpro.tiles[tileId].x*40, tagpro.tiles[tileId].y*40, 40, 40,  2, 2, 36, 36);
                    }

                    spriteCtx.translate(-20, -20);

                    imageCache[tileId] = PIXI.Texture.fromCanvas(spriteCanvas);
                    PIXI.utils.TextureCache[tileId] = imageCache[tileId];

                } else if (Math.floor(tileId) === 6 || Math.floor(tileId) === 10) { //pups & bombs
                    let spriteCanvas = new OffscreenCanvas(80, 80);
                    let spriteCtx = spriteCanvas.getContext('2d');

                    spriteCtx.translate(20, 20);

                    if (tileId != 6 && tileId != 10.1) { //don't draw for empty pups and inactive bombs
                        let baseTileId = Math.floor(tileId);
                        let doGlow = (baseTileId === 6 && savedOptions.pups_glow || baseTileId === 10 && savedOptions.bombs_filter);
                        let doOutline = (baseTileId === 6 && savedOptions.pups_glow_outline);

                        if (doGlow) {
                            if (tileId === 10) {
                                spriteCtx.filter = savedOptions.bombs_filter;

                            } else {
                                let glowColor;

                                if      (tileId === 6.1) glowColor = savedOptions.pups_glow_color_jj === 'auto' ? '#49dfff' : savedOptions.pups_glow_color_jj;
                                else if (tileId === 6.2) glowColor = savedOptions.pups_glow_color_rb === 'auto' ? '#ff9a63' : savedOptions.pups_glow_color_rb;
                                else if (tileId === 6.3) glowColor = savedOptions.pups_glow_color_tp === 'auto' ? '#40ff40' : savedOptions.pups_glow_color_tp;
                                else glowColor = '#ffffff';

                                spriteCtx.filter = 'drop-shadow(0px 0px 12px ' + hexToRgbA(glowColor, 0.5) + ') drop-shadow(0px 0px 5px ' + glowColor + ')';
                            }
                        }

                        spriteCtx.drawImage(tilesImage, tagpro.tiles[tileId].x*40, tagpro.tiles[tileId].y*40, 40, 40,  doOutline ? 3 : 0, doOutline ? 3 : 0, doOutline ? 34 : 40, doOutline ? 34 : 40);

                        if (doOutline) {
                            spriteCtx.filter = 'none';
                            spriteCtx.strokeStyle = '#ffffff';
                            spriteCtx.lineWidth = 2;
                            spriteCtx.beginPath();
                            spriteCtx.arc(20, 20, 14.5, 0, Math.PI * 2);
                            spriteCtx.closePath();
                            spriteCtx.stroke();
                        }

                    } else {
                        spriteCtx.drawImage(tilesImage, tagpro.tiles[tileId].x*40, tagpro.tiles[tileId].y*40, 40, 40,  0, 0, 40, 40);
                    }

                    spriteCtx.translate(-20, -20);

                    imageCache[tileId] = PIXI.Texture.fromCanvas(spriteCanvas);
                    PIXI.utils.TextureCache[tileId] = imageCache[tileId];

                } else if (tileId === 3 || tileId === 4 || tileId === 16) { //flags
                    let spriteCanvas = new OffscreenCanvas(40, 40);
                    let spriteCtx = spriteCanvas.getContext('2d');

                    if (savedOptions.flags_glow) {
                        let target = tileId === 3 ? 'red' : tileId === 4 ? 'blue' : 'yellow';
                        let glowColor;
                        if (savedOptions['flags_glow_color_' + target] === 'auto') {
                            let color = tinycolor(averageTileColors[target + 'flag']);
                            let brightness = color.getBrightness();
                            glowColor = color.saturate(100).brighten((255 - brightness) / 255 * 40).toHexString();
                        } else {
                            glowColor = savedOptions['flags_glow_color_' + target];
                        }

                        spriteCtx.filter = 'drop-shadow(0px 0px ' + defaultValues.flags_glow_size + 'px ' + glowColor + ')';
                        spriteCtx.drawImage(tilesImage, tagpro.tiles[tileId].x*40, tagpro.tiles[tileId].y*40, 40, 40,  0, 0, 40, 40);
                    } else {
                        spriteCtx.drawImage(tilesImage, tagpro.tiles[tileId].x*40, tagpro.tiles[tileId].y*40, 40, 40,  0, 0, 40, 40);
                    }

                    imageCache[tileId] = PIXI.Texture.fromCanvas(spriteCanvas);
                    PIXI.utils.TextureCache[tileId] = imageCache[tileId];

                    if (tileId === 3) PIXI.utils.TextureCache['redflag'] = imageCache[tileId]; //for the flag carrier sprite
                    else if (tileId === 4) PIXI.utils.TextureCache['blueflag'] = imageCache[tileId];
                    else if (tileId === 16) PIXI.utils.TextureCache['yellowflag'] = imageCache[tileId];
                }
            }
        }

        function drawGlowDynamicTile(tileId, xPos, yPos) {
            if (!imageCache[tileId]) {
                drawCustomTiles(tileId);
            }

            let sprite = new PIXI.Sprite(imageCache[tileId]);
            sprite.position.x = xPos;
            sprite.position.y = yPos;
            tr.layers.midground.addChild(sprite);

            return sprite;
        }

        tr.drawDynamicTile = function(x, y, tileId) {
            tileId = tileId || tagpro.map[x][y];
            let tile = tagpro.tiles[tileId];

            if (!tile || tileId <= 2 || (skipTileIds.indexOf(tileId) >= 0 && !isEvent)) {
                return;
            }

            let drawPos = { x:x * 40, y:y * 40 };
            let sprite;

            if (tile instanceof PIXI.extras.AnimatedSprite || tile.frameTiles) { //boosts/portals or respawn blinking
                if ( (savedOptions.pups_glow || savedOptions.pups_glow_outline) && (tileId == 6.11 || tileId == 6.21 || tileId == 6.31 || tileId == 6.41) || (savedOptions.bombs_filter || savedOptions.bombs_outline) && tileId == 10.11) {
                    drawPos.x = drawPos.x - 20;
                    drawPos.y = drawPos.y - 20;
                }
                sprite = tr.drawAnimation(tile, drawPos);

            } else if (tile.dynamic) { //bombs/gates/flags/pups
                if ((savedOptions.gates_glow || savedOptions.gates_glow_outline) && (tileId === 9.1 || tileId === 9.2 || tileId === 9.3)) {
                    sprite = drawGlowDynamicTile(tileId, drawPos.x - 20, drawPos.y - 20);

                } else if ((savedOptions.flags_glow || savedOptions.flags_outline) && (tileId === 3 || tileId === 4 || tileId === 16)) {
                    sprite = drawGlowDynamicTile(tileId, drawPos.x, drawPos.y);

                } else if ((savedOptions.bombs_filter || savedOptions.bombs_outline) && (tileId == 10 || tileId == 10.1)) {
                    sprite = drawGlowDynamicTile(tileId, drawPos.x - 20, drawPos.y - 20);

                } else if ((savedOptions.pups_glow || savedOptions.pups_glow_outline) && (tileId == 6 || tileId == 6.1 || tileId == 6.2 || tileId == 6.3 || tileId == 6.4 || tileId == 'grip' || tileId == 'bomb' || tileId == 'tagpro')) {
                    sprite = drawGlowDynamicTile(tileId, drawPos.x - 20, drawPos.y - 20);

                } else {
                    sprite = tagpro.tiles.draw(tr.layers.midground, tileId, drawPos, 40, 40);
                }

            } else {
                return;
            }

            if (!tr.dynamicSprites[x]) tr.dynamicSprites[x] = {};

            tr.dynamicSprites[x][y] = sprite;
        };

        let original_updateDynamicTile = tr.updateDynamicTile;
        tr.updateDynamicTile = function(update) {
            //this fixes the bug where a dynamic tile gets drawn twice...
            if (!tr.dynamicSprites[update.x] && !tr.layers.backgroundDrawn) {
                setTimeout(tr.updateDynamicTile, 50, update);
                return false;
            }

            return original_updateDynamicTile(...arguments);
        };

        if (defaultValues.globalOptions.no_splats) {
            tr.addSplat = function() {};
        }

        let chat_resize = function() {
            let viewportOffset = $("#viewport").offset();
            let viewportHeight = $("#viewport").height();

            $("#chat").css({
                left: viewportOffset.left + 5,
                top: viewportOffset.top + viewportHeight - 35
            });

            $("#chatHistory").css({
                left: viewportOffset.left + 5,
                top: viewportOffset.top + viewportHeight - $("#chatHistory").outerHeight() - 45
            });
        }

        tagpro.chat.resize = chat_resize;

        $(window).on('focus', function() {
            tagpro.renderer.centerView(); //also calls tagpro.ui.resize() and tagpro.chat.resize()
        });

        //Make the viewport transparent...
        if (defaultValues.globalOptions.transparent_viewport) {
            tr.createRenderer = function() {
                let options = {
                    view: tr.canvas,
                    antialias: true, //PIXI:false (TagPro:true)
                    forceFXAA: true, //PIXI:false (forceFXAA is faster, WebGL only) //FXAA is not actually implemented in later versions of PIXI despite the docs :(
                    forceCanvas: tr.options.forceCanvasRenderer, //PIXI:false
                    powerPreference: 'high-performance', //for devices with dual graphics cards the faster card will be preferred
                    transparent: true, //PIXI:false
                    backgroundColor: 0, //PIXI:0x000000
                    clearBeforeRender: true, //PIXI:true
                    preserveDrawingBuffer: false, //PIXI:false
                    roundPixels: false, //PIXI:false
                    width: 1280, //PIXI:800
                    height: 800, //PIXI:600
                    legacy: false //PIXI:false
                };

                return tr.options.forceCanvasRenderer ? new PIXI.CanvasRenderer(tr.canvas_width, tr.canvas_height, options) : PIXI.autoDetectRenderer(tr.canvas_width, tr.canvas_height, options);
            };

            let oldViewport = $(tr.canvas);
            let newViewport = $('<canvas id="viewport" width="1280" height="800"></canvas>'); //

            oldViewport.after(newViewport);
            tr.renderer.destroy(true);

            tr.canvas = document.querySelector('#viewport');
            tr.renderer = tr.createRenderer();
            tr.resizeAndCenterView();
            updateCSSBackground();

        } else {
            setTimeout(function() {
                updateCSSBackground();
                tagpro.chat.resize();
            }, 1500);
        }



        //Get some useful map data...
        tagpro.socket.on('map', getMapData);

        function getMapData(data) {
            //console.log('map:',data);

            PM_Loading.html('<div>Loading Map...</div>');

            mapWidth = tagpro.map.length * 40;
            mapHeight = tagpro.map[0].length * 40;

            for (let x=0; x<tagpro.map.length; x++) {
                for (let y=0; y<tagpro.map[x].length; y++) {
                    const tileId = tagpro.map[x][y];

                    if ((tileId == 3) || (tileId == 3.1)) { //red flag
                        elementPositions.redflag.push({ x:x*40, y:y*40 });
                    } else if ((tileId == 4) || (tileId == 4.1)) { //blue flag
                        elementPositions.blueflag.push({ x:x*40, y:y*40 });
                    } else if ((tileId == 16) || (tileId == 16.1)) { //yellow flag
                        elementPositions.yellowflag.push({ x:x*40, y:y*40 });
                    } else if (tileId == 11) { //red teamtile
                        elementPositions.teamred.push({ x:x*40, y:y*40 });
                    } else if (tileId == 12) { //blue teamtile
                        elementPositions.teamblue.push({ x:x*40, y:y*40 });
                    } else if (tileId == 23) { //yellow teamtile
                        elementPositions.teamyellow.push({ x:x*40, y:y*40 });
                    } else if (tileId == 17) { //red endzone
                        elementPositions.ezred.locs.push({ x:x*40, y:y*40 });
                        if (!elementPositions.ezred.x) { //use the first found redzone tile for both
                            elementPositions.ezred.x = x * 40 + 20;
                            elementPositions.ezred.y = y * 40 + 20;
                        }
                    } else if (tileId == 18) { //blue endzone
                        elementPositions.ezblue.locs.push({ x:x*40, y:y*40 });
                    } else if (tileId == 10 || tileId == 10.1 || tileId == 10.11) { //bomb
                        elementPositions.bombs.push({ x:x*40, y:y*40 });
                    } else if (tileId == 7) { //spike
                        elementPositions.spikes.push({ x:x*40, y:y*40 });
                    } else if (tileId == 6 || tileId == 6.1 || tileId == 6.11 || tileId == 6.2 || tileId == 6.21 || tileId == 6.3 || tileId == 6.31 || tileId == 6.4 || tileId == 6.41) { //powerup
                        elementPositions.pups.push({ x:x*40, y:y*40 });
                    } else if (tileId == 5 || tileId == 5.1 || tileId == 5.11) { //neutral boost
                        elementPositions.boosts.yellow.push({ x:x*40, y:y*40 });
                    } else if (tileId == 14 || tileId == 14.1 || tileId == 14.11) { //red boost
                        elementPositions.boosts.red.push({ x:x*40, y:y*40 });
                    } else if (tileId == 15 || tileId == 15.1 || tileId == 15.11) { //blue boost
                        elementPositions.boosts.blue.push({ x:x*40, y:y*40 });
                    } else if (tileId == 9 || tileId == 9.1 || tileId == 9.2 || tileId == 9.3) { //gate
                        elementPositions.gates.push({ x:x*40, y:y*40 });
                    } else if (tileId == 8) { //button
                        elementPositions.buttons.push({ x:x*40, y:y*40 });
                    } else if (tileId == 13 || tileId == 13.1 || tileId == 13.11) { //portal
                        elementPositions.portals.push({ x:x*40, y:y*40 });
                    //} else if (tileId == 25 || tileId == 25.1 || tileId == 25.11) { //red portal
                    //    elementPositions.portalsred.push({ x:x*40, y:y*40 });
                    //} else if (tileId == 26 || tileId == 26.1 || tileId == 26.11) { //blue portal
                    //    elementPositions.portalsblue.push({ x:x*40, y:y*40 });
                    } else if (tileId == 22) { //gravityWell
                        elementPositions.gravityWells.push({ x:x*40, y:y*40 });
                    }
                }
            }

            //detect the type of map rotation...
            let testTile = elementPositions.redflag;
            let checkTileId = 4; //blueflag id
            let isVertical = true; //will rule them out as necessary
            let isHorizontal = true;
            let isRotational = true;
            let is4Way = true;

            if (elementPositions.yellowflag.length) {
                testTile = elementPositions.ezred.locs;
                checkTileId = 18; //blue endzone id
            }

            if (testTile.length) {
                for (let i=0; i<testTile.length; i++) {
                    const redtileid = tagpro.map[testTile[i].x / 40][testTile[i].y / 40];

                    let bluex = testTile[i].x / 40;
                    let bluey = (mapHeight - testTile[i].y) / 40 - 1;
                    let bluetileid = tagpro.map[bluex][bluey];
                    if (Math.floor(bluetileid) !== checkTileId) {
                        isVertical = false;
                        bluex = (mapWidth - testTile[i].x) / 40 - 1;
                        bluey = testTile[i].y / 40;
                        bluetileid = tagpro.map[bluex][bluey];
                        if (Math.floor(bluetileid) !== checkTileId) {
                            isHorizontal = false;
                            bluex = (mapWidth - testTile[i].x) / 40 - 1;
                            bluey = (mapHeight - testTile[i].y) / 40 - 1;
                            bluetileid = tagpro.map[bluex][bluey];
                            if (Math.floor(bluetileid) !== checkTileId) {
                                isRotational = false;
                            }
                        } else {
                            isRotational = false;
                        }
                    } else {
                        isHorizontal = false;
                        isRotational = false;
                    }
                }

                if (isVertical && isHorizontal) {
                    is4Way = true;
                    isVertical = false;
                    isHorizontal = false;
                } else {
                    is4Way = false;
                }

                if (isVertical) {
                    elementPositions.halfway.y = (tagpro.map[0].length / 2) * 40;
                } else if (isHorizontal) {
                    elementPositions.halfway.x = (tagpro.map.length / 2) * 40;
                } else {
                    if (tagpro.map[0].length > tagpro.map.length) { //map height > width
                        elementPositions.halfway.y = (tagpro.map[0].length / 2) * 40;
                    } else { //map width >= height
                        elementPositions.halfway.x = (tagpro.map.length / 2) * 40;
                    }
                }
            } else {
                if (tagpro.map[0].length > tagpro.map.length) { //map height > width
                    elementPositions.halfway.y = (tagpro.map[0].length / 2) * 40;
                } else { //map width >= height
                    elementPositions.halfway.x = (tagpro.map.length / 2) * 40;
                }
            }

            if (elementPositions.yellowflag.length) {
                if (isRotational) {
                    elementPositions.ezblue.x = Math.abs(tagpro.map.length * 40 - elementPositions.ezred.x) - 20;
                    elementPositions.ezblue.y = Math.abs(tagpro.map[0].length * 40 - elementPositions.ezred.y) - 20;

                } else {
                    if (elementPositions.halfway.x) {
                        elementPositions.ezblue.x = Math.abs(tagpro.map.length * 40 - elementPositions.ezred.x) - 20;
                        elementPositions.ezblue.y = elementPositions.ezred.y;
                    } else {
                        elementPositions.ezblue.x = elementPositions.ezred.x;
                        elementPositions.ezblue.y = Math.abs(tagpro.map[0].length * 40 - elementPositions.ezred.y) - 20;
                    }
                }
            }

            elementPositions.mapInfo = data.info;

            tagpro.rawSocket.removeListener('map', getMapData);
        }



        //draw to canvas functions...
        function addGradientPattern(ctx, width, height, type1, type2, color1, color2, opacity1, opacity2, repeats1=50, repeats2=4) {
            let tempCanvas = new OffscreenCanvas(ctx.canvas.width, ctx.canvas.height);
            let tempCtx = tempCanvas.getContext('2d');

            let gradient;
            let w2 = width/2;
            let h2 = height/2;

            ctx.save();
            ctx.globalCompositeOperation = 'source-atop';

            if (type1 === 'centerline') {
                if (elementPositions.halfway.x) {
                    gradient = tempCtx.createLinearGradient(0, h2, width, h2);
                } else {
                    gradient = tempCtx.createLinearGradient(w2, 0, w2, height);
                }

            } else if (type1 === 'diagonal') {
                gradient = tempCtx.createLinearGradient(0, 0, Math.max(width, height), Math.max(width, height));

            } else if (type1 === 'rdiagonal') {
                gradient = tempCtx.createLinearGradient(Math.max(width, height), 0, 0, Math.max(width, height));

            } else if (type1 === 'centercircle') {
                gradient = tempCtx.createRadialGradient(w2, h2, 0, w2, h2, Math.sqrt(Math.max(width, height) * Math.max(width, height) * 2) / 2);

            }

            let co1 = hexToRgbA(color1, opacity1);
            let co2 = hexToRgbA(color2, opacity2);

            if (repeats1 === '0') {
                gradient.addColorStop(0, co1);
                gradient.addColorStop(1, co2);

            } else {
                let gradientInterval = 1 / repeats1;
                let i = gradientInterval;
                let alt = true;

                gradient.addColorStop(0, co1);
                while (i < 1) {
                    if (alt) {
                        gradient.addColorStop(i, co2);
                        alt = false;
                    } else {
                        gradient.addColorStop(i, co1);
                        alt = true;
                    }
                    i += gradientInterval;
                }
                gradient.addColorStop(1, co1);
            }

            tempCtx.fillStyle = gradient;
            tempCtx.globalAlpha = 0.5;
            tempCtx.fillRect(0, 0, width, height);

            if (type2 === 'centerline') {
                if (elementPositions.halfway.x) {
                    gradient = tempCtx.createLinearGradient(0, h2, width, h2);
                } else {
                    gradient = tempCtx.createLinearGradient(w2, 0, w2, height);
                }

            } else if (type2 === 'diagonal') {
                gradient = tempCtx.createLinearGradient(0, 0, Math.max(width, height), Math.max(width, height));

            } else if (type2 === 'rdiagonal') {
                gradient = tempCtx.createLinearGradient(Math.max(width, height), 0, 0, Math.max(width, height));

            } else if (type2 === 'centercircle') {
                gradient = tempCtx.createRadialGradient(w2, h2, 0, w2, h2, Math.sqrt(Math.max(width, height) * Math.max(width, height) * 2) / 2);

            }

            if (repeats2 === '0') {
                gradient.addColorStop(0, co1);
                gradient.addColorStop(1, co2);

            } else {
                let gradientInterval = 1 / repeats2;
                let i = gradientInterval;
                let alt = true;

                gradient.addColorStop(0, co1);
                while (i < 1) {
                    if (alt) {
                        gradient.addColorStop(i, co2);
                        alt = false;
                    } else {
                        gradient.addColorStop(i, co1);
                        alt = true;
                    }
                    i += gradientInterval;
                }
                gradient.addColorStop(1, co1);
            }

            tempCtx.fillStyle = gradient;
            tempCtx.globalAlpha = 0.5;
            tempCtx.fillRect(0, 0, width, height);

            ctx.drawImage(tempCanvas, 0, 0);

            ctx.globalCompositeOperation = 'source-over';
            ctx.restore();
            tempCanvas = null;
        }

        //--------------------------------------------------------------------
        //FROM: https://thesoftwaresimpleton.com/blog/2015/10/31/perpendicular

        //Below are two helper functions that take javascript point objects as arguments with x and y properties that map to coordinates and return either a gradient/slope or the perpendicular gradient/slope that occurrs between the 2 coordinates:
        const gradient = function(a, b) {
            return (b.y - a.y) / (b.x - a.x)
        }
        const perpendicularGradient = function(a, b) {
            return -1 / gradient(a, b)
        }

        //Below is a helper function to find the midpoint between two vertices or points:
        const midpoint = function(a, b) {
            return { x: (a.x + b.x) / 2, y: (a.y + b.y) / 2 }
        }

        //Below is a function that will find the y-intercept given a vertex and a gradient/slope:
        //You can think of the below function as rearranging y = mx + c to solve for c or c = y - mx.
        function getYIntercept(vertex, slope) {
            return vertex.y - slope * vertex.x
        }

        //Below is the code that brings this all together:
        //The finshed function looks like this and there are a number of if statements I had to add for the conditions when the slope or gradient function might end up undefined or equalling infinity when it encounters horizontal or vertical values that have catches with the formula. I would love to know if there is an algorithm that will avoid such checks:
        function perpendicularBisector(a, b) {
            const slope = perpendicularGradient(a, b),
                  midPoint = midpoint(a, b),
                  yIntercept = getYIntercept(midPoint, slope),
                  xIntercept = -yIntercept / slope

            return { vertex: midPoint, slope: slope, yIntercept: yIntercept, xIntercept: xIntercept }
        }

        //Flip the y-axis origin from bottom-left (as in the above functions) to top-left (canvas)
        function adjustY(y, height) {
            return -y + height;
        }
        //--------------------------------------------------------------------


        function addGradient(ctx, x1, y1, width, height, type, color1, color2, opacity1, opacity2, repeats='0', size=100) {
            let gradient;

            ctx.save();

            if (type === 'centerline') {
                if (elementPositions.halfway.x) {
                    gradient = ctx.createLinearGradient(x1, 0, x1 + width, 0);
                } else {
                    gradient = ctx.createLinearGradient(0, y1, 0, y1 + height);
                }

            } else if (type === 'flags') {
                if (elementPositions.yellowflag.length) {
                    gradient = ctx.createLinearGradient(elementPositions.ezred.x+20, elementPositions.ezred.y+20, elementPositions.ezblue.x+20, elementPositions.ezblue.y+20);
                }

                if (elementPositions.redflag.length) {
                    for (let i=0; i<elementPositions.redflag.length; i++) {
                        gradient = ctx.createLinearGradient(elementPositions.redflag[i].x+20, elementPositions.redflag[i].y+20, elementPositions.blueflag[i].x+20, elementPositions.blueflag[i].y+20);
                    }
                }

            } else if (type === 'diagonal') {
                let pB = perpendicularBisector({ x:x1, y:adjustY(y1,height) }, { x:width, y:adjustY(height,height) });

                gradient = ctx.createLinearGradient(x1, pB.yIntercept, width, -pB.yIntercept+height);

            } else if (type === 'rdiagonal') {
                let pB = perpendicularBisector({ x:x1, y:adjustY(height,height) }, { x:width, y:adjustY(y1,height) });

                gradient = ctx.createLinearGradient(x1, pB.yIntercept, width, -pB.yIntercept+height);

            } else if (type === 'centercircle') {
                let w2 = width / 2;
                let h2 = height / 2;

                gradient = ctx.createRadialGradient(w2, h2, 0, w2, h2, Math.sqrt(Math.max(width, height) * Math.max(width, height) * 2) / 2);
            }

            let co1 = hexToRgbA(color1, opacity1);
            let co2 = hexToRgbA(color2, opacity2);

            if (repeats === '0') {
                let stop0 = 0.5 - size / 2 / 100;
                let stop1 = 0.5 + size / 2 / 100;
                gradient.addColorStop(stop0, co1);
                gradient.addColorStop(0.5, co2);
                gradient.addColorStop(stop1, co1);

            } else {
                let gradientInterval = 1 / repeats;
                let i = gradientInterval;
                let alt = true;

                gradient.addColorStop(0, co1);
                while (i < 1) {
                    if (alt) {
                        gradient.addColorStop(i, co2);
                        alt = false;
                    } else {
                        gradient.addColorStop(i, co1);
                        alt = true;
                    }
                    i += gradientInterval;
                }
                gradient.addColorStop(1, co1);
            }

            ctx.fillStyle = gradient;
            ctx.fillRect(x1, y1, width, height);

            ctx.restore();
        }

        function addCheckered(ctx, mapWidth, mapHeight, size=40, margin=0, color='#000000', opacity=0.05, normal=true, random=false, straight=false, stripes=false, stripespattern='', globalCompositeOperation='source-over') {
            if (stripes && size === 1) return;

            ctx.save();
            ctx.globalCompositeOperation = globalCompositeOperation;

            if (random) {
                ctx.beginPath();
                let maxOpacity = opacity * 100;
                for (let i=0; i<mapWidth; i+=size) {
                    for (let j=0; j<mapHeight; j+=size) {
                        ctx.fillStyle = hexToRgbA(color, getRandomInt(0, maxOpacity) / 100);
                        ctx.fillRect(i+margin, j+margin, size-margin*2, size-margin*2);
                    }
                }
                ctx.closePath();
            }

            if (stripes) {
                if (stripespattern) { //only for endzones (this is a bit borked - only certain patterns will work properly atm)
                    let rawString = stripespattern; // || Math.max(size, margin) + ',' + Math.min(size, margin) + ',' + ((size + margin)) + ',0'; //'2,0.5, 5,1.5, 12,3, 20,0';
                    let raw = rawString.split(',');
                    let lines = [];
                    let spaces = [];

                    if (raw.length % 2 !== 0) return;

                    for (let i = 0; i < raw.length; i += 2) {
                        if (raw[i] >= 0 && raw[i + 1] >= 0) {
                            lines.push(+raw[i]);
                            spaces.push(+raw[i + 1]);
                        }
                    }

                    let adjust = Math.max(...lines) / 2;
                    let total = Math.max(...lines) + Math.max(...spaces);
                    let pattern = new OffscreenCanvas(total, total);
                    let pctx = pattern.getContext('2d');

                    console.log('rawString:',rawString,raw,lines,spaces,adjust,total);

                    pctx.strokeStyle = hexToRgbA(color, opacity);
                    pctx.lineCap = 'round';

                    let cumulative = 0;
                    for (let i=0; i<lines.length; i++) {
                        if (spaces[i] > 0) {
                            pctx.lineWidth = lines[i];

                            let this_position = cumulative + lines[i] / 2;

                            console.log('this_position:',i,lines[i],spaces[i],this_position,adjust,total);
                            console.log(-adjust, this_position + adjust);
                            console.log(this_position + adjust, -adjust);
                            console.log(this_position - adjust, total + adjust);
                            console.log(total + adjust, this_position - adjust);

                            pctx.beginPath();
                            pctx.moveTo(-adjust, this_position + adjust);
                            pctx.lineTo(this_position + adjust, -adjust);
                            pctx.closePath();
                            pctx.stroke();

                            pctx.beginPath();
                            pctx.moveTo(this_position - adjust, total + adjust);
                            pctx.lineTo(total + adjust, this_position - adjust);
                            pctx.closePath();
                            pctx.stroke();

                            cumulative += lines[i] + spaces[i];
                        }
                    }

                    let patt = ctx.createPattern(pattern, "repeat");
                    ctx.fillStyle = patt;
                    ctx.fillRect(0, 0, mapWidth, mapHeight);

                    pattern = null;

                } else {
                    let divisions = size;
                    let division_size = Math.max(mapWidth, mapHeight) / divisions;
                    let x2 = mapWidth > mapHeight ? division_size : mapWidth;
                    let y2 = mapWidth > mapHeight ? mapHeight : division_size;
                    ctx.fillStyle = hexToRgbA(color, opacity);
                    if (margin > 0) ctx.filter = 'blur(' + margin + 'px)';
                    for (let i=0; i<divisions; i+=2) {
                        let x1 = mapWidth > mapHeight ? i * division_size : 0;
                        let y1 = mapWidth > mapHeight ? 0 : i * division_size;
                        ctx.fillRect(x1, y1, x2, y2);
                    }
                    ctx.filter = 'none';
                }
            }

            if (straight) {
                let pattern = new OffscreenCanvas(size + margin, size + margin);
                let pctx = pattern.getContext('2d');

                pctx.beginPath();
                pctx.fillStyle = hexToRgbA(color, opacity);
                pctx.fillRect(margin/2, margin/2, size, size);
                pctx.closePath();

                let patt = ctx.createPattern(pattern, "repeat");
                ctx.fillStyle = patt;
                ctx.fillRect(0, 0, mapWidth, mapHeight);

                pattern = null;
            }

            if (normal) {
                let pattern = new OffscreenCanvas((size + margin) * 2, (size + margin) * 2);
                let pctx = pattern.getContext('2d');

                pctx.beginPath();
                pctx.fillStyle = hexToRgbA(color, opacity);
                pctx.fillRect(size+margin+margin/2, margin/2, size, size); //top right
                pctx.fillRect(margin/2, size+margin+margin/2, size, size); //bottom left
                pctx.closePath();

                let patt = ctx.createPattern(pattern, "repeat");
                ctx.fillStyle = patt;
                ctx.fillRect(0, 0, mapWidth, mapHeight);

                pattern = null;
            }

            ctx.globalCompositeOperation = 'source-over';
            ctx.restore();
        }

        function addGrid(ctx, mapWidth, mapHeight, size=40, length=40, width=1, color=averageTileColors.actualFloorAlt, opacity=0.05, square=false, rectangles=false, lines=false, diagonal=false, crosses=false, shadow=false, globalCompositeOperation='source-over') {
            let pattern = new OffscreenCanvas(size, size);
            let pctx = pattern.getContext('2d');

            ctx.save();
            ctx.globalCompositeOperation = globalCompositeOperation;

            pctx.strokeStyle = hexToRgbA(color, opacity);

            if (diagonal) {
                pctx.lineWidth = width;
                pctx.beginPath();
                pctx.moveTo(size/2-length/2, size/2-length/2); // 0,0
                pctx.lineTo(size/2+length/2, size/2+length/2); // 40,40
                pctx.moveTo(size/2+length/2, size/2-length/2); // 40,0
                pctx.lineTo(size/2-length/2, size/2+length/2); // 0,40
                pctx.stroke();
                pctx.closePath();
            }

            if (square || lines || rectangles) {
                pctx.translate(0.5, 0.5);
                pctx.lineWidth = width;

                pctx.beginPath();

                if (lines) {
                    pctx.moveTo(0-width, size/2); // 0,20
                    pctx.lineTo(size-(size-length)+width, size/2); // 40,20
                    pctx.stroke();

                }

                if (square || rectangles) {
                    pctx.moveTo(0, size-(size-length));
                    pctx.lineTo(0, 0);
                    pctx.lineTo(size-(size-length), 0);
                    if (rectangles) {
                        pctx.moveTo(0, size/2);
                        pctx.lineTo(size-(size-length), size/2);
                    }
                    pctx.stroke();
                }
                pctx.closePath();
                pctx.translate(-0.5, -0.5);
            }

            if (crosses) {
                pctx.translate(0.5, 0.5);
                pctx.lineWidth = width;

                pctx.beginPath();
                pctx.moveTo(0, length); // 0,10
                pctx.lineTo(0, 0); // 0,0
                pctx.lineTo(length, 0); // 10,0
                pctx.moveTo(size-length, 0); // 30,0
                pctx.lineTo(size, 0); // 40,0
                pctx.lineTo(size, length); // 40,10
                pctx.moveTo(size, size-length); // 40,30
                pctx.lineTo(size, size); // 40,40
                pctx.lineTo(size-length, size); // 30,40
                pctx.moveTo(length, size); // 10,40
                pctx.lineTo(0, size); // 0,40
                pctx.lineTo(0, size-length); // 0,30
                pctx.stroke();
                pctx.closePath();
                pctx.translate(-0.5, -0.5);
            }

            let patt = ctx.createPattern(pattern, "repeat");
            ctx.fillStyle = patt;
            if (shadow) {
                if (diagonal) ctx.filter = 'drop-shadow(1px 0px 0px ' + averageTileColors.actualFloorAlt2 + ')';
                else ctx.filter = 'drop-shadow(1px 1px 0px ' + averageTileColors.actualFloorAlt2 + ')';
                ctx.fillRect(0, 0, mapWidth, mapHeight);
                ctx.filter = 'none';
            }
            ctx.fillRect(0, 0, mapWidth, mapHeight);

            ctx.restore();
            pattern = null;
        }

        function drawCircle(ctx, linewidth, radius, color, opacity, useGradient, dashsize, blur, x, y, fill=false, glow=0, glowMultiplier=1) {
            ctx.save();

            ctx.beginPath();
            ctx.arc(x, y, radius, 0, 2*Math.PI);
            ctx.closePath();

            if (fill) {
                if (blur > 0) ctx.filter = 'blur(' + blur + 'px)';

                if (useGradient) {
                    let radialGradient = ctx.createRadialGradient(x, y, 0, x, y, radius);

                    radialGradient.addColorStop(0, hexToRgbA(color, opacity));
                    radialGradient.addColorStop(1, hexToRgbA(color, 0.1));

                    ctx.fillStyle = radialGradient;

                } else {
                    ctx.fillStyle = hexToRgbA(color, opacity);
                }

                ctx.fill();
            }

            if (linewidth > 0) {
                let filter = '';

                ctx.lineWidth = linewidth;

                if (Array.isArray(dashsize)) ctx.setLineDash(dashsize);
                else if (dashsize > 0) ctx.setLineDash([dashsize]);

                if (useGradient) {
                    let radialGradient = ctx.createRadialGradient(x, y, radius-linewidth/2, x, y, +radius+linewidth/2);
                    radialGradient.addColorStop(0, hexToRgbA(color, opacity));
                    radialGradient.addColorStop(1, hexToRgbA(color, 0));

                    ctx.strokeStyle = radialGradient;

                } else {
                    if (glow > 0) {
                        let filterr = ' drop-shadow(0 0 ' + glow + 'px ' + color +')';

                        for (let i=1; i<glowMultiplier; i++) {
                            filter += filterr;
                        }

                        color = '#fff'
                    }

                    ctx.strokeStyle = hexToRgbA(color, opacity);
                }

                if (blur > 0) filter += ' blur(' + blur + 'px)';
                if (filter !== '') ctx.filter = filter;

                ctx.stroke();
                ctx.setLineDash([]);
            }

            ctx.filter = 'none';
            ctx.globalCompositeOperation = 'source-over';
            ctx.restore();
        }

        function drawLine(ctx, x1, y1, x2, y2, color='#000000', lineWidth=1, dashsize=0, glow=0) {
            ctx.save();

            if (glow > 0) {
                ctx.filter = ' drop-shadow(0 0 ' + glow + 'px ' + color +') drop-shadow(0 0 ' + glow + 'px ' + color +')';
                color = '#ffffff'
            }

            ctx.strokeStyle = color;
            ctx.lineWidth = lineWidth;
            if (Array.isArray(dashsize)) {
                ctx.setLineDash(dashsize);
            } else if (dashsize > 0) {
                ctx.setLineDash([dashsize]);
            }

            if (lineWidth % 2 !== 0) ctx.translate(0.5, 0.5)

            ctx.beginPath();
            ctx.moveTo(x1, y1);
            ctx.lineTo(x2, y2);
            ctx.stroke();
            ctx.closePath();

            if (dashsize !== 0) {
                ctx.translate(-0.5, -0.5);
                ctx.setLineDash([]);
            }

            ctx.filter = 'none';
            ctx.restore();
        }

        function drawStar(ctx, start_x=20, start_y=20, strokeStyle=false, fillStyle='#ffffff', isStar=true, holeRadius=4, points=8, outer_radius=14, inner_radius=8) {
            let tempCanvas = new OffscreenCanvas(ctx.canvas.width, ctx.canvas.height);
            let tempCtx = tempCanvas.getContext('2d');
            let tempCanvasOffset = (ctx.canvas.width - start_x * 2) / 2;

            tempCtx.translate(tempCanvasOffset, tempCanvasOffset);

            let two_PI = Math.PI * 2;
            let half_PI = Math.PI / 2;
            let distance = (two_PI / points);

            tempCtx.moveTo(start_x, start_y);
            tempCtx.beginPath();

            for (let i = 0; i <= points; i++) {
                let new_outer = (i + 1) * distance;
                let half_new_outer = new_outer - (distance / 2);

                if (isStar) tempCtx.lineTo(start_x + Math.round(Math.cos(half_new_outer - half_PI) * inner_radius), start_y + Math.round(Math.sin(half_new_outer - half_PI) * inner_radius));
                tempCtx.lineTo(start_x + Math.round(Math.cos(new_outer - half_PI) * outer_radius), start_y + Math.round(Math.sin(new_outer - half_PI) * outer_radius));
            }

            tempCtx.closePath();

            if (fillStyle) {
                tempCtx.fillStyle = fillStyle;
                tempCtx.fill();
            }
            if (strokeStyle) {
                tempCtx.lineWidth = 1;
                tempCtx.strokeStyle = strokeStyle;
                tempCtx.stroke();
            }

            if (holeRadius > 0) {
                tempCtx.globalCompositeOperation = 'destination-out';
                tempCtx.beginPath();
                tempCtx.arc(start_x, start_y, holeRadius, 0, two_PI);
                tempCtx.closePath();
                tempCtx.fill();
                tempCtx.globalCompositeOperation = 'source-over';
            }

            ctx.drawImage(tempCanvas, 0, 0);
        }

        let kbLogoImage = new Image();
        let kbLogoData = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC8AAAAtCAYAAAA+7zKnAAAAB3RJTUUH4ggBFw0aTjEOTwAAAAlwSFlzAAAewQAAHsEBw2lUUwAAAARnQU1BAACxjwv8YQUAABI9SURBVHjarVl5cF3Vef/uve/e+/ZFb9Vqa7FkCcubvCiywcTGQMLWsAzQBtKUJQ1NhvyRlHamM23TGcpkazPtFDKdoUChTMvEEIgLBRtjgxcZC2+yvEiW9KS36O37ct/d+p0jy8hCtsWQM/MsPd9zz/mdb/l9v++IgcUH+82NG1cHGhv77U7nBqNRWCkIopvRdU6qyYVypTKaTacH44nE3vcGB0/jfP0BAA62bTNVikXt90NDFfJ/c4vdsnlzd8DtvsNV57zZZrOvMpvNbs5g4DRFLpXL1XCxVBzOpDMfRRKJ/XsGB8fmv3utwcz/cntHh+jt6Oh3+3x/0d7RNlDndPlEUeQZnMXzPAiiCBzHgqKokMvl1XMjZ6Mnz5x5S+R5lReE1QaOc4Oua4qqJmqKckaW5Q/xwB19fX1PL1/W0uSqc3E4cIoO+AxUXMdgMADDMZDP5eVwKBwanwy+F49Gf/3Gvn0XrneI+eDZh2677dl1q3v/vKGx0VGrVKFUKiNQZXYinsCAB3B76sAf8EMoHIHDRwbBYjKBt84NgiDQOWQQcFJNgnQ2q87E48yaNavZtWtWg6ZrkIglIJvKgFyr4Txcl2UAvQA2uxWcdS7QNR0OHT4yef7s6NNvHzrw9nXBb9u2xtlia35+dU/PQwIvgCIrwKKF58Bcnozfi/kqTIVDeFQFuju7YM6SnIEDlmXp7wSAqqp0PvkEp6chV8iD0+oDd50VRCN/xbr0Hfxo+A5ZQzQaIRKNlsbGJ37y33vef/5q4DkSq57ejX/ds2LFEyajidM07Qrgnx9Ah2pFgdGLk2CxCdDZ1k5dbrKYQDSJl8PKbDGDaDbSZwQIWc9msYAZPTQxNQEG1gQWi0jBkueX3Y6/s2gI3BBUfMduswkYTmvrHI7BC5OT04uCb9+ypWdZc8sv/V6vS7lkrbmFCex4IgmpdApKlTKEI3EQTAx0ta/AEDLgISzAMmhtVQc7utzf3Eh/2lxOsDod6AFt9kM2YjlwuRxwfvwCWB1WSKVSUMHQRJBf8C5zyRtWi9WWL+SNjkDg7WAwqH0B/OY1a77f3rLsLoZlmfnAC4UipPIZ2HDjBtj5R9+AppZ6OHXyJKzqWgkcz1EL4xs0Xl0+D7gDvis8RdZw1NVBTZJoOGBgoNU5kPD7jrtvhfu+fT8oqgynTw2D1WS5wguXweEGGH4dair18pmpqfzC5yy6czu6+/KbZBGpKkFVk+Dh7z4EAzu2gUng4aMPDkDA48cEY8FkNlHg6VwOTgwPQ1Gq0jCplMuQy2ToM/KZmZkBHudy+I7RKAIxXXNDI/zfm+9CqViC/q/fCDvv2AHRRGxR8MRjLofTrBgMX1ssbAxGUexamDwziTjc+8f3gKehHiq4ycWzFyA8FYGeri4QjAJN0kKxCB8e+Bi2bN0C4+MTMHbuPOw5PAQcxn3AaoSbbtoCnx0/QRlrY28vJmodPQAJxmqpAmdPnIa1A5uhc1U3TI4HIRaMgRNDbSEWQRQAabhzMfAsbzBc8QbZbFl7MzS2LkNq06Gcy8Oxo8ch4PNR6xJKJEmI78HtO7bD1psGwG61wFuHPoOeW+6Emx/6DrTfei8c+OQwfO97j8Njj38XYhjfBAiPHiR06UZqPTl0EpCSgEdm2TywEcq1KiwoO7MAMacwNK2LgsfMrn4eYywUyyVwYGLphCmQ44nlQ9MRcNjt1OJzeUEOYTGZIZ/Jwp79h6C+vROTD2kQE3ld33rQHD4YOX0GTCYjbNrQd5kGCa9bMJQS8RSU0XuEYSLROGCVBeaL2KmhdEUpLgpekmqhz8kQQEDKO7j/CP2iIvh0OoOH0KjVSaIS4HMHIJNCQeRwSaYFjORDLpuFIuYCb7FCMpmkB5aql+1DWYccvCbVIIfFiuTPFDKhw2wDWrUWMI+MGCRZnlwcvFw7L2G1I4MUljqXC3w+LyZbDFTcIIlUaULXziXz/IVJPQhivOoGgVIieS5jgRs+PYwbKujFMtQw+Yn35sxKLE/pVZstSkc/OQIx3MtmtX5BCxAJkc5myMbnFgWfL5VeOjUyspuccI7m5JoM//5PLyBzZNFqNRqLuv5FmUHAZtHKrGiEUj6H89OUOlVFhkw6DelkGqLoGeKR+dKBhDbxSCKRgMEDhyE+HQUUa9Twc9XWQMJpZiYxEZz4IVssnlkMPDdy8eLoqo72jNVifpDBXWYrohXDhIfBwWPUrYmZJC0mlC24z61PNilhPZhESsxjaESxgpbymOCHDgCjKdDhcVGWIWvOeUuqSDQ8sjhv6NhJ0GoqZTFSBwhBZDDs7FYboHJFCo1/+p+/3/2DkVBIXhQ8+ac3EEhNJ5Mauu5GPABDwojwNCkqk5NTmJgWEAUiAQyUuuaHjohWR9KGPCYfZzRDDd8V0dIrHSbUTDehVDBRK88KMR1rQYV6IhSNQsDrA6/Hg8lagkq1AtPhMCazGeWDCT49fvzDVCLxzIVQKAxXGRT86ampamt390GEcavNamtkL1VbAljFqJHkKphEolc4KgvmW58Ac9gd4EepYAMVnIwGPU31yDDrwSAKl4UbAV9FOUBEHxkzqC49bi/UZIl6IY7JbUdGs6AOQusXYpnkT363/8BHcI3Bzf0yNjamNno8x1RVWW8UjY2iSNSlBnKFhXw5DQ6bHd2vk5KN8WigoGbjnqHecGCBaaivh+UtLSiZfVRKE8CEsWSUBAQ4+dAKjnI5mcyAw+KCUjVPWgCo9wco8EQykZgMhX6ckPb8NhgEbUngyTgfDM7YfL5Xy+nUSE2SzdWSalQ11SjLNZbjWQKYaFykThV1iUIPwF5KRqoK8SAkGUkhmp/8pUKJSg4yhyRiNBaTsYNCaKwsGPky0nMUK/bRSDT2L9H4zOO7PvzwMAG+qQ6amt0gh/KgLAaeudqpbt+0yW5zOn0CK7gUXbYYBeHnzQ0tGwgoK5HBwmzskxCiWh5/UgokhKfP0i7plMjP+TlCxonh00O5YvFJu9lcxsqClFyQJF1Pv7FnT44837ZtY8DEWZ60hSfvKVaT//BusPjWlwK/cHxr27Z+j9vzclN9YyeRziSsyCGIgNX0WcAwv9pdWn1+Q0MkxXgwqI9PBR97c9++/1hsn/7+/tuXNy376V3339t38OVXWDV89OO9pxI7sbGVFs41LBE7i32qL18oZcekCWjE2CYhkM7kwYiHEC/1tnM455eEOYlN2As7MH10YvzlWiTyXwuNuHPbwBqnu/Hv6r0Nd7qdbs6O0mPDg/dD/M2JG/tqxSfGzlX+DeddkQMcXGfc2ddnXt/b+7cd7R3Pkt7F7fRgUqUx6SooJQzU6pgftIxrqjbrBZhloTlpXEK9ND45ie9lIeD3NzBmU6oR4MxYOq32N4Fplcv9uMPme2FNd9cGd/NyNtDipe+sX98Hp8NpyFw8kRYT8ntRTKEvZXne4Xjkhu7uZwSDyJHN3R47ii8RO6EcSogU6h3AnlOgOWDAL3N9rCjyUEWdn83moFiUwOvyQVODk0EP+Z126y+qkmRAinvBztmearP3/j1fdllSsSC01TeChuus670B3abBjnsehoOnx2eGjHEZhoauwHZNy5M437xp4/NdnSvsw2fOY+U1Y6ESwON3QGOzD0w8KlVVQCrUsE7V8FNGnV+CYqGKUqEMWB7AZnJCZ0cHeANOxKJCKByDvvVrjB6/f7seHTfd4Fz5zNdWcNZlzhIMhwxgM2LBisWBsTpgfGKCaqa1q3t7w8eOTYVCoeF5GXVt8ANr1z6zbv3a7ZlUhglHYlTyCqjJ7Q4bbbhtTjN4fA5w1dmxwFiphHA5XOB1e8Dv90J9gxcamj3gCbiwb7Wj2ixAPl/EZtwInd0rDMlYZsutTXljfUBhOlaaoZLRtf3TyQuZQjLiMDt8otPFFAsFaGhoELu7u29qaWnZjr+zWMxS4XA4f1Xwt/T1OZobm541CUZvCct3BpsSJzbORN9YbWZasIhMJovPxKIgYVvAmzjQGIx9DE2Px0kPRRjH7q5DOmUxSi5Snifc73LambKis822BNPV5oKjowk4eP7sS5HR8e8r7uZYvd3yTas/QC+pMtha+v1+844dO9pXrVr1LWzee1Bu775qzBstlk673eYBeoEk0005blbb6JcScnR0DLwtAbjvsYfAX++nOp0AS6fS8PHeA3ABn6/AkJm4eBEbmhBwjIEeGHsIiKMnRcEEp2Z09fDp44ffOhL+m+EiHCBhsa6MuZKKVZz5Em92WjE8UGFGIoBhA1u3boVHH310O4L/0VXBI0tgO8XQ2yGFymWixYFeXxCVSBqNznU9cMsdO6leIaDJhwwiFe558F4YRK1+6tAQFXSNgXpkI51epZDqTDsqIw9H4/yui4fDPxwuQWxub+TDiq4qGlGgFpftcsXuQEMQowUCAUNdXd0AezXwBlUdn5nJlGYiBWSMMhVkpDEoonokd5XFShm2br+Rlv35VZQM8l1ClbgRe1NG5Ag9ojR2zV4Z4uY1iTzHLi2JvYDBdGBwHnC6N8e1WkSBFzFE527fWltbCWhs0p3w2muvXTh48OCPrgp+1yefjGeKiR9Ek+HzhXyZVkcBO6bhkbPYGqaxmSbN+NWZdrZV1KCjcxnE48lZirhUcatVGaaDSW18auL9Qrn46vz3enp6hJU2/k8cLr9JsJrBiGA3DgxAK2p+Itx+9rOfHXz99dfvHsFxTZ5/44MPfnfvjh0nGdXwY7fX9oTFbDE0NASoAMuV89je5YEXLRhdzIL+c/bWq1rI0RqgYDtHp2iz7q8p1ViqUHglJ1V++c7+/VnyxpNYUvJutzfT4L27q7Pr23xNZ7W33wKxrQ0ZKg/Bzz6rfsRxu3e/887To6OjVONfr0hpu/buHb+9f/u7CO5RjHUDuQ0gMU/ivFIsQBmZyGSxY7HiqTAjFVbDNrCCwInlSYixLLl1YEHB7oo0KzVFeeN/Ptj9l/M3cghCW5PR+KLzG3et3nTzdmt67x4wvPoKtAwOwskXXywMl0rPvuZ2/yu2jpdvEpakbWRJSSIIWb+kFomWkco1WpBIc55PxWmDXS4VwGyZvQUg3RKpBdMTYXBikhO6m5gMgtPuIpI6snCPeK0W7Mnlqs2FkpVL4Hq/+Q14WDZ2tFrdPVIo/ONz2HJg03slqSwFPOZ9FOlSopaUVRoCLozFzwZPUt4n1x7Vahne370Ln9foXQwpZulUBmKRBC1ekegM1DndVP8omja5cI+XMcqmqtWfwq//OXrukUcmJ8Phv9pXKOz8NJ9/igJfZCxNVZ40hqRWKYbg/TWkQ1KgPB43nDt/AQYPD8HG/vXgxX70vof/FA9jolxOrvD2/O9+aGtZhqJNhtZlmLixJCQKJYnTlUWvMoqKEjHxfMYgSS89Va3+/HqwlgR+P+xXGiv3YIuora4iNc5dT7Qtb4Xp82E4d2oUXF4nlQ21ag2S8RQ2GBo01TfTECODFDp621CpjiUrSnSxfRDtRS6VelpX1bGl4Fqqnif96BG0+nd4XuaI9UkzQjr+KIoop8OuSznsS/OzABmVpdd3qXSKsVibZm8NsH/FYqOXypXTGIS5q2yjPaeqe5aKacng85XiULlSiVnMpoZyuULBW5CH6/31GCKhYq6YfF4wGp1IhxlVZu9b0dHW7nK5aH5IqPfJ9R5aX8sXCh8fCR2pLHXfa40lJSwZ1XzqQi5XPEFKNZG+pLKSWwSTScTK54YZhR85w9p/Ma6Lu+xOh1zntjPkgITXs9hxEYmRzxXKlay0+w8B/EuBL7a1acmydLSUr1Ig2WwBcvip4CHS6Sz2IkI3z/GrOJbvRkrx5FD+Eg9l0ljMKhWQKyokc8Wz+camLDzwwHU7uKWMJS0ycPef2XRO+HqNYRSHpNxcLFeNqioj24yDhtQ4ORVJV6z23+ocW0aalORsprWQzizPprIMucqOx9Og1hQ5JtferJptbEONYyOjp+JfFfySYr5cKxhNvGADwZgZK+V/ZcpWbmPSBk5nIDMdz31a8zYe1zlQOYbhkcP1hMv3XLJSeUUsS20m0FqQW+uiNTlYsDn3oeK3qrxK/opG/272VcAv9eqDWXPHAw1Gg7BCZ1iUygqDXYdORQ7D6IxKLtK0K0MQvaQuWERnNIVVDVPhRGU0dOSNr5y0S763uTTY/lsfcGqi6EAN40HNb0NdbkTFZSC31kiJdD2dZTUOWyqFVWRGYcsYnClVKmf4nCF75A8Aem78Py+CGUhVT6cQAAAAAElFTkSuQmCC';
        kbLogoImage.src = kbLogoData;

        function addKoalaBeast(ctx, x, y) {
            let opacity = 0.1;
            let scale = 5;
            let blur = 2;

            x = (x + 3.5 * scale) - kbLogoImage.naturalWidth * scale / 2;
            y = y - kbLogoImage.naturalHeight * scale / 2;

            ctx.save();
            ctx.globalAlpha = opacity;
            ctx.filter = 'blur(' + blur + 'px)';
            ctx.drawImage(kbLogoImage,  0,0,kbLogoImage.naturalWidth,kbLogoImage.naturalHeight,  x,y,kbLogoImage.naturalWidth*scale,kbLogoImage.naturalHeight*scale);
            ctx.filter = 'none';
            ctx.globalAlpha = 1;
            ctx.restore();
        }


        //detect some group settings...
        let startCounter3 = 0;
        let waitForGroupSocket = function() {
            if (!tagpro || !tagpro.group || tagpro.group.socket !== null && !tagpro.group.socket.connected) {
                startCounter3++;

                if (startCounter3 < 50) {
                    setTimeout(waitForGroupSocket, 20);
                    return false;
                }
            }

            if (tagpro && tagpro.group && tagpro.group.socket !== null && tagpro.group.socket.connected) {
                let settingCount = 0;

                function handleSetting(data) {
                    if (data.name === 'redTeamName') {
                        redTeamName = data.value;
                        settingCount++;
                    } else if (data.name === 'blueTeamName') {
                        blueTeamName = data.value;
                        settingCount++;
                    }

                    if (settingCount === 2) {
                        groupSettingsReady = true;
                        tagpro.group.socket.removeListener('setting', handleSetting);
                    }
                }

                tagpro.group.socket.on('setting', handleSetting);
            }
        };
        if (savedOptions.texture_logo_automatic) waitForGroupSocket();


        //helper functions...
        function rgbToHex(r, g, b) {
            return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
        }

        function hexToRgbA(hex, alpha=1) {
            if (/^#([A-Fa-f0-9]{3}){1,2}$/.test(hex)) {
                var c = hex.substring(1).split('');
                if (c.length === 3) c = [c[0], c[0], c[1], c[1], c[2], c[2]];
                c = '0x' + c.join('');
                if (!$.isNumeric(alpha) || (alpha < 0) || (alpha > 1)) alpha = 1;
                return 'rgba(' + [(c>>16)&255, (c>>8)&255, c&255].join(', ') + ', ' + alpha + ')';
            }
        }

        function getAverageColor(data, asHex=false, ignoreGrey=false, pixelInterval=1) {
            let rgb = { r:null, g:null, b:null };
            let length = data.length;
            let count = 0;
            let i = -4;

            while ((i += pixelInterval * 4) < length) {
                //let b = data[i] * 0.299 + data[i+1] * 0.587 + data[i+2] * 0.114;
                let isGrey = ignoreGrey && (Math.abs(data[i] - data[i+1]) + Math.abs(data[i+1] - data[i+2]) < 10);
                if (!isGrey && data[i+3]) {
                    rgb.r += data[i];
                    rgb.g += data[i+1];
                    rgb.b += data[i+2];
                    count++;
                }
            }

            if (count === 0) return null; //transparent

            rgb.r = Math.floor(rgb.r / count);
            rgb.g = Math.floor(rgb.g / count);
            rgb.b = Math.floor(rgb.b / count);

            if (asHex) {
                return rgbToHex(rgb.r, rgb.g, rgb.b).slice(0, 7);
            } else {
                return rgb;
            }
        }

        function getRandomInt(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }

    } //in a game

}); //tagpro.ready()
